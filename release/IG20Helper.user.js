// ==UserScript==
// @name               IG Helper
// @name:zh-TW         IG小精靈
// @name:zh-CN         IG小助手
// @name:ja            IG助手
// @name:ko            IG조수
// @namespace          https://github.snkms.com/
// @version            2.39.6
// @description        Downloading is possible for both photos and videos from posts, as well as for stories, reels or profile picture.
// @description:zh-TW  一鍵下載對方 Instagram 貼文中的相片、影片甚至是他們的限時動態、連續短片及大頭貼圖片！
// @description:zh-CN  一键下载对方 Instagram 帖子中的相片、视频甚至是他们的快拍、Reels及头像图片！
// @description:ja     投稿の写真と動画だけでなく、ストーリー、リール、プロフィール写真もダウンロードできます。
// @description:ko     게시물의 사진과 동영상뿐만 아니라 스토리, 릴 또는 프로필 사진도 다운로드할 수 있습니다.
// @description:ro     Descărcarea este posibilă atât pentru fotografiile și videoclipurile din postări, cât și pentru storyuri, reels sau poze de profil.
// @author             SN-Koarashi (5026)
// @match              https://*.instagram.com/*
// @grant              GM_info
// @grant              GM_addStyle
// @grant              GM_setValue
// @grant              GM_getValue
// @grant              GM_xmlhttpRequest
// @grant              GM_registerMenuCommand
// @grant              GM_unregisterMenuCommand
// @grant              GM_getResourceText
// @grant              GM_notification
// @grant              GM_openInTab
// @connect            i.instagram.com
// @connect            raw.githubusercontent.com
// @require            https://code.jquery.com/jquery-3.7.1.min.js#sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=
// @resource           INTERNAL_CSS https://raw.githubusercontent.com/SN-Koarashi/ig-helper/master/style.css
// @resource           LOCALE_MANIFEST https://raw.githubusercontent.com/SN-Koarashi/ig-helper/master/locale/manifest.json
// @supportURL         https://github.com/SN-Koarashi/ig-helper/
// @contributionURL    https://ko-fi.com/snkoarashi
// @icon               https://www.google.com/s2/favicons?domain=www.instagram.com&sz=32
// @compatible         firefox >= 100
// @compatible         chrome >= 100
// @compatible         edge >= 100
// @license            GPL-3.0-only
// @run-at             document-idle
// @downloadURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/IG20Helper.user.js
// @updateURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/IG20Helper.meta.js
// ==/UserScript==
!function(e){"use strict";const t={CHECK_UPDATE:!0,AUTO_RENAME:!0,RENAME_PUBLISH_DATE:!0,DISABLE_VIDEO_LOOPING:!1,HTML5_VIDEO_CONTROL:!1,REDIRECT_CLICK_USER_STORY_PICTURE:!1,FORCE_FETCH_ALL_RESOURCES:!1,DIRECT_DOWNLOAD_VISIBLE_RESOURCE:!1,DIRECT_DOWNLOAD_ALL:!1,MODIFY_VIDEO_VOLUME:!1,SCROLL_BUTTON:!0,FORCE_RESOURCE_VIA_MEDIA:!1,USE_BLOB_FETCH_WHEN_MEDIA_RATE_LIMIT:!1,NEW_TAB_ALWAYS_FORCE_MEDIA_IN_POST:!1,SKIP_VIEW_STORY_CONFIRM:!1},i=["RENAME_PUBLISH_DATE","USE_BLOB_FETCH_WHEN_MEDIA_RATE_LIMIT","NEW_TAB_ALWAYS_FORCE_MEDIA_IN_POST"];var a=GM_getValue("G_VIDEO_VOLUME")?GM_getValue("G_VIDEO_VOLUME"):1,n=!1,s=GM_getValue("G_RENAME_FORMAT")?GM_getValue("G_RENAME_FORMAT"):"%USERNAME%-%SOURCE_TYPE%-%SHORTCODE%-%YEAR%%MONTH%%DAY%_%HOUR%%MINUTE%%SECOND%_%ORIGINAL_NAME_FIRST%";const o='<svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"><g><g><path d="M382.56,233.376C379.968,227.648,374.272,224,368,224h-64V16c0-8.832-7.168-16-16-16h-64c-8.832,0-16,7.168-16,16v208h-64    c-6.272,0-11.968,3.68-14.56,9.376c-2.624,5.728-1.6,12.416,2.528,17.152l112,128c3.04,3.488,7.424,5.472,12.032,5.472    c4.608,0,8.992-2.016,12.032-5.472l112-128C384.192,245.824,385.152,239.104,382.56,233.376z"/></g></g><g><g><path d="M432,352v96H80v-96H16v128c0,17.696,14.336,32,32,32h416c17.696,0,32-14.304,32-32V352H432z"/></g></g>',r='<svg width="16" height="16" viewBox="3 3 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M20 14a1 1 0 0 0-1 1v3.077c0 .459-.022.57-.082.684a.363.363 0 0 1-.157.157c-.113.06-.225.082-.684.082H5.923c-.459 0-.571-.022-.684-.082a.363.363 0 0 1-.157-.157c-.06-.113-.082-.225-.082-.684L4.999 5.5a.5.5 0 0 1 .5-.5l3.5.005a1 1 0 1 0 .002-2L5.501 3a2.5 2.5 0 0 0-2.502 2.5v12.577c0 .76.083 1.185.32 1.627.223.419.558.753.977.977.442.237.866.319 1.627.319h12.154c.76 0 1.185-.082 1.627-.319.419-.224.753-.558.977-.977.237-.442.319-.866.319-1.627V15a1 1 0 0 0-1-1zm-2-9.055v-.291l-.39.09A10 10 0 0 1 15.36 5H14a1 1 0 1 1 0-2l5.5.003a1.5 1.5 0 0 1 1.5 1.5V10a1 1 0 1 1-2 0V8.639c0-.757.086-1.511.256-2.249l.09-.39h-.295a10 10 0 0 1-1.411 1.775l-5.933 5.932a1 1 0 0 1-1.414-1.414l5.944-5.944A10 10 0 0 1 18 4.945z" fill="currentColor"/></svg>',l='<svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="512" viewBox="0 0 24 24" width="512"><circle cx="8.25" cy="5.25" r=".5"/><path d="m8.25 6.5c-.689 0-1.25-.561-1.25-1.25s.561-1.25 1.25-1.25 1.25.561 1.25 1.25-.561 1.25-1.25 1.25zm0-1.5c-.138 0-.25.112-.25.25 0 .275.5.275.5 0 0-.138-.112-.25-.25-.25z"/><path d="m7.25 11.25 2-2.5 2.25 1.5 2.25-3.5 3 4.5z"/><path d="m16.75 12h-9.5c-.288 0-.551-.165-.676-.425s-.09-.568.09-.793l2-2.5c.243-.304.678-.372 1.002-.156l1.616 1.077 1.837-2.859c.137-.212.372-.342.625-.344.246-.026.49.123.63.334l3 4.5c.153.23.168.526.037.77-.13.244-.385.396-.661.396zm-4.519-1.5h3.118l-1.587-2.381zm-3.42 0h1.712l-1.117-.745z"/><path d="m22.25 14h-2.756c-.778 0-1.452.501-1.676 1.247l-.859 2.862c-.16.533-.641.891-1.197.891h-7.524c-.556 0-1.037-.358-1.197-.891l-.859-2.861c-.224-.747-.897-1.248-1.676-1.248h-2.756c-.965 0-1.75.785-1.75 1.75v5.5c0 1.517 1.233 2.75 2.75 2.75h18.5c1.517 0 2.75-1.233 2.75-2.75v-5.5c0-.965-.785-1.75-1.75-1.75z"/><path d="m4 12c-.552 0-1-.448-1-1v-8c0-1.654 1.346-3 3-3h12c1.654 0 3 1.346 3 3v8c0 .552-.448 1-1 1s-1-.448-1-1v-8c0-.551-.449-1-1-1h-12c-.551 0-1 .449-1 1v8c0 .552-.448 1-1 1z"/></svg>',d='<svg width="26" height="26" xmlns="http://www.w3.org/2000/svg" id="bold" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path d="m14.828 12 5.303-5.303c.586-.586.586-1.536 0-2.121l-.707-.707c-.586-.586-1.536-.586-2.121 0l-5.303 5.303-5.303-5.304c-.586-.586-1.536-.586-2.121 0l-.708.707c-.586.586-.586 1.536 0 2.121l5.304 5.304-5.303 5.303c-.586.586-.586 1.536 0 2.121l.707.707c.586.586 1.536.586 2.121 0l5.303-5.303 5.303 5.303c.586.586 1.536.586 2.121 0l.707-.707c.586-.586.586-1.536 0-2.121z"></path></svg>',c=GM_getResourceText("INTERNAL_CSS"),h=JSON.parse(GM_getResourceText("LOCALE_MANIFEST"));var _,p,I,u,m=[],v={},f=GM_getValue("lang")||navigator.language||navigator.userLanguage,g=location.href,D=!1,E=!1,G=[],T={stories:{},highlights:{}},N=new MutationObserver((function(e,t){B()}));!function(){for(let e in t)null!=GM_getValue(e)&&"boolean"==typeof GM_getValue(e)&&(t[e]=GM_getValue(e))}(),GM_addStyle(c),z(),j(f).then((e=>{v[f]=e,q(),z(),J(300)})).catch((e=>{z(),J(300),f.startsWith("en")||console.error("getTranslationText catch error:",e)}));setInterval((function(){if(e("div#splash-screen").length>0&&!e("div#splash-screen").is(":hidden")||location.pathname.match(/^\/(explore(\/.*)?|challenge\/?.*|direct\/?.*|qr\/?|accounts\/.*|emails\/.*|language\/?.*?|your_activity\/?.*|settings\/help(\/.*)?$)$/gi)||!location.hostname.startsWith("www."))E=!1;else if(g!=location.href||!D||!E){if(console.log("Main Timer","trigging"),clearInterval(u),E=!1,D=!0,g=location.href,N.disconnect(),location.href.startsWith("https://www.instagram.com/p/")||location.pathname.match(/^\/(.*?)\/(p|reel)\//gi)||location.href.startsWith("https://www.instagram.com/reel/")){T.stories={},T.highlights={},ie("isDialog");var i=setInterval((()=>{e('body > div[class]:not([id^="mount"]) div div[role="dialog"] article,\n                          section:visible > main > div > div > div > div > div > hr,\n                          body > div[id^="mount"] section nav + div > article,\n                          section:visible > main > div > div > article > div > div > div > div > div > header\n                         ').length>0&&(clearInterval(i),setTimeout((()=>{B(!1)}),15))}),100);E=!0}if(location.href.startsWith("https://www.instagram.com/reels/")&&(ie("isReels"),setTimeout((()=>{M(!1)}),150),E=!0),"https://www.instagram.com/"==location.href.split("?")[0]){T.stories={},T.highlights={};let t=null!=_?.match(/^\/(stories|highlights)\//gi);ie("isHomepage",t),setTimeout((()=>{B(!1,t);const i=e('div[id^="mount"] > div > div div > section > main div:not([class]):not([style]) > div > article')?.parent()[0];i&&N.observe(i,{childList:!0})}),150),E=!0}e("header > *[class]:first-child img[alt]").length&&location.pathname.match(/^(\/)([0-9A-Za-z\.\-_]+)\/?(tagged|reels|saved)?\/?$/gi)&&!location.pathname.match(/^(\/explore\/?$|\/stories(\/.*)?$|\/p\/)/gi)&&(ie("isProfile"),setTimeout((()=>{O(!1)}),150),E=!0),E||(location.href.match(/^(https:\/\/www\.instagram\.com\/stories\/highlights\/)/gi)?(T.highlights={},ie("isHighlightsStory"),S(!1),u=setInterval((()=>{A(!1)}),250),e(".IG_DWHISTORY").length&&setTimeout((()=>{if(t.SKIP_VIEW_STORY_CONFIRM){var i=e('div[id^="mount"] section:last-child > div > div div[role="button"]').filter((function(){return 0===e(this).children().length&&""!==this.textContent.trim()}));i?.click()}E=!0}),150)):location.href.match(/^(https:\/\/www\.instagram\.com\/stories\/)/gi)?(ie("isStory"),e('div[id^="mount"] section > div > a[href="/"]').length>0&&(e(".IG_DWSTORY").remove(),e(".IG_DWNEWTAB").remove(),e(".IG_DWSTORY_THUMBNAIL").length&&e(".IG_DWSTORY_THUMBNAIL").remove(),b(!1),setTimeout((()=>{b(!1)}),150)),e(".IG_DWSTORY").length&&setTimeout((()=>{if(t.SKIP_VIEW_STORY_CONFIRM){var i=e('div[id^="mount"] section:last-child > div > div div[role="button"]').filter((function(){return 0===e(this).children().length&&""!==this.textContent.trim()}));i?.click()}E=!0}),150)):(E=!1,e(".IG_DWSTORY").length&&e(".IG_DWSTORY").remove(),e(".IG_DWNEWTAB").length&&e(".IG_DWNEWTAB").remove(),e(".IG_DWSTORY_THUMBNAIL").length&&e(".IG_DWSTORY_THUMBNAIL").remove(),e(".IG_DWHISTORY").length&&e(".IG_DWHISTORY").remove(),e(".IG_DWHINEWTAB").length&&e(".IG_DWHINEWTAB").remove(),e(".IG_DWHISTORY_THUMBNAIL").length&&e(".IG_DWHISTORY_THUMBNAIL").remove())),J(300),_=new URL(location.href).pathname}}),250);async function O(t){if(t){U(!0);let e=(new Date).getTime(),t=Math.floor(e/1e3),a=location.pathname.replaceAll(/(reels|tagged)\/$/gi,"").split("/").filter((e=>e.length>0)).at(-1),n=await L(a);try{V(await(i=n.user.pk,new Promise(((e,t)=>{GM_xmlhttpRequest({method:"GET",url:`https://i.instagram.com/api/v1/users/${i}/info/`,headers:{"User-Agent":"Mozilla/5.0 (Linux; Android 10; Pixel 7 XL)Build/RP1A.20845.002; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/5.0 Chrome/117.0.5938.60 Mobile Safari/537.36 Instagram 307.0.0.34.111"},onload:function(i){try{let a=JSON.parse(i.response);"ok"!==a.status?(ie("getUserHighSizeProfile()","reject",a),t("faild")):(ie("getUserHighSizeProfile()",a),e(a.user.hd_profile_pic_url_info?.url))}catch(e){ie("getUserHighSizeProfile()","reject",e),t(e)}},onerror:function(e){ie("getUserHighSizeProfile()","reject",e),t(e)}})}))),a,"avatar",t,"jpg")}catch(e){V(n.user.profile_pic_url,a,"avatar",t,"jpg")}U(!1)}else if(!e(".IG_DWPROFILE").length){let t=setInterval((()=>{e(".IG_DWPROFILE").length?clearInterval(t):(e("header > *[class]:first-child img[alt][draggable]").parent().parent().append(`<div data-ih-locale-title="DW" title="${K("DW")}" class="IG_DWPROFILE">${o}</div>`),e("header > *[class]:first-child img[alt][draggable]").parent().parent().css("position","relative"),e("header > *[class]:first-child img[alt]:not([draggable])").parent().parent().parent().append(`<div data-ih-locale-title="DW" title="${K("DW")}" class="IG_DWPROFILE">${o}</div>`),e("header > *[class]:first-child img[alt]:not([draggable])").parent().parent().parent().css("position","relative"))}),150)}var i}async function S(i,a){if(i){let i=(new Date).getTime(),s=Math.floor(i/1e3),o=location.href.replace(/\/$/gi,"").split("/").at(-1),r=e("body > div section._ac0a header._ac0k > ._ac3r ._ac3n ._ac3p[style]").length||e("body > div section:visible > div > div:not([class]) > div > div div.x1ned7t2.x78zum5 div.x1caxmr6").length||e("body > div div:not([hidden]) section:visible > div div[style]:not([class]) > div").find("div div.x1ned7t2.x78zum5 div.x1caxmr6").length,l="",d=0;if(U(!0),T.highlights[o]){ie("Fetch from memory cache:",o);let e=T.highlights[o].data.reels_media[0].items.length;l=T.highlights[o].data.reels_media[0].owner.username,d=T.highlights[o].data.reels_media[0].items[e-r]}else{let e=await y(o),t=e.data.reels_media[0].items.length;l=e.data.reels_media[0].owner.username,d=e.data.reels_media[0].items[t-r],T.highlights[o]=e}if(t.RENAME_PUBLISH_DATE&&(s=d.taken_at_timestamp),t.FORCE_RESOURCE_VIA_MEDIA&&!n){let e=await W(d.id);"ok"===e.status?e.items[0].video_versions?a?ee(e.items[0].video_versions[0].url):V(e.items[0].video_versions[0].url,l,"highlights",s,"mp4",o):a?ee(e.items[0].image_versions2.candidates[0].url):V(e.items[0].image_versions2.candidates[0].url,l,"highlights",s,"jpg",o):(t.USE_BLOB_FETCH_WHEN_MEDIA_RATE_LIMIT?(delete T.highlights[o],n=!0,S(!0,a)):alert("Fetch failed from Media API. API response message: "+e.message),ie(e))}else d.is_video?a?ee(d.video_resources.at(-1).src):V(d.video_resources.at(-1).src,l,"highlights",s,"mp4",o):a?ee(d.display_resources.at(-1).src):V(d.display_resources.at(-1).src,l,"highlights",s,"jpg",o),n=!1;U(!1)}else if(!e(".IG_DWHISTORY").length){let t=null;if(e("body > div section._ac0a").length>0?t=e("body > div section:visible._ac0a"):(t=e("body > div section:visible > div > div[style]:not([class])"),t.css("position","relative")),0===t.length){let i=e("body > div div:not([hidden]) section:visible > div div[class][style] > div[style]:not([class])"),a=0;i.each((function(){e(this).width()>a&&(a=e(this).width(),t=e(this).children("div").first())}))}null!=t&&(t.append(`<div data-ih-locale-title="DW" title="${K("DW")}" class="IG_DWHISTORY">${o}</div>`),t.append(`<div data-ih-locale-title="NEW_TAB" title="${K("NEW_TAB")}" class="IG_DWHINEWTAB">${r}</div>`),t.find("img[referrerpolicy]").each((function(){e(this).on("load",(function(){e(this).data("remove-thumbnail")||(0===t.find(".IG_DWHISTORY_THUMBNAIL").length?(e(this).attr("data-remove-thumbnail",!0),e(".IG_DWHISTORY_THUMBNAIL").remove(),ie("(highlight) Manually removing thumbnail button")):(e(this).attr("data-remove-thumbnail",!0),ie("(highlight) Thumbnail button is not present for this picture")))}))})))}}async function A(i){if(i){let i=(new Date).getTime(),a=Math.floor(i/1e3),s=location.href.replace(/\/$/gi,"").split("/").at(-1),o="",r=e("body > div section._ac0a header._ac0k > ._ac3r ._ac3n ._ac3p[style]").length||e("body > div section:visible > div > div:not([class]) > div > div div.x1ned7t2.x78zum5 div.x1caxmr6").length||e("body > div div:not([hidden]) section:visible > div div[style]:not([class]) > div").find("div div.x1ned7t2.x78zum5 div.x1caxmr6").length,l="";if(U(!0),T.highlights[s]){ie("Fetch from memory cache:",s);let e=T.highlights[s].data.reels_media[0].items.length;o=T.highlights[s].data.reels_media[0].owner.username,l=T.highlights[s].data.reels_media[0].items[e-r]}else{let e=await y(s),t=e.data.reels_media[0].items.length;o=e.data.reels_media[0].owner.username,l=e.data.reels_media[0].items[t-r],T.highlights[s]=e}if(t.RENAME_PUBLISH_DATE&&(a=l.taken_at_timestamp),t.FORCE_RESOURCE_VIA_MEDIA&&!n){let e=await W(l.id);"ok"===e.status?V(e.items[0].image_versions2.candidates[0].url,o,"highlights",a,"jpg",s):(t.USE_BLOB_FETCH_WHEN_MEDIA_RATE_LIMIT?(delete T.highlights[s],n=!0,A(!0)):alert("Fetch failed from Media API. API response message: "+e.message),ie(e))}else V(l.display_resources.at(-1).src,o,"highlights",a,"jpg",s),n=!1;U(!1)}else if(e("body > div section video.xh8yej3").length){if(!e(".IG_DWHISTORY_THUMBNAIL").length){let t=null;if(e("body > div section._ac0a").length>0?t=e("body > div section:visible._ac0a"):(t=e("body > div section:visible > div > div[style]:not([class])"),t.css("position","relative")),0===t.length){let i=e("body > div div:not([hidden]) section:visible > div div[class][style] > div[style]:not([class])"),a=0;i.each((function(){e(this).width()>a&&(a=e(this).width(),t=e(this).children("div").first())}))}null!=t&&t.append(`<div data-ih-locale-title="THUMBNAIL_INTRO" title="${K("THUMBNAIL_INTRO")}" class="IG_DWHISTORY_THUMBNAIL">${l}</div>`)}}else e(".IG_DWHISTORY_THUMBNAIL").remove()}async function b(i,a,s){if(i){let o=(new Date).getTime(),r=Math.floor(o/1e3),l=e("body > div section._ac0a header._ac0k ._ac0l a + div a").first().text()||location.pathname.split("/").filter((e=>e.length>0)).at(1);if(U(!0),t.FORCE_RESOURCE_VIA_MEDIA&&!n){let o=null,d=(await L(l)).user.pk,c=await w(d),h=location.pathname.split("/").filter((e=>e.length>0&&e.match(/^([0-9]{10,})$/))).at(-1);if(c.data.reels_media[0].items.forEach((e=>{e.id==h&&(o=e.id)})),null==o){e('body > div section:visible a[href^="/'+l+'"] span').filter((function(){return 0===e(this).children().length&&0===e(this).find("svg").length&&e(this).text()?.toLowerCase()===l?.toLowerCase()})).parents("div:not([class]):not([style])").filter((function(){return e(this).text()?.toLowerCase()!==l?.toLowerCase()})).filter((function(){return e(this).children().length>1})).first().children().filter((function(){return e(this).height()<10})).first().children().each((function(t){e(this).children().length>0&&(o=c.data.reels_media[0].items[t].id)}))}null==o&&(e("body > div section:visible div.x1ned7t2.x78zum5 > div").each((function(t){e(this).hasClass("x1lix1fw")&&e(this).children().length>0&&(o=c.data.reels_media[0].items[t].id)})),e("body > div section:visible ._ac0k > ._ac3r > div").each((function(t){e(this).children().hasClass("_ac3q")&&(o=c.data.reels_media[0].items[t].id)}))),null==o&&(o=location.pathname.split("/").filter((e=>e.length>0&&e.match(/^([0-9]{10,})$/))).at(-1));let _=await W(o);return t.RENAME_PUBLISH_DATE&&(r=_.items[0].taken_at),"ok"===_.status?_.items[0].video_versions?s?ee(_.items[0].video_versions[0].url):V(_.items[0].video_versions[0].url,l,"stories",r,"mp4",o):s?ee(_.items[0].image_versions2.candidates[0].url):V(_.items[0].image_versions2.candidates[0].url,l,"stories",r,"jpg",o):(t.USE_BLOB_FETCH_WHEN_MEDIA_RATE_LIMIT?(n=!0,b(i,a,s)):alert("Fetch failed from Media API. API response message: "+_.message),ie(_)),void U(!1)}if(e("body > div section:visible video[playsinline]").length>0){let i="mp4",n="",o=location.pathname.replace(/\/$/gi,"").split("/").at(-1),d=null;if(T.stories[l]&&!a){if(ie("Fetch from memory cache:",l),T.stories[l].data.reels_media[0].items.forEach((e=>{e.id==o&&(n=e.video_resources[0].src,t.RENAME_PUBLISH_DATE&&(r=e.taken_at_timestamp,d=e.id))})),0==n.length)return ie("Memory cache not found, try fetch from API:",l),void b(!0,!0)}else{let i=(await L(l)).user.pk,a=await w(i);if(a.data.reels_media[0].items.forEach((e=>{e.id==o&&(n=e.video_resources[0].src,t.RENAME_PUBLISH_DATE&&(r=e.taken_at_timestamp,d=e.id))})),0==n.length){e('body > div section:visible a[href^="/'+l+'"] span').filter((function(){return 0===e(this).children().length&&0===e(this).find("svg").length&&e(this).text()?.toLowerCase()===l?.toLowerCase()})).parents("div:not([class]):not([style])").filter((function(){return e(this).text()?.toLowerCase()!==l?.toLowerCase()})).filter((function(){return e(this).children().length>1})).first().children().filter((function(){return e(this).height()<10})).first().children().each((function(i){e(this).children().length>0&&(n=a.data.reels_media[0].items[i].video_resources[0].src,t.RENAME_PUBLISH_DATE&&(r=a.data.reels_media[0].items[i].taken_at_timestamp,d=a.data.reels_media[0].items[i].id))})),0==n.length&&(e("body > div section:visible div.x1ned7t2.x78zum5 > div").each((function(i){e(this).hasClass("x1lix1fw")&&e(this).children().length>0&&(n=a.data.reels_media[0].items[i].video_resources[0].src,t.RENAME_PUBLISH_DATE&&(r=a.data.reels_media[0].items[i].taken_at_timestamp,d=a.data.reels_media[0].items[i].id))})),e("body > div section:visible ._ac0k > ._ac3r > div").each((function(i){e(this).children().hasClass("_ac3q")&&(n=a.data.reels_media[0].items[i].video_resources[0].src,t.RENAME_PUBLISH_DATE&&(r=a.data.reels_media[0].items[i].taken_at_timestamp,d=a.data.reels_media[0].items[i].id))})))}T.stories[l]=a}0==n.length?alert(K("NO_VID_URL")):s?ee(n):V(n,l,"stories",r,i,d)}else{let i=e("body > div section:visible img[referrerpolicy][class], body > div section:visible img[crossorigin][class]:not([alt])").attr("srcset")?.split(",")[0]?.split(" ")[0],a=i||e("body > div section:visible img[referrerpolicy][class], body > div section:visible img[crossorigin][class]:not([alt])").filter((function(){return 0===e(this).parents("a").length&&e(this).width()===e(this).parent().width()})).attr("src");if(!a){let t=e("body > div section:visible img._aa63");a=t.attr("srcset")?t.attr("srcset")?.split(",")[0]?.split(" ")[0]:t.attr("src")}t.RENAME_PUBLISH_DATE&&(r=new Date(e("body > div section:visible time[datetime][class]").first().attr("datetime")).getTime());let n=a,o="jpg";s?ee(n):V(n,l,"stories",r,o,function(e){let t=new URL(e),i=t?.searchParams?.get("ig_cache_key")?.split(".").at(0);return i?atob(i):null}(n)??"")}n=!1,U(!1)}else{if(!e(".IG_DWSTORY").length){T.stories={};let t=null;if(e("body > div section._ac0a").length>0?t=e("body > div section:visible._ac0a"):(t=e("body > div section:visible > div > div[style]:not([class])"),t.css("position","relative")),0===t.length&&(t=e('div[id^="mount"] section > div > a[href="/"]').parent().parent().parent().find("section:visible > div > div[style]:not([class])"),t.css("position","relative")),0===t.length&&(t=e('div[id^="mount"] section > div > a[href="/"]').parent().parent().parent().find('section:visible > div div[style]:not([class]) > div:not([data-visualcompletion="loading-state"])'),t.css("position","relative")),0===t.length){let i=e("body > div div:not([hidden]) section:visible > div div[class][style] > div[style]:not([class])"),a=0;i.each((function(){e(this).width()>a&&(a=e(this).width(),t=e(this).children("div").first())}))}null!=t&&(t.first().css("position","relative"),t.first().append(`<div data-ih-locale-title="DW" title="${K("DW")}" class="IG_DWSTORY">${o}</div>`),t.first().append(`<div data-ih-locale-title="NEW_TAB" title="${K("NEW_TAB")}" class="IG_DWNEWTAB">${r}</div>`),t.find("img[referrerpolicy]").each((function(){e(this).on("load",(function(){e(this).data("remove-thumbnail")||(0===t.find(".IG_DWSTORY_THUMBNAIL").length?(e(this).attr("data-remove-thumbnail",!0),e(".IG_DWSTORY_THUMBNAIL").remove(),ie("(story) Manually removing thumbnail button")):(e(this).attr("data-remove-thumbnail",!0),ie("(story) Thumbnail button is not present for this picture")))}))})))}}}async function R(i,a){if(i){let i=(new Date).getTime(),s=Math.floor(i/1e3),o="jpg",r=e("body > div section._ac0a header._ac0k ._ac0l a + div a").first().text()||location.pathname.split("/").at(2),l=location.pathname.replace(/\/$/gi,"").split("/").at(-1),d="",c=null;if(U(!0),t.FORCE_RESOURCE_VIA_MEDIA&&!n){let i=(await L(r)).user.pk,o=await w(i),l=location.pathname.split("/").filter((e=>e.length>0&&e.match(/^([0-9]{10,})$/))).at(-1);if(o.data.reels_media[0].items.forEach((e=>{e.id==l&&(c=e.id)})),null==c){e('body > div section:visible a[href^="/'+r+'"] span').filter((function(){return 0===e(this).children().length&&0===e(this).find("svg").length&&e(this).text()?.toLowerCase()===r?.toLowerCase()})).parents("div:not([class]):not([style])").filter((function(){return e(this).text()?.toLowerCase()!==r?.toLowerCase()})).filter((function(){return e(this).children().length>1})).first().children().filter((function(){return e(this).height()<10})).first().children().each((function(t){e(this).children().length>0&&(c=o.data.reels_media[0].items[t].id)}))}null==c&&(e("body > div section:visible div.x1ned7t2.x78zum5 > div").each((function(t){e(this).hasClass("x1lix1fw")&&e(this).children().length>0&&(c=o.data.reels_media[0].items[t].id)})),e("body > div section:visible ._ac0k > ._ac3r > div").each((function(t){e(this).children().hasClass("_ac3q")&&(c=o.data.reels_media[0].items[t].id)}))),null==c&&(c=location.pathname.split("/").filter((e=>e.length>0&&e.match(/^([0-9]{10,})$/))).at(-1));let d=await W(c);return t.RENAME_PUBLISH_DATE&&(s=d.items[0].taken_at),"ok"===d.status?V(d.items[0].image_versions2.candidates[0].url,r,"stories",s,"jpg",c):(t.USE_BLOB_FETCH_WHEN_MEDIA_RATE_LIMIT?(n=!0,R(!0,a)):alert("Fetch failed from Media API. API response message: "+d.message),ie(d)),void U(!1)}if(T.stories[r]&&!a){if(ie("Fetch from memory cache:",r),T.stories[r].data.reels_media[0].items.forEach((e=>{e.id==l&&(d=e.display_url,t.RENAME_PUBLISH_DATE&&(s=e.taken_at_timestamp,c=e.id))})),0==d.length)return ie("Memory cache not found, try fetch from API:",r),void R(!0,!0)}else{let i=(await L(r)).user.pk,a=await w(i);if(a.data.reels_media[0].items.forEach((e=>{e.id==l&&(d=e.display_url,t.RENAME_PUBLISH_DATE&&(s=e.taken_at_timestamp,c=e.id))})),0==d.length){e('body > div section:visible a[href^="/'+r+'"] span').filter((function(){return 0===e(this).children().length&&0===e(this).find("svg").length&&e(this).text()?.toLowerCase()===r?.toLowerCase()})).parents("div:not([class]):not([style])").filter((function(){return e(this).text()?.toLowerCase()!==r?.toLowerCase()})).filter((function(){return e(this).children().length>1})).first().children().filter((function(){return e(this).height()<10})).first().children().each((function(i){e(this).children().length>0&&(d=a.data.reels_media[0].items[i].display_url,t.RENAME_PUBLISH_DATE&&(s=a.data.reels_media[0].items[i].taken_at_timestamp,c=a.data.reels_media[0].items[i].id))})),0==d.length&&(e("body > div section:visible div.x1ned7t2.x78zum5 > div").each((function(i){e(this).hasClass("x1lix1fw")&&e(this).children().length>0&&(d=a.data.reels_media[0].items[i].display_url,t.RENAME_PUBLISH_DATE&&(s=a.data.reels_media[0].items[i].taken_at_timestamp,c=a.data.reels_media[0].items[i].id))})),e("body > div section:visible ._ac0k > ._ac3r > div").each((function(i){e(this).children().hasClass("_ac3q")&&(d=a.data.reels_media[0].items[i].display_url,t.RENAME_PUBLISH_DATE&&(s=a.data.reels_media[0].items[i].taken_at_timestamp,c=a.data.reels_media[0].items[i].id))})))}}V(d,r,"thumbnail",s,o,c),n=!1,U(!1)}else if(e("body > div div.IG_DWSTORY").parent().find("video[class]").length){let t=null;if(e("body > div section._ac0a").length>0?t=e("body > div section:visible._ac0a"):(t=e("body > div section:visible > div > div[style]:not([class])"),t.css("position","relative")),0===t.length&&(t=e('div[id^="mount"] section > div > a[href="/"]').parent().parent().parent().find("section:visible > div > div[style]:not([class])"),t.css("position","relative")),0===t.length&&(t=e('div[id^="mount"] section > div > a[href="/"]').parent().parent().parent().find('section:visible > div div[style]:not([class]) > div:not([data-visualcompletion="loading-state"])'),t.css("position","relative")),0===t.length){let i=e("body > div div:not([hidden]) section:visible > div div[class][style] > div[style]:not([class])"),a=0;i.each((function(){e(this).width()>a&&(a=e(this).width(),t=e(this).children("div").first())}))}null!=t&&(t.first().css("position","relative"),t.first().append(`<div data-ih-locale-title="THUMBNAIL_INTRO" title="${K("THUMBNAIL_INTRO")}" class="IG_DWSTORY_THUMBNAIL">${l}</div>`))}}async function M(i,n,s){if(i){U(!0);let e=location.href.split("?").at(0).split("instagram.com/reels/").at(-1).replaceAll("/",""),i=await C(e),a=i.data,o=(new Date).getTime();if(t.RENAME_PUBLISH_DATE&&(o="query_hash"===i.type?a.shortcode_media.taken_at_timestamp:a.taken_at),"query_hash"===i.type)if(n&&a.shortcode_media.is_video)if(s)ee(a.shortcode_media.video_url);else{let t="mp4";V(a.shortcode_media.video_url,a.shortcode_media.owner.username,"reels",o,t,e)}else if(s)ee(a.shortcode_media.display_resources.at(-1).src);else{let t="jpg";V(a.shortcode_media.display_resources.at(-1).src,a.shortcode_media.owner.username,"reels",o,t,e)}else if(n&&null!=a.video_versions)if(s)ee(a.video_versions[0].url);else{let t="mp4";V(a.video_versions[0].url,a.owner.username,"reels",o,t,e)}else if(s)ee(a.image_versions2.candidates[0].url);else{let t="jpg";V(a.image_versions2.candidates[0].url,a.owner.username,"reels",o,t,e)}U(!1)}else var d=setInterval((()=>{e('section > main[role="main"] > div div.x1qjc9v5 video').length>0&&(clearInterval(d),t.SCROLL_BUTTON&&(e("#scrollWrapper").remove(),e('section > main[role="main"]').append('<section id="scrollWrapper"></section>'),e('section > main[role="main"] > #scrollWrapper').append('<div class="button-up"><div></div></div>'),e('section > main[role="main"] > #scrollWrapper').append('<div class="button-down"><div></div></div>'),e('section > main[role="main"] > #scrollWrapper > .button-up').on("click",(function(){e('section > main[role="main"] > div')[0].scrollBy({top:-30,behavior:"smooth"})})),e('section > main[role="main"] > #scrollWrapper > .button-down').on("click",(function(){e('section > main[role="main"] > div')[0].scrollBy({top:30,behavior:"smooth"})}))),e('section > main[role="main"] > div[tabindex]').children("div").each((function(){if(e(this).children().length>0&&!e(this).children().find(".IG_REELS").length){var i=e(this);e(this).children().css("position","relative"),e(this).children().append(`<div data-ih-locale-title="DW" title="${K("DW")}" class="IG_REELS">${o}</div>`),e(this).children().append(`<div data-ih-locale-title="NEW_TAB" title="${K("NEW_TAB")}" class="IG_REELS_NEWTAB">${r}</div>`),e(this).children().append(`<div data-ih-locale-title="THUMBNAIL_INTRO" title="${K("THUMBNAIL_INTRO")}" class="IG_REELS_THUMBNAIL">${l}</div>`),t.DISABLE_VIDEO_LOOPING&&e(this).find("video").each((function(){e(this).on("ended",(function(){if(!e(this).data("loop")){let t=e(this).next().find('div[role="presentation"] > div svg > path[d^="M5.888"]').parents('button[role="button"], div[role="button"]');t.length>0?(e(this).attr("data-loop",!0),t.click(),ie("Adding video event listener #loop, then paused click()")):(e(this).attr("data-loop",!0),e(this).parent().find(".xpgaw4o").removeAttr("style"),this.pause(),ie("Adding video event listener #loop, then paused pause()"))}}))})),t.HTML5_VIDEO_CONTROL&&e(this).find("video").each((function(){if(!e(this).data("controls")){let t=e(this);ie("(reel) Added video html5 contorller #modify"),this.volume=a,e(this).on("loadstart",(function(){this.volume=a})),e(this).on("contextmenu",(function(e){e.preventDefault(),t.css("z-index","-1"),t.removeAttr("controls")})),e(this).parent().find('video + div div[role="button"]').filter((function(){return e(this).parent('div[role="presentation"]').length>0&&"pointer"===e(this).css("cursor")&&null!=e(this).attr("style")})).first().on("contextmenu",(function(e){e.preventDefault(),t.css("z-index","2"),t.attr("controls",!0)})),e(this).on("volumechange",(function(){let t=e(this).parent().find("video + div > div").find('button[type="button"], div[role="button"]').filter((function(t){return e(this).width()<=64&&e(this).height()<=64&&e(this).find('svg > path[d^="M16.636 7.028a1.5"], svg > path[d^="M1.5 13.3c-.8"]').length>0}));var i=0===t.find('svg > path[d^="M16.636"]').length;this.muted!=i&&(this.volume=a,t?.click()),e(this).attr("data-completed")&&(a=this.volume,GM_setValue("G_VIDEO_VOLUME",this.volume)),this.volume==a&&e(this).attr("data-completed",!0)})),e(this).css("position","absolute"),e(this).css("z-index","2"),e(this).attr("data-controls",!0),e(this).attr("controls",!0)}})),ae(i.find("video"),e(this).find('div[role="presentation"] > div[role="button"] > div').first(),"reel")}})))}),250)}function y(e){return new Promise(((t,i)=>{GM_xmlhttpRequest({method:"GET",url:`https://www.instagram.com/graphql/query/?query_hash=45246d3fe16ccc6577e0bd297a5db1ab&variables=%7B%22highlight_reel_ids%22:%5B%22${e}%22%5D,%22precomposed_overlay%22:false%7D`,onload:function(e){try{let i=JSON.parse(e.response);t(i)}catch(e){ie("getHighlightStories()","reject",e.message),i(e)}},onerror:function(e){ie("getHighlightStories()","reject",e),i(e)}})}))}function w(e){return new Promise(((t,i)=>{GM_xmlhttpRequest({method:"GET",url:`https://www.instagram.com/graphql/query/?query_hash=15463e8449a83d3d60b06be7e90627c7&variables=%7B%22reel_ids%22:%5B%22${e}%22%5D,%22precomposed_overlay%22:false%7D`,onload:function(e){try{let i=JSON.parse(e.response);ie("getStories()",i),t(i)}catch(e){ie("getStories()","reject",e.message),i(e)}},onerror:function(e){ie("getStories()","reject",e),i(e)}})}))}function L(e){return new Promise(((t,i)=>{GM_xmlhttpRequest({method:"GET",url:`https://www.instagram.com/web/search/topsearch/?query=${e}`,onload:function(i){let a=JSON.parse(i.response),n=null;a.users.forEach((t=>{t.user.username?.toLowerCase()===e?.toLowerCase()&&(n=t)})),null!=n?(ie("getUserId()",n),t(n)):function(e){return new Promise(((t,i)=>{GM_xmlhttpRequest({method:"GET",url:`https://i.instagram.com/api/v1/users/web_profile_info/?username=${e}`,headers:{"X-IG-App-ID":x()},onload:function(e){try{let a=JSON.parse(e.response),n=a?.data?.user;if(null!=n){let e=a?.data;e.user.pk=e.user.id,ie("getUserIdWithAgent()",a),t(e)}else ie("getUserIdWithAgent()","reject","undefined"),i("undefined")}catch(e){ie("getUserIdWithAgent()","reject",e.message),i(e)}},onerror:function(e){ie("getUserIdWithAgent()","reject",e),i(e)}})}))}(e).then((e=>{t(e)})).catch((e=>{alert("Can not find user info from getUserId()")}))},onerror:function(e){ie("getUserId()","reject",e),i(e)}})}))}function C(e){return new Promise(((t,i)=>{e||i("NOPATH");let a=e;GM_xmlhttpRequest({method:"GET",url:`https://www.instagram.com/graphql/query/?query_hash=2c4c2e343a8f64c625ba02b2aa12c7f8&variables=%7B%22shortcode%22:%22${a}%22}`,headers:{"User-Agent":"Mozilla/5.0 (Linux; Android 10; Pixel 7 XL)Build/RP1A.20845.002; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/5.0 Chrome/117.0.5938.60 Mobile Safari/537.36 Instagram 307.0.0.34.111"},onload:function(e){try{let n=JSON.parse(e.response);ie(n),"fail"===n.status?(ie("Request with:","getBlobMediaWithQuery()",a),function(e){return new Promise(((t,i)=>{e||i("NOPATH"),GM_xmlhttpRequest({method:"GET",url:`https://www.instagram.com/graphql/query/?query_id=9496392173716084&variables={%22shortcode%22:%22${e}%22,%22__relay_internal__pv__PolarisFeedShareMenurelayprovider%22:true,%22__relay_internal__pv__PolarisIsLoggedInrelayprovider%22:true}`,headers:{"User-Agent":"Mozilla/5.0 (Linux; Android 10; Pixel 7 XL)Build/RP1A.20845.002; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/5.0 Chrome/117.0.5938.60 Mobile Safari/537.36 Instagram 307.0.0.34.111","X-IG-App-ID":x()},onload:function(e){try{let a=JSON.parse(e.response);ie(a),"fail"===a.status?(alert(`getBlobMediaWithQueryID(): Request failed with API response:\n${a.message}: ${a.feedback_message}`),ie(`Request failed with API response ${a.message}: ${a.feedback_message}`),i(e)):(ie("getBlobMediaWithQueryID()",a.data),t(a.data))}catch(e){ie("getBlobMediaWithQueryID()","reject",e.message),i(e)}},onerror:function(e){ie("getBlobMediaWithQueryID()","reject",e),i(e)}})}))}(a).then((e=>{t({type:"query_id",data:e.xdt_api__v1__media__shortcode__web_info.items[0]})})).catch((e=>{i(e)}))):t({type:"query_hash",data:n.data})}catch(e){ie("getBlobMedia()","reject",e.message),i(e)}},onerror:function(e){ie("getBlobMedia()","reject",e),i(e)}})}))}function B(t,i){if(!0===i&&(ie("hasReferrer","regenerated"),e('article[data-snig="canDownload"], div[data-snig="canDownload"]').filter((function(){return 0===e(this).find(".SNKMS_IG_DW_MAIN").length})).removeAttr("data-snig")),0==t){const t=100;let i=0;var a=setInterval((()=>{(i>t||e('article[data-snig="canDownload"], section:visible > main > div > div[data-snig="canDownload"] > div > div > div > hr, div[id^="mount"] > div > div > div.x1n2onr6.x1vjfegm div[data-snig="canDownload"]').length>0)&&(clearInterval(a),i>t&&console.warn("onReadyMyDW() Timer","maximum number of repetitions reached, terminated")),ie("onReadyMyDW() Timer","repeating to call detection createDownloadButton()"),k(),i++}),50)}else k()}function x(){let t=null;return e('script[type="application/json"]').each((function(){const i=/"APP_ID":"([0-9]+)"/gi;null!=e(this).text().match(i)&&null==t&&(t=[...e(this).text().matchAll(i)])})),t?t.at(0).at(-1):null}function U(t){t?(e('div[id^="mount"] > div > div > div:first').removeClass("x1s85apg"),e('div[id^="mount"] > div > div > div:first').css("z-index","20000")):(e('div[id^="mount"] > div > div > div:first').addClass("x1s85apg"),e('div[id^="mount"] > div > div > div:first').css("z-index",""))}function W(e){return new Promise(((t,i)=>{let a=`https://i.instagram.com/api/v1/media/${e}/info/`;return null==e?(alert("Can not call Media API because of the media id is invalid."),ie("getMediaInfo()","reject","Can not call Media API because of the media id is invalid."),U(!1),void i(-1)):null==x()?(alert("Can not call Media API because of the app id is invalid."),ie("getMediaInfo()","reject","Can not call Media API because of the app id is invalid."),U(!1),void i(-1)):void GM_xmlhttpRequest({method:"GET",url:a,headers:{"User-Agent":window.navigator.userAgent,Accept:"*/*","X-IG-App-ID":x()},onload:function(e){if(e.finalUrl==a){let i=JSON.parse(e.response);ie("getMediaInfo()",i),t(i)}else{new URL(e.finalUrl).pathname.startsWith("/accounts/login")?(ie("getMediaInfo()","reject","The account must be logged in to access Media API."),alert("The account must be logged in to access Media API.")):(ie("getMediaInfo()","reject",'Unable to retrieve content because the API was redirected to "'+e.finalUrl+'"'),alert('Unable to retrieve content because the API was redirected to "'+e.finalUrl+'"')),U(!1),i(-1)}},onerror:function(e){ie("getMediaInfo()","reject",e),t(e)}})}))}function $(t){var i=0,a=t.find(".x1iyjqo2 > div > div:last-child > div");return null!=a&&a.hasClass("_acnb")||(a=t.find("._aatk > div > div:last-child").eq(0).children("div")),a.filter("._acnb").each((function(t){e(this).hasClass("_acnf")&&(i=t)})),i}function H(i){t.DISABLE_VIDEO_LOOPING&&i.find("video").each((function(){e(this).on("ended",(function(){e(this).data("loop")||(e(this).attr("data-loop",!0),this.pause(),ie("(post) Added video event listener #loop"))}))})),t.MODIFY_VIDEO_VOLUME&&i.find("video").each((function(){e(this).on("play playing",(function(){e(this).data("modify")||(e(this).attr("data-modify",!0),this.volume=a,ie("(post) Added video event listener #modify"))}))})),t.HTML5_VIDEO_CONTROL&&i.find("video").each((function(){if(!e(this).data("controls")){let t=e(this);ie("(post) Added video html5 contorller #modify"),this.volume=a,e(this).on("loadstart",(function(){this.volume=a})),e(this).on("contextmenu",(function(e){e.preventDefault(),t.css("z-index","-1"),t.removeAttr("controls")})),e(this).parent().find("video + div > div").first().on("contextmenu",(function(e){e.preventDefault(),t.css("z-index","2"),t.attr("controls",!0)})),e(this).on("volumechange",(function(){let t=e(this).parent().find("video + div > div").find('button[type="button"], div[role="button"]').filter((function(t){return e(this).width()<=64&&e(this).height()<=64&&e(this).find('svg > path[d^="M16.636 7.028a1.5"], svg > path[d^="M1.5 13.3c-.8"]').length>0}));var i=0===t.find('svg > path[d^="M16.636"]').length;this.muted!=i&&(this.volume=a,t?.click()),e(this).attr("data-completed")&&(a=this.volume,GM_setValue("G_VIDEO_VOLUME",this.volume)),this.volume==a&&e(this).attr("data-completed",!0)})),e(this).css("position","absolute"),e(this).css("z-index","2"),e(this).attr("data-controls",!0),e(this).attr("controls",!0)}})),ae(i.find("video"),i.find("video + div > div").first(),"post","bottom")}function k(){e("article[class], section:visible > main > div > div > div > div > div > hr").map((function(t){return e(this).is("section:visible > main > div > div > div > div > div > hr")?e(this).parent().parent().parent().parent()[0]:this})).filter((function(){return e(this).height()>0&&e(this).width()>0})).each((function(i){if(!e(this).attr("data-snig")&&!e(this).hasClass("x1iyjqo2")&&!e(this).children("article")?.hasClass("x1iyjqo2")&&0===e(this).parents("div#scrollview").length){ie("Found post container",e(this));var a=e(this),n=this.tagName;if("DIV"===n&&0!=i)return;const d=a.children("div").children("div");if(0===d.length)return;if(ie("Found insert point",d),a.find("._acay").length>0){a.find("._acay + .x24i39r").length>0&&a.find("._acay + .x24i39r").css("top","37px");const e=a.find("._acay").first().parent()[0];new MutationObserver((function(e,t){a.find("._acay + .x24i39r").css("top","37px")})).observe(e,{childList:!0})}const c=`<div data-ih-locale-title="DW" title="${K("DW")}" class="SNKMS_IG_DW_MAIN" style="right:15px;top:15px;">${o}</div>`,h=`<div data-ih-locale-title="NEW_TAB" title="${K("NEW_TAB")}" class="SNKMS_IG_NEWTAB_MAIN" style="right:50px;top:15px;">${r}</div>`,_=`<div data-ih-locale-title="THUMBNAIL_INTRO" title="${K("THUMBNAIL_INTRO")}" class="SNKMS_IG_THUMBNAIL_MAIN" style="right:85px;top:15px;">${l}</div>`;d.eq("DIV"===n?0:d.length-2).append(c),d.eq("DIV"===n?0:d.length-2).append(h),setTimeout((()=>{if(0===d.eq("DIV"===n?0:d.length-2).find("div > ul li._acaz").length)d.find("video").length>0&&d.eq("DIV"===n?0:d.length-2).append(_);else{const t=new IntersectionObserver(((t,i)=>{t.forEach((t=>{t.isIntersecting&&(e(t.target).find("video").length>0?(d.eq("DIV"===n?0:d.length-2).append(_),H(a)):d.find(".SNKMS_IG_THUMBNAIL_MAIN")?.remove())}))}),{root:a.find("div > ul._acay").first().parent().parent().parent()[0],rootMargin:"0px",threshold:.1}),i=new MutationObserver((function(i,a){var n=i.at(0)?.target;e(n).find("li._acaz").each((function(){t.observe(this)}))}));a.find("div > ul li._acaz").each((function(){t.observe(this)}));const s=d.eq("DIV"===n?0:d.length-2).find("div > ul li._acaz")?.parent()[0],o=d.eq("DIV"===n?0:d.length-2).find("div > ul li._acaz")?.parent().parent()[0];s&&i.observe(s,{childList:!0}),o&&i.observe(o,{attributes:!0})}}),50),d.css("position","relative"),H(a),e(this).on("click",".SNKMS_IG_THUMBNAIL_MAIN",(function(t){U(!0),I=e(this).parent().parent().parent().attr("data-username"),p=location.pathname.replace(/\/$/,"").split("/").at(-1)||e(this).parent().parent().parent().find('a[href^="/p/"]').first().attr("href").split("/").at(2)||e(this).parent().parent().children("div:last-child").children("div").children("div:last-child").find('a[href^="/p/"]').last().attr("href").split("/").at(2);var i=$(e(this).parent().parent().parent());Y(!0,!1),P(p,".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY","").then((()=>{let t=setInterval((()=>{if(e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY a").length>0){clearInterval(t);var a=e('.IG_SN_DIG .IG_SN_DIG_BODY a[data-globalindex="'+(i+1)+'"]')?.parent().find(".videoThumbnail")?.first();null!=a&&a.length>0?a.click():alert("Can not find thumbnail url."),U(!1),e(".IG_SN_DIG").remove()}}),250)}))})),e(this).on("click",".SNKMS_IG_NEWTAB_MAIN",(function(i){U(!0),I=e(this).parent().parent().parent().attr("data-username"),p=location.pathname.replace(/\/$/,"").split("/").at(-1)||e(this).parent().parent().parent().find('a[href^="/p/"]').first().attr("href").split("/").at(2)||e(this).parent().parent().children("div:last-child").children("div").children("div:last-child").find('a[href^="/p/"]').last().attr("href").split("/").at(2);var a=$(e(this).parent().parent().parent());Y(!0,!1),P(p,".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY","").then((()=>{let i=setInterval((()=>{if(e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY a").length>0){clearInterval(i);var n=e('.IG_SN_DIG .IG_SN_DIG_BODY a[data-globalindex="'+(a+1)+'"]');if(t.FORCE_RESOURCE_VIA_MEDIA&&t.NEW_TAB_ALWAYS_FORCE_MEDIA_IN_POST)F(n.first()[0],!0);else{let e=n?.attr("data-href");if(e){var s=new URL(e);s.host="scontent.cdninstagram.com",ee(s.href)}else alert("Can not find open tab url.")}U(!1),e(".IG_SN_DIG").remove()}}),250)}))})),e(this).on("click",".SNKMS_IG_DW_MAIN",(async function(i){if(I=e(this).parent().parent().parent().attr("data-username"),p=location.pathname.replace(/\/$/,"").split("/").at(-1)||e(this).parent().parent().parent().find('a[href^="/p/"]').first().attr("href").split("/").at(2)||e(this).parent().parent().children("div:last-child").children("div").children("div:last-child").find('a[href^="/p/"]').last().attr("href").split("/").at(2),Y(t.DIRECT_DOWNLOAD_ALL,!0),e("#article-id").html(`<a href="https://www.instagram.com/p/${p}">${p}</a>`),t.DIRECT_DOWNLOAD_VISIBLE_RESOURCE){U(!0),n=!0,e(".IG_SN_DIG").length&&(n?e(".IG_SN_DIG").addClass("hidden"):e(".IG_SN_DIG").removeClass("hidden"));var a=$(e(this).parent().parent().parent());P(p,".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY","").then((()=>{let t=setInterval((()=>{if(e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY a").length>0){clearInterval(t);var i=e('.IG_SN_DIG .IG_SN_DIG_BODY a[data-globalindex="'+(a+1)+'"]')?.attr("data-href");i?(U(!1),e('.IG_SN_DIG .IG_SN_DIG_BODY a[data-globalindex="'+(a+1)+'"]')?.click()):alert("Can not find download url."),e(".IG_SN_DIG").remove()}}),250)}))}else{var n;if(!t.DIRECT_DOWNLOAD_ALL){var s=0,o=e(this).parent().parent().find("._acay ._acaz").length,d=window.location.pathname,c=(d.split("/")[1],d.split("/")[2],t.FORCE_FETCH_ALL_RESOURCES),h=new Date(e(this).parent().parent().find('a[href^="/p/"] time[datetime]').first().attr("datetime")).getTime();if(o)e(this).parent().find("._acay ._acaz").each((function(){let t=e(this).parent().parent().find("video");t&&t.attr("src")&&(c=!0)})),c||t.FORCE_RESOURCE_VIA_MEDIA?P(p,".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY",K("LOAD_BLOB_MULTIPLE")):(e(this).parent().find("._acay ._acaz").each((function(){s++;let t=e(this).find("video"),i=e(this).find("._aagv img"),a=i.attr("srcset")?i.attr("srcset").split(" ")[0]:i.attr("src");t&&t.attr("src")&&(c=!0),i&&a&&e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY").append(`<a datetime="${h}" data-needed="direct" data-path="${p}" data-name="photo" data-type="jpg" data-globalIndex="${s}" href="javascript:;" data-href="${a}"><img width="100" src="${a}" /><br/>- <span data-ih-locale="IMG">${K("IMG")}</span> ${s} -</a>`)})),c&&P(p,".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY",K("LOAD_BLOB_RELOAD")));else if(t.FORCE_RESOURCE_VIA_MEDIA)P(p,".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY",K("LOAD_BLOB_MULTIPLE"));else{s++;let t=e(this).parent().parent().find("video"),i=e(this).parent().parent().find("._aagv img"),a=i.attr("srcset")?i.attr("srcset").split(" ")[0]:i.attr("src");t&&t.attr("src")&&P(p,".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY",K("LOAD_BLOB_ONE")),i&&a&&e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY").append(`<a datetime="${h}" data-needed="direct" data-path="${p}" data-name="photo" data-type="jpg" data-globalIndex="${s}" href="javascript:;" href="" data-href="${a}"><img width="100" src="${a}" /><br/>- <span data-ih-locale="IMG">${K("IMG")}</span> ${s} -</a>`)}}e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY a").each((function(){e(this).wrap("<div></div>"),e(this).before('<label class="inner_box_wrapper"><input class="inner_box" type="checkbox"><span></span></label>'),e(this).after(`<div data-ih-locale-title="NEW_TAB" title="${K("NEW_TAB")}" class="newTab">${r}</div>`),"video"==e(this).attr("data-name")&&e(this).after(`<div data-ih-locale-title="THUMBNAIL_INTRO" title="${K("THUMBNAIL_INTRO")}" class="videoThumbnail">${l}</div>`)})),t.DIRECT_DOWNLOAD_ALL&&P(p,".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY",K("LOAD_BLOB_MULTIPLE")).then((()=>{let t=setInterval((()=>{e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY a").length>0&&(clearInterval(t),e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY a").each((function(){e(this).click()})),e(".IG_SN_DIG").remove())}),250)}))}}));var s=e(this).find("header > div:last-child > div:first-child span a").first().text()||e(this).find('a[href^="/"]').filter((function(){return e(this)?.text()?.length>0})).first().text();e(this).attr("data-snig","canDownload"),e(this).attr("data-username",s)}}))}function P(t,i,a){return new Promise((async n=>{e(`${i} a`).remove(),e(i).append('<p id="_SNLOAD">'+a+"</p>");let s=await C(t);if("query_hash"===s.type){let t=1,a=s.data.shortcode_media;if("GraphVideo"==a.__typename&&a.video_url&&(e(i).append(`<a media-id="${a.id}" datetime="${a.taken_at_timestamp}" data-blob="true" data-needed="direct" data-path="${a.shortcode}" data-name="video" data-type="mp4" data-username="${a.owner.username}" data-globalIndex="${t}" href="javascript:;" data-href="${a.video_url}"><img width="100" src="${a.display_resources[1].src}" /><br/>- <span data-ih-locale="VID">${K("VID")}</span> ${t} -</a>`),t++),"GraphImage"==a.__typename&&(e(i).append(`<a media-id="${a.id}" datetime="${a.taken_at_timestamp}" data-blob="true" data-needed="direct" data-path="${a.shortcode}" data-name="photo" data-type="jpg" data-username="${a.owner.username}" data-globalIndex="${t}" href="javascript:;" data-href="${a.display_resources[a.display_resources.length-1].src}"><img width="100" src="${a.display_resources[1].src}" /><br/>- <span data-ih-locale="IMG">${K("IMG")}</span> ${t} -</a>`),t++),"GraphSidecar"==a.__typename&&a.edge_sidecar_to_children)for(let n of a.edge_sidecar_to_children.edges)"GraphVideo"==n.node.__typename&&e(i).append(`<a media-id="${n.node.id}" datetime="${a.taken_at_timestamp}" data-blob="true" data-needed="direct" data-path="${a.shortcode}" data-name="video" data-type="mp4" data-username="${a.owner.username}" data-globalIndex="${t}" href="javascript:;" data-href="${n.node.video_url}"><img width="100" src="${n.node.display_resources[1].src}" /><br/>- <span data-ih-locale-title="VID">${K("VID")}</span> ${t} -</a>`),"GraphImage"==n.node.__typename&&e(i).append(`<a media-id="${n.node.id}" datetime="${a.taken_at_timestamp}" data-blob="true" data-needed="direct" data-path="${a.shortcode}" data-name="photo" data-type="jpg" data-username="${a.owner.username}" data-globalIndex="${t}" href="javascript:;" data-href="${n.node.display_resources[n.node.display_resources.length-1].src}"><img width="100" src="${n.node.display_resources[1].src}" /><br/>- <span data-ih-locale="IMG">${K("IMG")}</span> ${t} -</a>`),t++}else{let t=s.data;if(t.carousel_media)ie("carousel_media"),t.carousel_media.forEach(((a,n)=>{let s=n+1;null==a.video_versions?(a.image_versions2.candidates.sort((function(e,t){return e.width<t.width?1:e.width>t.width?-1:0})),e(i).append(`<a media-id="${a.pk}" datetime="${a.taken_at}" data-blob="true" data-needed="direct" data-path="${t.code}" data-name="photo" data-type="jpg" data-username="${t.owner.username}" data-globalIndex="${s}" href="javascript:;" data-href="${a.image_versions2.candidates[0].url}"><img width="100" src="${a.image_versions2.candidates[0].url}" /><br/>- <span data-ih-locale="IMG">${K("IMG")}</span> ${s} -</a>`)):e(i).append(`<a media-id="${a.pk}" datetime="${a.taken_at}" data-blob="true" data-needed="direct" data-path="${t.code}" data-name="video" data-type="mp4" data-username="${t.owner.username}" data-globalIndex="${s}" href="javascript:;" data-href="${a.video_versions[0].url}"><img width="100" src="${a.image_versions2.candidates[0].url}" /><br/>- <span data-ih-locale="VID">${K("VID")}</span> ${s} -</a>`)}));else{let a=1;null==t.video_versions?(t.image_versions2.candidates.sort((function(e,t){return e.width<t.width?1:e.width>t.width?-1:0})),e(i).append(`<a media-id="${t.pk}" datetime="${t.taken_at}" data-blob="true" data-needed="direct" data-path="${t.code}" data-name="photo" data-type="jpg" data-username="${t.owner.username}" data-globalIndex="${a}" href="javascript:;" data-href="${t.image_versions2.candidates[0].url}"><img width="100" src="${t.image_versions2.candidates[0].url}" /><br/>- <span data-ih-locale="IMG">${K("IMG")}</span> ${a} -</a>`)):e(i).append(`<a media-id="${t.pk}" datetime="${t.taken_at}" data-blob="true" data-needed="direct" data-path="${t.code}" data-name="video" data-type="mp4" data-username="${t.owner.username}" data-globalIndex="${a}" href="javascript:;" data-href="${t.video_versions[0].url}"><img width="100" src="${t.image_versions2.candidates[0].url}" /><br/>- <span data-ih-locale="VID">${K("VID")}</span> ${a} -</a>`)}}e("#_SNLOAD").remove(),e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_BODY a").each((function(){e(this).wrap("<div></div>"),e(this).before('<label class="inner_box_wrapper"><input class="inner_box" type="checkbox"><span></span></label>'),e(this).after(`<div data-ih-locale-title="NEW_TAB" title="${K("NEW_TAB")}" class="newTab">${r}</div>`),"video"==e(this).attr("data-name")&&e(this).after(`<div data-ih-locale-title="THUMBNAIL_INTRO" title="${K("THUMBNAIL_INTRO")}" class="videoThumbnail">${l}</div>`)})),n(!0)}))}function Y(t,i){let a=t?"hidden":"";e("body").append('<div class="IG_SN_DIG '+a+'"><div class="IG_SN_DIG_BG"></div><div class="IG_SN_DIG_MAIN"><div class="IG_SN_DIG_TITLE"></div><div class="IG_SN_DIG_BODY"></div></div></div>'),e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_TITLE").append(`<div style="position:relative;min-height:36px;text-align:center;margin-bottom: 7px;"><div style="position:absolute;left:0px;line-height: 18px;"><kbd>Alt</kbd>+<kbd>Q</kbd> [<span data-ih-locale="CLOSE">${K("CLOSE")}</span>]</div><div style="line-height: 18px;">IG Helper</div><div id="post_info" style="line-height: 14px;font-size:14px;">Post ID: <span id="article-id"></span></div><div class="IG_SN_DIG_BTN">${d}</div></div>`),i&&(e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_TITLE").append('<div style="text-align: center;" id="button_group"></div>'),e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_TITLE > div#button_group").append(`<button id="batch_download_selected" data-ih-locale="BATCH_DOWNLOAD_SELECTED">${K("BATCH_DOWNLOAD_SELECTED")}</button>`),e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_TITLE > div#button_group").append(`<button id="batch_download_direct" data-ih-locale="BATCH_DOWNLOAD_DIRECT">${K("BATCH_DOWNLOAD_DIRECT")}</button>`),e(".IG_SN_DIG .IG_SN_DIG_MAIN .IG_SN_DIG_TITLE").append(`<label class="checkbox"><input value="yes" type="checkbox" /><span data-ih-locale="ALL_CHECK">${K("ALL_CHECK")}</span></label>`))}function V(e,i,a,n,o,r){setTimeout((()=>{U(!0),fetch(e).then((l=>l.blob().then((l=>{U(!1),function(e,i,a,n,o,r,l){o=parseInt(o.toString().padEnd(13,"0")),t.RENAME_PUBLISH_DATE&&(o=parseInt(o.toString().padEnd(13,"0")));const d=new Date(o),c=document.createElement("a"),h=new URL(e).pathname.split("/").at(-1).split(".").slice(0,-1).join("."),_=d.getFullYear().toString(),p=(d.getMonth()+1).toString().padStart(2,"0"),I=d.getDate().toString().padStart(2,"0"),u=d.getHours().toString().padStart(2,"0"),m=d.getMinutes().toString().padStart(2,"0"),v=d.getSeconds().toString().padStart(2,"0");var f=s.toUpperCase(),g=l??"",D={"%USERNAME%":a,"%SOURCE_TYPE%":n,"%SHORTCODE%":g,"%YEAR%":_,"%2-YEAR%":_.substr(-2),"%MONTH%":p,"%DAY%":I,"%HOUR%":u,"%MINUTE%":m,"%SECOND%":v,"%ORIGINAL_NAME%":h,"%ORIGINAL_NAME_FIRST%":h.split("_").at(0)};f=f.replace(/%[\w\-]+%/g,(function(e){return D[e]||e}));const E=a+"_"+h+"."+r;c.href=URL.createObjectURL(i),c.setAttribute("download",t.AUTO_RENAME?f+"."+r:E),c.click(),c.remove()}(e,l,i,a,n,o,r)}))))}),50)}async function F(i,a){let n=(new Date).getTime(),s=Math.floor(n/1e3),o=e(i).attr("data-username")?e(i).attr("data-username"):I;var r;if(!o&&e(i).attr("data-path")&&(ie("catching owner name from shortcode:",e(i).attr("data-href")),o=await(r=e(i).attr("data-path"),new Promise(((e,t)=>{r||t("NOPATH"),GM_xmlhttpRequest({method:"GET",url:`https://www.instagram.com/graphql/query/?query_hash=2c4c2e343a8f64c625ba02b2aa12c7f8&variables=%7B%22shortcode%22:%22${r}%22}`,onload:function(i){try{let t=JSON.parse(i.response);ie("getPostOwner()",t),e(t.data.shortcode_media.owner.username)}catch(e){ie("getPostOwner()","reject",e.message),t(e)}},onerror:function(e){ie("getPostOwner()","reject",e),t(e)}})}))).catch((e=>{ie("get username failed, replace with default string, error message:",e.message)})),null==o&&(o="NONE")),t.RENAME_PUBLISH_DATE&&e(i).attr("datetime")&&(s=parseInt(e(i).attr("datetime"))),t.FORCE_RESOURCE_VIA_MEDIA){U(!0);let n=await W(e(i).attr("media-id"));if(U(!1),"ok"===n.status){var l=null;if(n.items[0].video_versions?l=n.items[0].video_versions[0].url:(n.items[0].image_versions2.candidates.sort((function(e,t){return e.width<t.width?1:e.width>t.width?-1:0})),l=n.items[0].image_versions2.candidates[0].url),a){let e=new URL(l);e.host="scontent.cdninstagram.com",ee(e.href)}else V(l,o,e(i).attr("data-name"),s,e(i).attr("data-type"),e(i).attr("data-path"))}else{if(t.USE_BLOB_FETCH_WHEN_MEDIA_RATE_LIMIT)if(a){let t=new URL(e(i).attr("data-href"));t.host="scontent.cdninstagram.com",ee(t.href)}else V(e(i).attr("data-href"),o,e(i).attr("data-name"),s,e(i).attr("data-type"),e(i).attr("data-path"));else alert("Fetch failed from Media API. API response message: "+n.message);ie(n)}}else V(e(i).attr("data-href"),o,e(i).attr("data-name"),s,e(i).attr("data-type"),e(i).attr("data-path"))}async function j(e){return new Promise(((t,i)=>{GM_xmlhttpRequest({method:"GET",url:`https://raw.githubusercontent.com/SN-Koarashi/ig-helper/master/locale/translations/${e}.json`,onload:function(e){try{let i=JSON.parse(e.response);t(i)}catch(e){i(e)}},onerror:function(e){ie("getTranslationText()","reject",e),i(e)}})}))}function K(e){const t=(i=Object.assign({},{"en-US":{NOTICE_UPDATE_TITLE:"Wololo! New version released.",NOTICE_UPDATE_CONTENT:"IG-Helper has released a new version, click here to update.",CHECK_UPDATE:"Checking for Script Updates",CHECK_UPDATE_MENU:"Checking for Updates",CHECK_UPDATE_INTRO:"Check for updates when the script is triggered (check every 300 seconds).\nUpdate notifications will be sent as desktop notifications through the browser.",RELOAD_SCRIPT:"Reload Script",DONATE:"Donate",FEEDBACK:"Feedback",NEW_TAB:"Open in New Tab",SHOW_DOM_TREE:"Show DOM Tree",SELECT_AND_COPY:"Select All and Copy from the Input Box",DOWNLOAD_DOM_TREE:"Download DOM Tree as a Text File",REPORT_GITHUB:"Report an Issue on GitHub",REPORT_DISCORD:"Report an Issue on Discord Support Server",REPORT_FORK:"Report an Issue on Greasy Fork",DEBUG:"Debug Window",CLOSE:"Close",ALL_CHECK:"Select All",BATCH_DOWNLOAD_SELECTED:"Download Selected Resources",BATCH_DOWNLOAD_DIRECT:"Download All Resources",IMG:"Image",VID:"Video",DW:"Download",THUMBNAIL_INTRO:"Download Video Thumbnail",LOAD_BLOB_ONE:"Loading Blob Media...",LOAD_BLOB_MULTIPLE:"Loading Blob Media and Others...",LOAD_BLOB_RELOAD:"Detecting Blob Media, reloading...",NO_CHECK_RESOURCE:"You need to select a resource to download.",NO_VID_URL:"Cannot find video URL.",SETTING:"Settings",AUTO_RENAME:"Automatically Rename Files (Right-Click to Set)",RENAME_SHORTCODE:"Rename the File and Include Shortcode",RENAME_PUBLISH_DATE:"Set Renamed File Timestamp to Resource Publish Date",RENAME_LOCATE_DATE:"Modify Renamed File Timestamp Date Format (Right-Click to Set)",DISABLE_VIDEO_LOOPING:"Disable Video Auto-looping",HTML5_VIDEO_CONTROL:"Display HTML5 Video Controller",REDIRECT_CLICK_USER_STORY_PICTURE:"Redirect When Clicking on User's Story Picture",FORCE_FETCH_ALL_RESOURCES:"Force Fetch All Resources in the Post",DIRECT_DOWNLOAD_VISIBLE_RESOURCE:"Directly Download the Visible Resources in the Post",DIRECT_DOWNLOAD_ALL:"Directly Download All Resources in the Post",MODIFY_VIDEO_VOLUME:"Modify Video Volume (Right-Click to Set)",SCROLL_BUTTON:"Enable Scroll Buttons for Reels Page",FORCE_RESOURCE_VIA_MEDIA:"Force Fetch Resource via Media API",USE_BLOB_FETCH_WHEN_MEDIA_RATE_LIMIT:"Use Alternative Methods to Download When the Media API is Not Accessible",NEW_TAB_ALWAYS_FORCE_MEDIA_IN_POST:"Always Use Media API for 'Open in New Tab' in Posts",AUTO_RENAME_INTRO:"Auto rename file to custom format:\nCustom Format List: \n%USERNAME% - Username\n%SOURCE_TYPE% - Download Source\n%SHORTCODE% - Post Shortcode\n%YEAR% - Year when downloaded/published\n%2-YEAR% - Year (last two digits) when downloaded/published\n%MONTH% - Month when downloaded/published\n%DAY% - Day when downloaded/published\n%HOUR% - Hour when downloaded/published\n%MINUTE% - Minute when downloaded/published\n%SECOND% - Second when downloaded/published\n%ORIGINAL_NAME% - Original name of downloaded file\n%ORIGINAL_NAME_FIRST% - Original name of downloaded file (first part of name)\n\nIf set to false, the file name will remain unchanged.\nExample: instagram_321565527_679025940443063_4318007696887450953_n.jpg",RENAME_SHORTCODE_INTRO:"Auto rename file to the following format:\nUSERNAME-TYPE-SHORTCODE-TIMESTAMP.FILETYPE\nExample: instagram-photo-CwkxyiVynpW-1670350000.jpg\n\nThis will ONLY work if [Automatically Rename Files] is set to TRUE.",RENAME_PUBLISH_DATE_INTRO:"Sets the timestamp in the file rename format to the resource publish date (browser time zone).\n\nThis feature only works when [Automatically Rename Files] is set to TRUE.",RENAME_LOCATE_DATE_INTRO:"Modify the renamed file timestamp date format to the browser's local time, and format it to your preferred regional date format.\n\nThis feature only works when [Automatically Rename Files] is set to TRUE.",DISABLE_VIDEO_LOOPING_INTRO:"Disable video auto-looping in Reels and posts.",HTML5_VIDEO_CONTROL_INTRO:"Display the HTML5 video controller in video resource.\n\nThis will hide the custom video volume slider and replace it with the HTML5 controller. The HTML5 controller can be hidden by right-clicking on the video to reveal the original details.",REDIRECT_CLICK_USER_STORY_PICTURE_INTRO:"Redirect to a user's profile page when right-clicking on their avatar in the story area on the homepage.\nIf you use the middle mouse button to click, it will open in a new tab.",FORCE_FETCH_ALL_RESOURCES_INTRO:"Force fetching of all resources (photos and videos) in a post via the Instagram API to remove the limit of three resources per post.",DIRECT_DOWNLOAD_VISIBLE_RESOURCE_INTRO:"Directly download the current resources available in the post.",DIRECT_DOWNLOAD_ALL_INTRO:"When you click the download button, all resources in the post will be forcibly fetched and downloaded.",MODIFY_VIDEO_VOLUME_INTRO:"Modify the video playback volume in Reels and posts (right-click to open the volume setting slider).",SCROLL_BUTTON_INTRO:"Enable scroll buttons for the lower right corner of the Reels page.",FORCE_RESOURCE_VIA_MEDIA_INTRO:"The Media API will try to get the highest quality photo or video possible, but it may take longer to load.",USE_BLOB_FETCH_WHEN_MEDIA_RATE_LIMIT_INTRO:"When the Media API reaches its rate limit or cannot be used for other reasons, the Forced Fetch API will be used to download resources (the resource quality may be slightly lower).",NEW_TAB_ALWAYS_FORCE_MEDIA_IN_POST_INTRO:"The [Open in New Tab] button in posts will always use the Media API to obtain high-resolution resources.",SKIP_VIEW_STORY_CONFIRM:"Skip the Confirmation Page for Viewing a Story/Highlight",SKIP_VIEW_STORY_CONFIRM_INTRO:"Automatically skip when confirmation page is shown in story or highlight."}},v),Object.keys(i).sort().reduce(((e,t)=>(e[t]=i[t],e)),{}));var i;return null!=t[f]&&null!=t[f][e]?t[f][e]:t["en-US"][e]}function q(){e("[data-ih-locale]").each((function(){e(this).text(K(e(this).attr("data-ih-locale")))})),e("[data-ih-locale-title]").each((function(){e(this).attr("title",K(e(this).attr("data-ih-locale-title")))}))}function z(){for(let e of m)ie("GM_unregisterMenuCommand",e),GM_unregisterMenuCommand(e);m.push(GM_registerMenuCommand(K("SETTING"),(()=>{X()}),{accessKey:"w"})),m.push(GM_registerMenuCommand(K("DONATE"),(()=>{GM_openInTab("https://ko-fi.com/snkoarashi",{active:!0})}),{accessKey:"d"})),m.push(GM_registerMenuCommand(K("DEBUG"),(()=>{Z()}),{accessKey:"z"})),m.push(GM_registerMenuCommand(K("FEEDBACK"),(()=>{e(".IG_SN_DIG").remove(),Y(),e(".IG_SN_DIG #post_info").text("Feedback Options"),e(".IG_SN_DIG .IG_SN_DIG_BODY").append('<span style="display:block;text-align:center;">'),e(".IG_SN_DIG .IG_SN_DIG_BODY span").append(`<button style="margin: 3px;" class="IG_REPORT_FORK"><a href="https://greasyfork.org/en/scripts/404535-ig-helper/feedback" target="_blank">${K("REPORT_FORK")}</a></button>`),e(".IG_SN_DIG .IG_SN_DIG_BODY span").append(`<button style="margin: 3px;" class="IG_REPORT_GITHUB"><a href="https://github.com/SN-Koarashi/ig-helper/issues" target="_blank">${K("REPORT_GITHUB")}</a></button>`),e(".IG_SN_DIG .IG_SN_DIG_BODY span").append(`<button style="margin: 3px;" class="IG_REPORT_DISCORD"><a href="https://discord.gg/q3KT4hdq8x" target="_blank">${K("REPORT_DISCORD")}</a></button>`)}),{accessKey:"f"})),m.push(GM_registerMenuCommand(K("CHECK_UPDATE_MENU"),(()=>{Q()}),{accessKey:"c"})),m.push(GM_registerMenuCommand(K("RELOAD_SCRIPT"),(()=>{te()}),{accessKey:"r"}))}function J(e){if(!t.CHECK_UPDATE)return;const i=GM_getValue("G_CHECK_TIMESTAMP")??(new Date).getTime();(new Date).getTime()>parseInt(i)+1e3*e&&(GM_setValue("G_CHECK_TIMESTAMP",(new Date).getTime()),Q())}function Q(){const e=GM_info.script.version;GM_xmlhttpRequest({method:"GET",url:"https://raw.githubusercontent.com/SN-Koarashi/ig-helper/refs/heads/master/main.js",onload:function(t){const i=t.responseText.match(/\/\/\s+@version\s+([0-9.\-a-zA-Z]+)/i);if(i&&i[1]){const t=i[1];ie("Current version: ",e,"|","Remote version: ",t),t!==e?GM_notification({text:K("NOTICE_UPDATE_CONTENT"),title:K("NOTICE_UPDATE_TITLE"),tag:"ig_helper_notice",highlight:!0,timeout:5e3,zombieTimeout:5e3,image:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Instagram_icon.png/64px-Instagram_icon.png",onclick:e=>{e?.preventDefault();var t=GM_openInTab(GM_info.script.downloadURL);setTimeout((()=>{t.close()}),250)}}):ie("there is no new update")}else console.error("Could not find version in the remote script.")}})}function X(){e(".IG_SN_DIG").remove(),Y(),e(".IG_SN_DIG #post_info").text("Preference Settings"),e(".IG_SN_DIG .IG_SN_DIG_TITLE > div").append('<select id="langSelect"></select><div style="font-size: 12px;">Some texts are machine-translated and may be inaccurate; translation contributions are welcome on GitHub.</div>');for(let t in h)e(".IG_SN_DIG .IG_SN_DIG_TITLE > div #langSelect").append(`<option value="${t}" ${f==t?"selected":""}>${h[t]}</option>`);for(let n in t)e(".IG_SN_DIG .IG_SN_DIG_BODY").append(`<label class="globalSettings${i.includes(n)?" child":""}" title="${K(n+"_INTRO")}" data-ih-locale-title="${n+"_INTRO"}"><span data-ih-locale="${n}">${K(n)}</span> <input id="${n}" value="box" type="checkbox" ${!0===t[n]?"checked":""}><div class="chbtn"><div class="rounds"></div></div></label>`),"MODIFY_VIDEO_VOLUME"===n&&e('.IG_SN_DIG .IG_SN_DIG_BODY input[id="'+n+'"]').parent("label").on("contextmenu",(function(t){t.preventDefault(),0===e(this).find("#tempWrapper").length&&(e(this).append('<div id="tempWrapper"></div>'),e(this).children("#tempWrapper").append('<input value="'+a+'" type="range" min="0" max="1" step="0.05" />'),e(this).children("#tempWrapper").append('<input value="'+a+'" step="0.05" type="number" />'),e(this).children("#tempWrapper").append(`<div class="IG_SN_DIG_BTN">${d}</div>`))})),"AUTO_RENAME"===n&&e('.IG_SN_DIG .IG_SN_DIG_BODY input[id="'+n+'"]').parent("label").on("contextmenu",(function(t){t.preventDefault(),0===e(this).find("#tempWrapper").length&&(e(this).append('<div id="tempWrapper"></div>'),e(this).children("#tempWrapper").append('<input id="date_format" value="'+s+'" />'),e(this).children("#tempWrapper").append(`<div class="IG_SN_DIG_BTN">${d}</div>`))}))}function Z(){e(".IG_SN_DIG").remove(),Y(),e(".IG_SN_DIG #post_info").text("IG Debug DOM Tree"),e(".IG_SN_DIG .IG_SN_DIG_BODY").append('<textarea style="font-family: monospace;width:100%;box-sizing: border-box;height:300px;background: transparent;" readonly></textarea>'),e(".IG_SN_DIG .IG_SN_DIG_BODY").append('<span style="display:block;text-align:center;">'),e(".IG_SN_DIG .IG_SN_DIG_BODY span").append(`<button style="margin: 3px;" class="IG_DISPLAY_DOM_TREE"><a>${K("SHOW_DOM_TREE")}</a></button>`),e(".IG_SN_DIG .IG_SN_DIG_BODY span").append(`<button style="margin: 3px;" class="IG_SELECT_DOM_TREE"><a>${K("SELECT_AND_COPY")}</a></button>`),e(".IG_SN_DIG .IG_SN_DIG_BODY span").append(`<button style="margin: 3px;" class="IG_DOWNLOAD_DOM_TREE"><a>${K("DOWNLOAD_DOM_TREE")}</a></button><br/>`),e(".IG_SN_DIG .IG_SN_DIG_BODY span").append(`<button style="margin: 3px;" class="IG_REPORT_GITHUB"><a href="https://github.com/SN-Koarashi/ig-helper/issues" target="_blank">${K("REPORT_GITHUB")}</a></button>`),e(".IG_SN_DIG .IG_SN_DIG_BODY span").append(`<button style="margin: 3px;" class="IG_REPORT_DISCORD"><a href="https://discord.gg/q3KT4hdq8x" target="_blank">${K("REPORT_DISCORD")}</a></button>`)}function ee(e){var t=document.createElement("a");t.href=e,t.target="_blank",document.body.appendChild(t),t.click(),t.remove()}function te(){clearInterval(u),e(".SNKMS_IG_NEWTAB_MAIN, .SNKMS_IG_DW_MAIN, .SNKMS_IG_THUMBNAIL_MAIN").remove(),e(".IG_DWPROFILE, .IG_DWPROFILE, .IG_DWSTORY, .IG_DWSTORY_THUMBNAIL, .IG_DWNEWTAB, .IG_DWHISTORY, .IG_DWHINEWTAB, .IG_DWHISTORY_THUMBNAIL, .IG_REELS, .IG_REELS_NEWTAB, .IG_REELS_THUMBNAIL").remove(),e("[data-snig]").removeAttr("data-snig"),E=!1,D=!1,g=location.href,N.disconnect(),ie("main timer re-register completed")}function ie(...e){var t=new Date;G.push({time:t.getTime(),content:[...e]}),G.length>1e3&&(G=[{time:t.getTime(),content:["logger sliced"]},...G.slice(-999)]),console.log(`[${t.toISOString()}]`,...e)}function ae(t,i,n,s=""){0===i.find("div.volume_slider").length?(i.append(`<div class="volume_slider ${s}" />`),i.find("div.volume_slider").append(`<div><input type="range" max="1" min="0" step="0.05" value="${a}" /></div>`),i.find("div.volume_slider input").attr("style","--ig-track-progress: "+(100*a+"%")),i.find("div.volume_slider input").on("input",(function(){var i=100*e(this).val()+"%";a=e(this).val(),GM_setValue("G_VIDEO_VOLUME",e(this).val()),e(this).attr("style",`--ig-track-progress: ${i}`),t.each((function(){ie(`(${n})`,"video volume changed #slider"),this.volume=a}))})),i.find("div.volume_slider input").on("mouseenter",(function(){var i=100*a+"%";e(this).attr("style",`--ig-track-progress: ${i}`),e(this).val(a),t.each((function(){ie(`(${n})`,"video volume changed #slider"),this.volume=a}))})),i.find("div.volume_slider").on("click",(function(e){e.stopPropagation(),e.preventDefault()}))):i.find("div.volume_slider").remove()}e((function(){function i(){let t=e('div[id^="mount"]')[0];var i="";G.forEach((e=>{var t=JSON.stringify(e.content,(function(e,t){return Array.isArray(this)&&"object"==typeof t&&t instanceof jQuery?function(e){var t=[];for(var i of e)t.push({tagName:i.tagName,id:i.id,className:i.className});return t}(t):t}),"\t");i+=`${e.time}: ${t}\n`})),e(".IG_SN_DIG .IG_SN_DIG_BODY textarea").text("Logger:\n"+i+"\n-----\n\nLocation: "+location.pathname+"\nDOM Tree with div#mount:\n"+t.innerHTML)}e("body").on("click",".IG_SN_DIG .IG_SN_DIG_BODY .IG_DISPLAY_DOM_TREE",(function(){i()})),e("body").on("click",".IG_SN_DIG .IG_SN_DIG_BODY .IG_SELECT_DOM_TREE",(function(){e(".IG_SN_DIG .IG_SN_DIG_BODY textarea").select(),document.execCommand("copy")})),e("body").on("click",".IG_SN_DIG .IG_SN_DIG_BODY .IG_DOWNLOAD_DOM_TREE",(function(){0===e(".IG_SN_DIG .IG_SN_DIG_BODY textarea").text().length&&i();var t=e(".IG_SN_DIG .IG_SN_DIG_BODY textarea").text(),a=document.createElement("a"),n=new Blob([t],{type:"text/plain"});a.href=URL.createObjectURL(n),a.download="DOMTree-"+(new Date).getTime()+".txt",document.body.appendChild(a),a.click(),a.remove()})),e("body").on("click",".IG_SN_DIG_BTN, .IG_SN_DIG_BG",(function(){e(this).parent("#tempWrapper").length>0?e(this).parent("#tempWrapper").fadeOut(250,(function(){e(this).remove()})):e(".IG_SN_DIG").remove()})),e(window).keydown((function(t){"81"==t.keyCode&&t.altKey&&(e(".IG_SN_DIG").remove(),t.preventDefault()),"87"==t.keyCode&&t.altKey&&(X(),t.preventDefault()),"90"==t.keyCode&&t.altKey&&(Z(),t.preventDefault()),"82"==t.keyCode&&t.altKey&&(te(),t.preventDefault()),"83"==t.keyCode&&t.altKey&&(location.href.match(/^(https:\/\/www\.instagram\.com\/stories\/)/gi)&&e(".IG_DWSTORY").length>0&&e(".IG_DWSTORY")?.click(),location.href.match(/^(https:\/\/www\.instagram\.com\/stories\/highlights\/)/gi)&&e(".IG_DWHISTORY").length>0&&e(".IG_DWHISTORY")?.click(),t.preventDefault())})),e("body").on("change",".IG_SN_DIG input",(function(i){var a=e(this).attr("id");if(a&&void 0!==t[a]){let i=e(this).prop("checked");GM_setValue(a,i),t[a]=i,console.log("user settings",a,i)}})),e("body").on("click",".IG_SN_DIG .globalSettings",(function(t){e(this).find("#tempWrapper").length>0&&t.preventDefault()})),e("body").on("change",".IG_SN_DIG #tempWrapper input:not(#date_format)",(function(){let t=e(this).val();"range"==e(this).attr("type")?e(this).next().val(t):e(this).prev().val(t),t>=0&&t<=1&&(a=t,GM_setValue("G_VIDEO_VOLUME",t))})),e("body").on("input",".IG_SN_DIG #tempWrapper input:not(#date_format)",(function(t){if("range"==e(this).attr("type")){let t=e(this).val();e(this).next().val(t)}else{let t=e(this).val();t>=0&&t<=1?e(this).prev().val(t):t<0?e(this).val(0):e(this).val(1)}})),e("body").on("input",".IG_SN_DIG #tempWrapper input#date_format",(function(t){GM_setValue("G_RENAME_FORMAT",e(this).val()),s=e(this).val()})),e("body").on("click",'a[data-needed="direct"]',(function(e){e.preventDefault(),F(this)})),e("body").on("click",".IG_SN_DIG_BODY .newTab",(function(){if(t.FORCE_RESOURCE_VIA_MEDIA&&t.NEW_TAB_ALWAYS_FORCE_MEDIA_IN_POST)F(e(this).parent().children("a").first()[0],!0);else{var i=new URL(e(this).parent().children("a").attr("data-href"));i.host="scontent.cdninstagram.com",ee(i.href)}})),e("body").on("click",".IG_SN_DIG_BODY .videoThumbnail",(function(){let i=(new Date).getTime();t.RENAME_PUBLISH_DATE&&e(this).parent().children("a").attr("datetime")&&(i=e(this).parent().children("a").attr("datetime"));let a=e(this).parent().children("a").attr("data-path")??e("#article-id").text();V(e(this).parent().children("a").find("img").first().attr("src"),e(this).parent().children("a").attr("data-username"),"thumbnail",i,"jpg",a)})),e("body").on("click",".IG_DWSTORY",(function(){b(!0)})),e("body").on("click",".IG_DWNEWTAB",(function(e){e.preventDefault(),b(!0,!0,!0)})),e("body").on("click",".IG_DWSTORY_THUMBNAIL",(function(){R(!0)})),e("body").on("click",".IG_DWPROFILE",(function(e){e.stopPropagation(),O(!0)})),e("body").on("click",".IG_DWHISTORY",(function(){S(!0)})),e("body").on("click",".IG_DWHINEWTAB",(function(e){e.preventDefault(),S(!0,!0)})),e("body").on("click",".IG_DWHISTORY_THUMBNAIL",(function(){A(!0)})),e("body").on("click",".IG_REELS",(function(){M(!0,!0)})),e("body").on("click",".IG_REELS_NEWTAB",(function(){M(!0,!0,!0)})),e("body").on("click",".IG_REELS_THUMBNAIL",(function(){M(!0,!1)})),e("body").on("mousedown",'button[role="menuitem"]',(function(i){if((3===i.which||2===i.which)&&"https://www.instagram.com/"===location.href&&t.REDIRECT_CLICK_USER_STORY_PICTURE&&(i.preventDefault(),e(this).find("canvas._aarh").length>0)){const t="https://www.instagram.com/"+e(this).children("div").last().text();2===i.which?GM_openInTab(t):location.href=t}})),e("body").on("change",".IG_SN_DIG_TITLE .checkbox",(function(){var t=e(this).find("input").prop("checked");e(".IG_SN_DIG_BODY .inner_box").each((function(){e(this).prop("checked",t)}))})),e("body").on("change",".IG_SN_DIG_BODY .inner_box",(function(){var t=e(".IG_SN_DIG_BODY .inner_box:checked").length,i=e(".IG_SN_DIG_BODY .inner_box").length;e(".IG_SN_DIG_TITLE .checkbox").find("input").prop("checked",t==i)})),e("body").on("click",".IG_SN_DIG_TITLE #batch_download_selected",(function(){let t=0;e('.IG_SN_DIG_BODY a[data-needed="direct"]').each((function(){e(this).prev().children("input").prop("checked")&&(e(this).click(),t++)})),0==t&&alert(K("NO_CHECK_RESOURCE"))})),e("body").on("change",".IG_SN_DIG_TITLE #langSelect",(function(){GM_setValue("lang",e(this).val()),f=e(this).val(),f?.startsWith("en")||null!=v[f]?(q(),z()):j(f).then((e=>{v[f]=e,q(),z()})).catch((e=>{console.error("getTranslationText catch error:",e)}))})),e("body").on("change",".IG_SN_DIG_BODY #locateSelect",(function(){e("#locatePreview").text(`${(new Date).toLocaleString(e(this).val(),{hour12:!1,second:"2-digit",minute:"2-digit",hour:"2-digit",month:"2-digit",day:"2-digit",year:"numeric"}).replaceAll("/","-")}`),LOCATE_DATE_FORMAT=e(this).val(),GM_setValue("G_LOCATE_DATE_FORMAT",e(this).val())})),e("body").on("click",".IG_SN_DIG_TITLE #batch_download_direct",(function(){e('.IG_SN_DIG_BODY a[data-needed="direct"]').each((function(){e(this).click()}))}));new MutationObserver((i=>{for(const n of i)"childList"===n.type&&n.addedNodes.forEach((i=>{const n=e(i).find("video");if(n.length>0&&(t.MODIFY_VIDEO_VOLUME&&n.each((function(){e(this).on("play playing",(function(){e(this).data("modify")||(e(this).attr("data-modify",!0),this.volume=a,ie("(audio_observer) Added video event listener #modify"))}))})),location.pathname.match(/^(\/stories\/)/gi))){const i=null!=location.pathname.match(/^(\/stories\/highlights\/)/gi),s=i?"highlight":"story";n.each((function(){e(this).on("timeupdate",(function(){if(!e(this).data("modify-thumbnail")){let t=e(this);0===t.parents("div[style][class]").filter((function(){return e(this).width()==t.width()})).find(".IG_DWSTORY_THUMBNAIL, .IG_DWHISTORY_THUMBNAIL").length?(e(this).attr("data-modify-thumbnail",!0),i?A(!1):R(!1),ie(`(${s})`,"Manually inserting thumbnail button")):(e(this).attr("data-modify-thumbnail",!0),ie(`(${s})`,"Thumbnail button already inserted"))}}));var n=e(this);if(t.HTML5_VIDEO_CONTROL){if(!n.data("controls")){ie(`(${s})`,"Added video html5 contorller #modify"),this.volume=a,n.on("loadstart",(function(){this.volume=a}));let t=n.parents("div").filter((function(){return null==e(this).attr("class")&&null==e(this).attr("style")})).first(),i=t.next();i.hide();let o=t.find('div[class][role="button"]');o.hide();const r=function(t){t.preventDefault(),n.css("z-index","2"),n.attr("controls",!0),o.hide(),i.hide(),ae(n,n.parents("div[style][class]").filter((function(){return e(this).width()==n.width()})).first(),s,"vertical")};n.parent().find("video + div").on("contextmenu",r),o.on("contextmenu",r),i.on("contextmenu",r),n.on("contextmenu",(function(t){t.preventDefault(),n.css("z-index","-1"),n.removeAttr("controls"),i.show(),o.show(),ae(n,n.parents("div[style][class]").filter((function(){return e(this).width()==n.width()})).first(),s,"vertical")})),n.on("volumechange",(function(){let i=t.parent().find('svg > path[d^="M1.5 13.3c-.8 0-1.5.7-1.5 1.5v18.4c0"], svg > path[d^="M16.636 7.028a1.5 1.5"]').parents('[role="button"]').first();var n=0===i.find('svg > path[d^="M16.636"]').length;this.muted!=n&&(this.volume=a,i?.click()),e(this).attr("data-completed")&&(a=this.volume,GM_setValue("G_VIDEO_VOLUME",this.volume)),this.volume==a&&e(this).attr("data-completed",!0)})),n.css("position","absolute"),n.css("z-index","2"),n.attr("data-controls",!0),n.attr("controls",!0)}}else ae(n,n.parents("div[style][class]").filter((function(){return e(this).width()==n.width()})).first(),s,"vertical")}))}}))})).observe(e('div[id^="mount"]')[0],{childList:!0,subtree:!0})}))}(jQuery);