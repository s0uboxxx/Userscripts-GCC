// ==UserScript==
// @name Smoothscroll
// @author       Creec Winceptor
// @description  Smooth scrolling on pages using javascript
// @namespace https://greasyfork.org/users/3167
// @include     *
// @version 12
// @downloadURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/Smoothscroll.user.js
// @updateURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/Smoothscroll.meta.js
// ==/UserScript==
var Smoothscroll={};function ScrollSubpixels(o,l){if(null!=l)return o.scrollsubpixels=l,l;var e=o.scrollsubpixels;return null!=e?e:0}function ScrollPixels(o,l){if(null!=l)return o.scrollpixels=l,ScrollSubpixels(o,0),l;var e=o.scrollpixels;return null!=e?e:0}Smoothscroll.Smoothness=.5,Smoothscroll.Acceleration=.5,Smoothscroll.Debug=0,Smoothscroll.Refreshrate=60,Smoothscroll.MaxRefreshrate=300,Smoothscroll.MinRefreshrate=1;var last=0;function AnimateScroll(o,l){var e=ScrollSubpixels(o),t=ScrollPixels(o);Smoothscroll.Debug>3&&console.log("scrollpixels: "+t),Smoothscroll.Debug>3&&(console.log("target: ",o),o==document.documentElement&&console.log("document.documentElement"));var r=0;t>0&&(r=1),t<0&&(r=-1);var n=t*(1-Math.pow(l,-1/(l*Smoothscroll.Smoothness)));if(Math.abs(t)>2){var c=Math.floor(Math.abs(n))*r,s=n-c,a=Math.floor(Math.abs(e+s))*r,i=e+s-a;ScrollPixels(o,t-c-a),ScrollSubpixels(o,i);var u=c+a;Smoothscroll.Debug>1&&console.log("scrolldelta: "+u),o.style.scrollBehavior="auto",o.scrollTop=o.scrollTop+u,Smoothscroll.Debug>1&&console.log("target.scrollTop: "+o.scrollTop),o.scrollanimated=!0,RequestAnimationUpdate((function(l){AnimateScroll(o,l)}))}else RequestAnimationUpdate((function(l){ScrollPixels(o,0)})),o.scrollanimated=!1}function RequestAnimationUpdate(o){var l=performance.now();window.requestAnimationFrame((()=>{var e=performance.now()-l,t=1e3/Math.max(e,1),r=Math.min(Math.max(t,Smoothscroll.MinRefreshrate),Smoothscroll.MaxRefreshrate);o(r)}))}function CanScroll(o,l){if(l<0)return o.scrollTop>0;if(l>0){if(o==document.body){if(0==o.scrollTop){if(o.scrollTop=3,0==o.scrollTop)return!1;o.scrollTop=0}return Math.round(o.clientHeight+o.scrollTop)<o.offsetHeight}return Math.round(o.clientHeight+o.scrollTop)<o.scrollHeight}}function HasScrollbar(o){if(o==window||o==document)return!1;if(o==document.body)return"hidden"!=window.getComputedStyle(document.body)["overflow-y"];if(o==document.documentElement)return window.innerWidth>document.documentElement.clientWidth;var l=window.getComputedStyle(o);return"hidden"!=l["overflow-y"]&&"visible"!=l["overflow-y"]}function Scrollable(o,l){document.body;var e=CanScroll(o,l);if(!e)return Smoothscroll.Debug>1&&console.log("scrollablecheck: "+e),!1;var t=HasScrollbar(o);return t?(Smoothscroll.Debug>1&&(console.log("scrollablecheck: "+e),console.log("scrollbarcheck: "+t)),!0):(Smoothscroll.Debug>1&&console.log("scrollbarcheck: "+t),!1)}function GetPath(o){return o.path?o.path:o.composedPath?o.composedPath():(Smoothscroll.Debug>1&&console.log("Smoothscroll: e.path is undefined"),null)}function GetTarget(o){var l=o.deltaY,e=GetPath(o);if(!e)return null;Smoothscroll.Debug>2&&(console.log("nodes: "),console.log(e),console.log("target: "));for(var t=0;t<e.length;t++){var r=e[t];if(Smoothscroll.Debug>2&&console.log(r),Scrollable(r,l))return Smoothscroll.Debug>2&&console.log("true"),r}return Smoothscroll.Debug>1&&console.log("false"),null}function GetStyleProperty(o,l){if(window.getComputedStyle){if(e=document.defaultView.getComputedStyle(o,null).getPropertyValue(l))return parseInt(e)}else if(o.currentStyle){var e;if(e=o.currentStyle[l.encamel()])return parseInt(e)}return null}function StopScroll(o){var l=GetPath(o);if(!l)return null;for(var e=0;e<l.length;e++){var t=l[e];Smoothscroll.Stop(t)}}function StartScroll(o,l){if(o.defaultPrevented)return!0;var e=o.deltaY;if(Smoothscroll.Debug&&console.log("e: ",o),o.deltaMode&&1==o.deltaMode){var t=GetStyleProperty(l,"line-height");Smoothscroll.Debug&&console.log("line: "+t),t&&t>0&&(e=o.deltaY*t)}if(o.deltaMode&&2==o.deltaMode){var r=l.clientHeight;Smoothscroll.Debug&&console.log("page: "+r),r&&r>0&&(e=o.deltaY*r)}var n=ScrollPixels(l),c=Math.sqrt(Math.abs(n/e*Smoothscroll.Acceleration)),s=Math.round(e*c),a=n+e+s;Smoothscroll.Debug&&(console.log("scrollpixels: "+n),console.log("delta: "+e),console.log("acceleration: "+s),console.log("totalscroll: "+a)),Smoothscroll.Start(l,a),o.preventDefault()}function WheelEvent(o){var l=GetTarget(o);l&&StartScroll(o,l)}function ClickEvent(o){StopScroll(o)}function Init(){return window.top!=window.self||window.Smoothscroll&&window.Smoothscroll.Loaded?null:(window.requestAnimationFrame||(window.requestAnimationFrame=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame),document.documentElement.addEventListener("wheel",(function(o){WheelEvent(o),Smoothscroll.Debug>0&&console.log(o)}),{passive:!1}),document.documentElement.addEventListener("mousedown",(function(o){ClickEvent(o),Smoothscroll.Debug>0&&console.log(o)})),window.Smoothscroll=Smoothscroll,window.Smoothscroll.Loaded=!0,void console.log("Smoothscroll: loaded"))}Smoothscroll.Stop=function(o){o&&ScrollPixels(o,0)},Smoothscroll.Start=function(o,l){if(o){ScrollPixels(o,l);o.scrollanimated||AnimateScroll(o,Smoothscroll.Refreshrate)}},"undefined"!=typeof module&&(module.exports=Smoothscroll),Init();