// ==UserScript==
// @name            Simple YouTube Age Restriction Bypass
// @description     Watch age restricted videos on YouTube without login and without age verification ðŸ˜Ž
// @description:de  Schaue YouTube Videos mit AltersbeschrÃ¤nkungen ohne Anmeldung und ohne dein Alter zu bestÃ¤tigen ðŸ˜Ž
// @description:fr  Regardez des vidÃ©os YouTube avec des restrictions d'Ã¢ge sans vous inscrire et sans confirmer votre Ã¢ge ðŸ˜Ž
// @description:it  Guarda i video con restrizioni di etÃ  su YouTube senza login e senza verifica dell'etÃ  ðŸ˜Ž
// @icon            https://github.com/zerodytrash/Simple-YouTube-Age-Restriction-Bypass/raw/v2.5.4/src/extension/icon/icon_64.png
// @version         2.5.10
// @author          Zerody (https://github.com/zerodytrash)
// @namespace       https://github.com/zerodytrash/Simple-YouTube-Age-Restriction-Bypass/
// @supportURL      https://github.com/zerodytrash/Simple-YouTube-Age-Restriction-Bypass/issues
// @license         MIT
// @match           https://www.youtube.com/*
// @match           https://www.youtube-nocookie.com/*
// @match           https://m.youtube.com/*
// @match           https://music.youtube.com/*
// @grant           none
// @run-at          document-start
// @compatible      chrome
// @compatible      firefox
// @compatible      opera
// @compatible      edge
// @compatible      safari
// @downloadURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/Simple20YouTube20Age20Restriction20Bypass.user.js
// @updateURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/Simple20YouTube20Age20Restriction20Bypass.meta.js
// ==/UserScript==
!function e(t){if(this!==window&&!t)return void window.eval("("+e.toString()+")(true);");var n=window[Symbol()]={UNLOCKABLE_PLAYABILITY_STATUSES:["AGE_VERIFICATION_REQUIRED","AGE_CHECK_REQUIRED","CONTENT_CHECK_REQUIRED","LOGIN_REQUIRED"],VALID_PLAYABILITY_STATUSES:["OK","LIVE_STREAM_OFFLINE"],ACCOUNT_PROXY_SERVER_HOST:"https://youtube-proxy.zerody.one",VIDEO_PROXY_SERVER_HOST:"https://ny.4everproxy.com",ENABLE_UNLOCK_CONFIRMATION_EMBED:!0,ENABLE_UNLOCK_NOTIFICATION:!0,SKIP_CONTENT_WARNINGS:!0,GOOGLE_AUTH_HEADER_NAMES:["Authorization","X-Goog-AuthUser","X-Origin"],BLURRED_THUMBNAIL_SQP_LENGTHS:[32,48,56,68,72,84,88]};const o=window.JSON.parse,i=window.XMLHttpRequest.prototype.open,r="m.youtube.com"!==window.location.host,s="music.youtube.com"===window.location.host,a=0===window.location.pathname.indexOf("/embed/"),c=window.location.search.includes("unlock_confirmed");class l{constructor(){return Object.assign(new Promise(((e,t)=>{this.resolve=e,this.reject=t})),this)}}if(window.trustedTypes&&trustedTypes.createPolicy&&!trustedTypes.defaultPolicy){const e=e=>e;trustedTypes.createPolicy("default",{createHTML:e,createScriptURL:e,createScript:e})}function d(e,t){const n=document.createElement(e);return t&&Object.assign(n,t),n}function u(e){return null!==e&&"object"==typeof e}function p(e,t){var n=[];return t.every((t=>void 0!==e[t]))&&n.push(e),Object.keys(e).forEach((o=>{e[o]&&"object"==typeof e[o]&&n.push(...p(e[o],t))})),n}function y(e){return o(JSON.stringify(e))}function v(e){var t;return null===(t=window.ytcfg)||void 0===t?void 0:t.get(e)}function E(){return"boolean"==typeof v("LOGGED_IN")?v("LOGGED_IN"):"string"==typeof v("DELEGATED_SESSION_ID")||parseInt(v("SESSION_INDEX"))>=0}function f(e){var t;return!(null==e||!e.contents||null==e||null===(t=e.currentVideoEndpoint)||void 0===t||null===(t=t.watchEndpoint)||void 0===t||!t.videoId)&&(!!e.contents.twoColumnWatchNextResults||!!e.contents.singleColumnWatchNextResults)}function m(e){var t,n;if(r){var o;return!(null===(o=e.contents)||void 0===o||null===(o=o.twoColumnWatchNextResults)||void 0===o||null===(o=o.secondaryResults)||void 0===o||null===(o=o.secondaryResults)||void 0===o?void 0:o.results)}const i=null===(t=e.contents)||void 0===t||null===(t=t.singleColumnWatchNextResults)||void 0===t||null===(t=t.results)||void 0===t||null===(t=t.results)||void 0===t?void 0:t.contents;return"object"!=typeof(null==i||null===(n=i.find((e=>{var t;return"watch-next-feed"===(null===(t=e.itemSectionRenderer)||void 0===t?void 0:t.targetId)})))||void 0===n?void 0:n.itemSectionRenderer)}function R(e){var t;return!(null==e||!e.status)&&(!!e.desktopLegacyAgeGateReason||(!!n.UNLOCKABLE_PLAYABILITY_STATUSES.includes(e.status)||a&&(null===(t=e.errorScreen)||void 0===t||null===(t=t.playerErrorMessageRenderer)||void 0===t||null===(t=t.reason)||void 0===t||null===(t=t.runs)||void 0===t||null===(t=t.find((e=>e.navigationEndpoint)))||void 0===t||null===(t=t.navigationEndpoint)||void 0===t||null===(t=t.urlEndpoint)||void 0===t||null===(t=t.url)||void 0===t?void 0:t.includes("/2802167"))))}function h(e,t,n){if(!e||"function"!=typeof e[t])return;let o=e[t];e[t]=function(){try{n(arguments)}catch{}o.apply(this,arguments)}}const S="%cSimple-YouTube-Age-Restriction-Bypass:",N="background-color: #1e5c85; color: #fff; font-size: 1.2em;";function g(e,t){console.error(S,N,t,e,function(){try{return`InnertubeConfig: innertubeApiKey: ${v("INNERTUBE_API_KEY")} innertubeClientName: ${v("INNERTUBE_CLIENT_NAME")} innertubeClientVersion: ${v("INNERTUBE_CLIENT_VERSION")} loggedIn: ${v("LOGGED_IN")} `}catch(e){return`Failed to access config: ${e}`}}(),"\n\n","ðŸž You can report bugs at: https://github.com/zerodytrash/Simple-YouTube-Age-Restriction-Bypass/issues"),window.SYARB_CONFIG&&window.dispatchEvent(new CustomEvent("SYARB_LOG_ERROR",{detail:{message:(t?t+"; ":"")+(e&&e.message?e.message:""),stack:e&&e.stack?e.stack:null}}))}function I(e){console.info(S,N,e),window.SYARB_CONFIG&&window.dispatchEvent(new CustomEvent("SYARB_LOG_INFO",{detail:{message:e}}))}const w="SYARB_";function _(e,t){localStorage.setItem(w+e,JSON.stringify(t))}function T(e,t,i){const r=new XMLHttpRequest;return r.open("POST",`/youtubei/${e}?key=${v("INNERTUBE_API_KEY")}&prettyPrint=false`,!1),i&&E()&&(r.withCredentials=!0,n.GOOGLE_AUTH_HEADER_NAMES.forEach((e=>{r.setRequestHeader(e,function(e){try{return JSON.parse(localStorage.getItem(w+e))}catch{return null}}(e))}))),r.send(JSON.stringify(t)),o(r.responseText)}var O={getPlayer:function(e,t){return T("v1/player",e,t)},getNext:function(e,t){return T("v1/next",e,t)}};let C={};function A(e,t){const i=new URLSearchParams(t),r=`${n.ACCOUNT_PROXY_SERVER_HOST}/${e}?${i}&client=js`;try{const e=new XMLHttpRequest;e.open("GET",r,!1),e.send(null);const n=o(e.responseText);return n.proxied=!0,n.nextResponse&&(C[t.videoId]=n.nextResponse,delete n.nextResponse),n}catch(e){return g(e,"Proxy API Error"),{errorMessage:"Proxy Connection failed"}}}var b={getPlayer:function(e){return C[e.videoId]||s||a||(e.includeNext=1),A("getPlayer",e)},getNext:function(e){return C[e.videoId]?C[e.videoId]:A("getNext",e)},getGoogleVideoUrl:function(e){return n.VIDEO_PROXY_SERVER_HOST+"/direct/"+btoa(e.toString())}};function L(e,t){const n=v("INNERTUBE_CLIENT_NAME")||"WEB",o=v("INNERTUBE_CLIENT_VERSION")||"2.20220203.04.00",i=v("STS")||(e=>{const t=null===(e=document.querySelector('script[src*="/base.js"]'))||void 0===e?void 0:e.src;if(!t)return;const n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(null),parseInt(n.responseText.match(/signatureTimestamp:([0-9]*)/)[1])})(),r=function(e){if(window.location.href.includes(e)){var t;const e=new URLSearchParams(window.location.search),n=null===(t=e.get("t")||e.get("start")||e.get("time_continue"))||void 0===t?void 0:t.replace("s","");if(n&&!isNaN(n))return parseInt(n)}return 0}(e),s=v("HL");return[{name:"Content Warning Bypass",skip:!t||!t.includes("CHECK_REQUIRED"),optionalAuth:!0,payload:{context:{client:{clientName:n,clientVersion:o,hl:s}},playbackContext:{contentPlaybackContext:{signatureTimestamp:i}},videoId:e,startTimeSecs:r,racyCheckOk:!0,contentCheckOk:!0},endpoint:O},{name:"TV Embedded Player",requiresAuth:!1,payload:{context:{client:{clientName:"TVHTML5_SIMPLY_EMBEDDED_PLAYER",clientVersion:"2.0",clientScreen:"WATCH",hl:s},thirdParty:{embedUrl:"https://www.youtube.com/"}},playbackContext:{contentPlaybackContext:{signatureTimestamp:i}},videoId:e,startTimeSecs:r,racyCheckOk:!0,contentCheckOk:!0},endpoint:O},{name:"Creator + Auth",requiresAuth:!0,payload:{context:{client:{clientName:"WEB_CREATOR",clientVersion:"1.20210909.07.00",hl:s}},playbackContext:{contentPlaybackContext:{signatureTimestamp:i}},videoId:e,startTimeSecs:r,racyCheckOk:!0,contentCheckOk:!0},endpoint:O},{name:"Account Proxy",payload:{videoId:e,reason:t,clientName:n,clientVersion:o,signatureTimestamp:i,startTimeSecs:r,hl:s,isEmbed:+a,isConfirmed:+c},endpoint:b}]}let x={};async function P(e,t,n,o){const i=await function(e,t){const n=new l,o=setInterval((()=>{const t=document.querySelector(e);t&&(clearInterval(o),n.resolve(t))}),100);return setTimeout((()=>{clearInterval(o),n.reject()}),t),n}(".ytp-error",2e3),r=d("div",{class:"button-container",innerHTML:'<div style="margin-top: 15px !important; padding: 3px 10px 3px 10px; margin: 0px auto; background-color: #4d4d4d; width: fit-content; font-size: 1.2em; text-transform: uppercase; border-radius: 3px; cursor: pointer;">\n    <div class="button-text"></div>\n</div>'});r.getElementsByClassName("button-text")[0].innerText=t,"function"==typeof o&&r.addEventListener("click",o),x[e]&&x[e].isConnected||(x[e]=r,i.append(r))}const k="confirmButton";function U(){P(k,"Click to unlock",0,(()=>{var e;x[e=k]&&x[e].isConnected&&x[e].remove(),function(e){const t=new URLSearchParams(window.location.search);for(const n in e)t.set(n,e[n]);window.location.search=t}({unlock_confirmed:1,autoplay:1})}))}const D=d("div",{id:"toast-container",innerHTML:r?"<tp-yt-paper-toast></tp-yt-paper-toast>\n":'<c3-toast>\n    <ytm-notification-action-renderer>\n        <div class="notification-action-response-text"></div>\n    </ytm-notification-action-renderer>\n</c3-toast>\n'}),B=D.querySelector(":scope > *");s&&(B.style["margin-bottom"]="85px"),r||(B.nMessage=B.querySelector(".notification-action-response-text"),B.show=e=>{B.nMessage.innerText=e,B.setAttribute("dir","in"),setTimeout((()=>{B.setAttribute("dir","out")}),B.duration+225)});var H={show:async function(e,t=5){n.ENABLE_UNLOCK_NOTIFICATION&&(a||(await function(){if("complete"===document.readyState)return Promise.resolve();const e=new l;return window.addEventListener("load",e.resolve,{once:!0}),e}(),"hidden"!==document.visibilityState&&(D.isConnected||document.documentElement.append(D),B.duration=1e3*t,B.show(e))))}};const M="Age-restricted video successfully unlocked!",G="Unable to unlock this video ðŸ™ - More information in the developer console";let V,Y=null,q=null,K={};function W(e){var t,o,i,r,s;if(!c&&a&&n.ENABLE_UNLOCK_CONFIRMATION_EMBED)return I("Unlock confirmation required."),void U();const l=(null===(t=e.videoDetails)||void 0===t?void 0:t.videoId)||v("PLAYER_VARS").video_id,d=(null===(o=e.playabilityStatus)||void 0===o?void 0:o.status)||(null===(i=e.previewPlayabilityStatus)||void 0===i?void 0:i.status);if(!n.SKIP_CONTENT_WARNINGS&&d.includes("CHECK_REQUIRED"))return void I(`SKIP_CONTENT_WARNINGS disabled and ${d} status detected.`);Y=l,q=d;const u=function(e,t){if(K.videoId===e)return y(K);const o=L(e,t);let i={};return o.every(((e,t)=>{var o;if(e.skip||e.requiresAuth&&!E())return!0;I(`Trying Player Unlock Method #${t+1} (${e.name})`);try{i=e.endpoint.getPlayer(e.payload,e.requiresAuth||e.optionalAuth)}catch(e){g(e,`Player Unlock Method ${t+1} failed with exception`)}const r=n.VALID_PLAYABILITY_STATUSES.includes(null===(o=i)||void 0===o||null===(o=o.playabilityStatus)||void 0===o?void 0:o.status);var s;r&&(i.trackingParams&&null!==(s=i.responseContext)&&void 0!==s&&null!==(s=s.mainAppWebResponseContext)&&void 0!==s&&s.trackingParam||(i.trackingParams="CAAQu2kiEwjor8uHyOL_AhWOvd4KHavXCKw=",i.responseContext={mainAppWebResponseContext:{trackingParam:"kx_fmPxhoPZRzgL8kzOwANUdQh8ZwHTREkw2UqmBAwpBYrzRgkuMsNLBwOcCE59TDtslLKPQ-SS"}}),e.payload.startTimeSecs&&"Account Proxy"===e.name&&(i.playerConfig={playbackStartConfig:{startSeconds:e.payload.startTimeSecs}}));return!r})),K={videoId:e,...y(i)},i}(l,d);if(u.errorMessage)throw H.show(`${G} (ProxyError)`,10),new Error(`Player Unlock Failed, Proxy Error Message: ${u.errorMessage}`);var p;if(!n.VALID_PLAYABILITY_STATUSES.includes(null===(r=u.playabilityStatus)||void 0===r?void 0:r.status))throw H.show(`${G} (PlayabilityError)`,10),new Error(`Player Unlock Failed, playabilityStatus: ${null===(p=u.playabilityStatus)||void 0===p?void 0:p.status}`);if(u.proxied&&null!==(s=u.streamingData)&&void 0!==s&&s.adaptiveFormats){var f,m;const e=null===(f=u.streamingData.adaptiveFormats.find((e=>e.signatureCipher)))||void 0===f?void 0:f.signatureCipher,t=e?new URLSearchParams(e).get("url"):null===(m=u.streamingData.adaptiveFormats.find((e=>e.url)))||void 0===m?void 0:m.url;V=t?new URLSearchParams(new window.URL(t).search):null}e.previewPlayabilityStatus&&(e.previewPlayabilityStatus=u.playabilityStatus),Object.assign(e,u),e.unlocked=!0,H.show(M)}let $={};function F(e){const t=e.currentVideoEndpoint.watchEndpoint.videoId;if(!t)throw new Error("Missing videoId in nextResponse");if(t!==Y)return;const n=function(e){if($.videoId===e)return y($);const t=function(e,t){var n;const o=v("INNERTUBE_CLIENT_NAME")||"WEB",i=v("INNERTUBE_CLIENT_VERSION")||"2.20220203.04.00",r=v("HL"),s=null!==(n=v("INNERTUBE_CONTEXT").client.userInterfaceTheme)&&void 0!==n?n:document.documentElement.hasAttribute("dark")?"USER_INTERFACE_THEME_DARK":"USER_INTERFACE_THEME_LIGHT";return[{name:"Content Warning Bypass",skip:!t||!t.includes("CHECK_REQUIRED"),optionalAuth:!0,payload:{context:{client:{clientName:o,clientVersion:i,hl:r,userInterfaceTheme:s}},videoId:e,racyCheckOk:!0,contentCheckOk:!0},endpoint:O},{name:"Account Proxy",payload:{videoId:e,clientName:o,clientVersion:i,hl:r,userInterfaceTheme:s,isEmbed:+a,isConfirmed:+c},endpoint:b}]}(e,q);let n={};return t.every(((e,t)=>{if(e.skip)return!0;I(`Trying Next Unlock Method #${t+1} (${e.name})`);try{n=e.endpoint.getNext(e.payload,e.optionalAuth)}catch(e){g(e,`Next Unlock Method ${t+1} failed with exception`)}return m(n)})),$={videoId:e,...y(n)},n}(t);if(m(n))throw new Error("Sidebar Unlock Failed");!function(e,t){var n;if(r){e.contents.twoColumnWatchNextResults.secondaryResults=t.contents.twoColumnWatchNextResults.secondaryResults;const n=e.contents.twoColumnWatchNextResults.results.results.contents.find((e=>e.videoSecondaryInfoRenderer)).videoSecondaryInfoRenderer,o=t.contents.twoColumnWatchNextResults.results.results.contents.find((e=>e.videoSecondaryInfoRenderer)).videoSecondaryInfoRenderer;return void(o.description?n.description=o.description:o.attributedDescription&&(n.attributedDescription=o.attributedDescription))}const o=null===(n=t.contents)||void 0===n||null===(n=n.singleColumnWatchNextResults)||void 0===n||null===(n=n.results)||void 0===n||null===(n=n.results)||void 0===n||null===(n=n.contents)||void 0===n?void 0:n.find((e=>{var t;return"watch-next-feed"===(null===(t=e.itemSectionRenderer)||void 0===t?void 0:t.targetId)}));o&&e.contents.singleColumnWatchNextResults.results.results.contents.push(o);const i=e.engagementPanels.find((e=>e.engagementPanelSectionListRenderer)).engagementPanelSectionListRenderer.content.structuredDescriptionContentRenderer.items.find((e=>e.expandableVideoDescriptionBodyRenderer)),s=t.engagementPanels.find((e=>e.engagementPanelSectionListRenderer)).engagementPanelSectionListRenderer.content.structuredDescriptionContentRenderer.items.find((e=>e.expandableVideoDescriptionBodyRenderer));s.expandableVideoDescriptionBodyRenderer&&(i.expandableVideoDescriptionBodyRenderer=s.expandableVideoDescriptionBodyRenderer)}(e,n)}function j(e){if(n.VIDEO_PROXY_SERVER_HOST&&function(e){return e.host.includes(".googlevideo.com")}(e)&&function(e,t){const n=new URLSearchParams(e.search),o=n.get("gcr"),i=n.get("id")===t;return o&&i}(e,null===(t=V)||void 0===t?void 0:t.get("id")))return b.getGoogleVideoUrl(e);var t}function X(e){try{let t=JSON.parse(e);if(t.videoId)return t.contentCheckOk=!0,t.racyCheckOk=!0,JSON.stringify(t)}catch{}return e}function Q(e){const t=p(e,["url","height"]);let n=0;for(const e of t)z(e)&&(n++,e.url=e.url.split("?")[0]);I(n+"/"+t.length+" thumbnails detected as blurred.")}function z(e){if(!(-1!==e.url.indexOf("?sqp=")))return!1;const t=new URL(e.url).searchParams.get("sqp").length;return n.BLURRED_THUMBNAIL_SQP_LENGTHS.includes(t)}try{te=ne,function(e,t){var n;const o="__SYARB_"+e,{get:i,set:r}=null!==(n=Object.getOwnPropertyDescriptor(Object.prototype,e))&&void 0!==n?n:{set(e){this[o]=e},get(){return this[o]}};Object.defineProperty(Object.prototype,e,{set(e){r.call(this,u(e)?t(this,e):e)},get(){return i.call(this)},configurable:!0})}("playerResponse",((e,t)=>(I(`playerResponse property set, contains sidebar: ${!!e.response}`),u(e.response)&&te(e.response),t.unlocked=!1,te(t),t.unlocked?y(t):t))),window.addEventListener("DOMContentLoaded",(()=>{u(window.ytInitialData)&&te(window.ytInitialData)})),ee=ne,window.JSON.parse=function(){const e=o.apply(this,arguments);return u(e)?ee(e):e},Z=function(e,t,o){const i=new URL(t);let r=j(i);if(r)return Object.defineProperty(o,"withCredentials",{set:()=>{},get:()=>!1}),r.toString();0===i.pathname.indexOf("/youtubei/")&&h(o,"setRequestHeader",(([e,t])=>{n.GOOGLE_AUTH_HEADER_NAMES.includes(e)&&_(e,t)})),n.SKIP_CONTENT_WARNINGS&&"POST"===e&&["/youtubei/v1/player","/youtubei/v1/next"].includes(i.pathname)&&h(o,"send",(e=>{"string"==typeof e[0]&&(e[0]=X(e[0]))}))},XMLHttpRequest.prototype.open=function(...e){let[t,n]=e;try{if("string"==typeof n&&(0===n.indexOf("/")&&(n=window.location.origin+n),-1!==n.indexOf("https://"))){const o=Z(t,n,this);o&&(e[1]=o)}}catch(e){g(e,"Failed to intercept XMLHttpRequest.open()")}i.apply(this,e)},J=function(e,t){const o=new URL(e),i=j(o);if(i)return t.credentials&&(t.credentials="omit"),i.toString();if(0===o.pathname.indexOf("/youtubei/")&&u(t.headers))for(let e in t.headers)n.GOOGLE_AUTH_HEADER_NAMES.includes(e)&&_(e,t.headers[e]);n.SKIP_CONTENT_WARNINGS&&["/youtubei/v1/player","/youtubei/v1/next"].includes(o.pathname)&&(t.body=X(t.body))},"function"==typeof window.Request&&(window.Request=new Proxy(window.Request,{construct(e,t){let[n,o]=t;try{if("string"==typeof n&&(0===n.indexOf("/")&&(n=window.location.origin+n),-1!==n.indexOf("https://"))){const e=J(n,o);e&&(t[0]=e)}}catch(e){g(e,"Failed to intercept Request()")}return Reflect.construct(e,t)}}))}catch(e){g(e,"Error while attaching data interceptors")}var J,Z,ee,te;function ne(e){try{((null==(t=e)?void 0:t.videoDetails)&&(null==t?void 0:t.playabilityStatus)&&R(e.playabilityStatus)||function(e){return"object"==typeof(null==e?void 0:e.previewPlayabilityStatus)}(e)&&R(e.previewPlayabilityStatus))&&W(e)}catch(e){g(e,"Video unlock failed")}var t;try{f(e)&&m(e)&&F(e),f(e.response)&&m(e.response)&&F(e.response)}catch(e){g(e,"Sidebar unlock failed")}try{(function(e){var t,n,o;return"object"==typeof(null==e||null===(t=e.contents)||void 0===t?void 0:t.twoColumnSearchResultsRenderer)||"search-feed"===(null==e||null===(n=e.contents)||void 0===n||null===(n=n.sectionListRenderer)||void 0===n?void 0:n.targetId)||"search-feed"===(null==e||null===(o=e.onResponseReceivedCommands)||void 0===o||null===(o=o.find((e=>e.appendContinuationItemsAction)))||void 0===o||null===(o=o.appendContinuationItemsAction)||void 0===o?void 0:o.targetId)})(e)&&Q(e)}catch(e){g(e,"Thumbnail unlock failed")}return e}}();