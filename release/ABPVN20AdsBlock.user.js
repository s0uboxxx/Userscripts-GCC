// ==UserScript==
// @name        ABPVN AdsBlock
// @namespace   ABPVN
// @author      ABPVN
// @copyright   ABPVN
// @homepage    https://abpvn.com
// @supportURL  https://github.com/abpvn/abpvn/issues
// @icon        https://abpvn.com/icon.png
// @description Script block ads, remove wating of ABPVN
// @description:vi Script ch·∫∑n qu·∫£ng c√°o,lo·∫°i b·ªè ch·ªù ƒë·ª£i c·ªßa ABPVN
// @contributionURL https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=donghoang.nguyen@gmail.com&item_name=ABPVN Donation
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_openInTab
// @grant       GM_registerMenuCommand
// @include     http://*
// @include     https://*
// @version ¬† ¬† 2.3.29
// @change-log  Fix game24h.vn iframe game load + remove outdate function
// @run-at      document-end
// @downloadURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/ABPVN20AdsBlock.user.js
// @updateURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/ABPVN20AdsBlock.meta.js
// ==/UserScript==
String.prototype.startWith=function(e){return"function"==typeof this.indexOf&&0===this.indexOf(e)},String.prototype.ismatch=function(e){return"function"==typeof this.match&&null!==this.match(e)};var byPass={hideLinkUnlock:function(){var e=document.querySelectorAll(".onp-sl-content,.onp-locker-call,[data-locker-id]");if(e.length){if(ABPVN.cTitle(),!document.getElementById("abpvn_style")){var t=document.createElement("style");t.id="abpvn_style",t.innerHTML=".onp-sl-content{display:block!important;}.onp-sl,.onp-sl-overlap-box{display:none!important;}.onp-sl-blur-area{filter: none!important;}",document.body.appendChild(t)}for(var n in e){if(e[n].firstChild&&"Unlocked by ABPVN.COM"!=e[n].firstChild.innerText){var o=document.createElement("div");o.innerHTML='<a href="http://abpvn.com" target="_blank" style="color: #08BE54;font-weight: bold;">Unlocked by ABPVN.COM</a>',o.style.textAlign="right",e[n].insertBefore(o,e[n].firstChild)}e[n].style&&(e[n].style.display="block")}var i=document.querySelectorAll('.onp-sl,div[id^="content-locker"]');for(var r in i)i[r].style&&(i[r].style.display="none !important",i[r].setAttribute("hidden","hidden"))}},removeShortLink:function(){var e=document.querySelectorAll('a[href*="/full/?api="]'),t=0;if(e.length){ABPVN.cTitle();for(var n=0;n<e.length;n++){var o=e[n],i=o.getAttribute("href").match(/url=(.+?)&|$/);if(i[1]){o.setAttribute("href",atob(i[1].replace(/=+$/,"")));var r=o.getAttribute("title");o.setAttribute("title",r?r+" ":"Short link by pass by ABPVN.COM"),t++}}Logger.info("By pass "+t+" short link")}},showBodyLinkByPassAndRedirect:function(e){document.body.innerHTML="<style>html,body{background: #fff !important;}h1{color: #00dc58;}a{color: #015199}a h1{color: #015199;}</style><center><h1>ABPVN quick bypass ƒë√£ ho·∫°t ƒë·ªông</h1><a href='https://abpvn.com/donate'><h1>·ª¶ng h·ªô ABPVN</h1></a><br/>Kh√¥ng t·ª± chuy·ªÉn trang? <a href='"+e+"' title='Chuy·ªÉn trang'>Click v√†o ƒë√¢y</a></center>",setTimeout((()=>location.href=e),500)},quickByPassLink:function(){var e=/share4you.pro|derow.win/;if(/123link\..*|phlame.pw|megaurl\.*|www.123l\.*|vinaurl\.*|share4you.pro|doxeaz10.site|derow.win|linkviet.net|ez4linkss.com|ckk.ai|link\.codevn\.net|linksht.com|beta.shortearn.eu|getlink\.tienichmaytinh\.net|download.baominh.tech|download3s.net/.test(location.hostname))try{var t,n=new MutationObserver((e=>{e.forEach((e=>{(function(e){return"disabled"===e.attributeName&&!e.target.disabled||"class"===e.attributeName&&!e.target.classList.contains("disabled")})(e)&&e.target.click(),"href"===e.attributeName&&(t=e.target.getAttribute("href"),this.showBodyLinkByPassAndRedirect(t))}))})),o={attributes:!0},i=document.getElementById("invisibleCaptchaShortlink")||document.querySelector(".download_1");if(i)n.observe(i,o);else if(document.querySelector("#originalLink"))t=document.querySelector("#originalLink").getAttribute("href"),this.showBodyLinkByPassAndRedirect(t);else{var r=document.querySelector(".get-link"),a=e.test(location.hostname)?6e3:100;r&&(n.observe(r,o),/megaurl\.*|vinaurl\.*|doxeaz10.site|linkviet.net|ez4linkss.com|ckk.ai|link\.codevn\.net|beta.shortearn.eu|getlink\.tienichmaytinh\.net|download.baominh.tech|download3s.net/.test(location.hostname)||setTimeout((function(){$("#go-link").addClass("go-link").trigger("submit.adLinkFly.counterSubmit").one("submit.adLinkFly.counterSubmit",(function(t){t.preventDefault(),e.test(location.hostname)||location.reload()}))}),a))}}catch(e){Logger.error(e)}},wikiall_org:function(){if("wikiall.org"==location.hostname&&document.querySelector("#timer")){var e=new MutationObserver((e=>{e.forEach((e=>{if("childList"==e.type){var t=e.target.querySelector("a");this.showBodyLinkByPassAndRedirect(t.getAttribute("href"))}}))})),t=document.querySelector("#place");e.observe(t,{childList:!0})}},link1s_com:function(){window.addEventListener("DOMContentLoaded",(()=>{let e=document.querySelector("a#link1s");if(e&&e.getAttribute("href").match(/http?s:\/\//)){Logger.info("Link1s.com step 1 match");let t=e.getAttribute("href");this.showBodyLinkByPassAndRedirect(t)}else{if(document.querySelector("#link1s-snp .btn-primary")){Logger.info("Link1s.com step 2 match"),Logger.info("Finding next url");let e=[...document.querySelectorAll("script")].map((e=>e.innerText)).join("\n").match(/link1sLink\s=\s\'(.+)\';/);if(e&&e[1])return void this.showBodyLinkByPassAndRedirect(e[1])}var t=new MutationObserver((e=>{e.forEach((e=>{"href"===e.attributeName&&(link=e.target.getAttribute("href"),this.showBodyLinkByPassAndRedirect(link))}))}));"link1s.com"===location.hostname&&(document.querySelector(".get-link")||document.querySelector(".skip-ad"))&&(Logger.info("Link1s.com step 3 match"),t.observe(document.querySelector(".get-link")||document.querySelector(".skip-ad"),{attributes:!0,subtree:!0}))}}))},init:function(){configure.getValue("unlock_content",!0)&&(window.addEventListener("DOMContentLoaded",this.hideLinkUnlock),window.addEventListener("load",this.hideLinkUnlock),this.hideLinkUnlock()),configure.getValue("remove_short_link",!0)&&window.addEventListener("DOMContentLoaded",this.removeShortLink),configure.getValue("quick_by_pass_link",!0)&&(this.quickByPassLink(),this.wikiall_org(),this.link1s_com())}},Logger={style:"color: #00DC58",info:function(e){console.info("%cABPVN.COM Info: ",this.style,e)},warn:function(e){console.warn("%cABPVN Warn: ",this.style,e)},error:function(e){console.error("%cABPVN Error: ",this.style,e)},log:function(e){console.log("%cABPVN Log: ",this.style,e)}},getLink={showBodyLinkDownloadAndRedirect:function(e,t){document.body.innerHTML="<style>html,body{background: #fff !important;}h1{color: #00dc58;}a{color: #015199}a h1{color: #015199;}</style><center><h1>ABPVN "+e+" download ƒë√£ ho·∫°t ƒë·ªông</h1><a href='https://abpvn.com/donate'><h1>·ª¶ng h·ªô ABPVN</h1></a><br/>Kh√¥ng t·ª± t·∫£i xu·ªëng? <a href='"+t+"' title='Download'>Click v√†o ƒë√¢y</a></center>",location.href=t},mediafire_com:function(){if(this.url.startWith("http://www.mediafire.com/file/")||this.url.startWith("https://www.mediafire.com/file/")){var e=document.querySelector(".download_link a.input").getAttribute("href");e.startWith("http")&&this.showBodyLinkDownloadAndRedirect("MediaFire",e)}},init:function(){this.url=location.href,configure.getValue("quick_download",!0)&&this.mediafire_com()}},fixSite={elementExist:function(e){return null!=document.querySelector(e)},getAllText:function(e){var t="",n=document.querySelectorAll(e);if(n)for(var o in n)n[o].innerText&&(t+=n[o].innerText);return t},getScript:function(e){var t=new XMLHttpRequest;t.open("GET",e),t.addEventListener("load",(function(e){var n=new Blob([t.responseText],{type:"text/javascript"}),o=URL.createObjectURL(n),i=document.createElement("script");i.src=o,i.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(i)})),t.send()},loadCss:function(e,t){var n=document.createElement("link");n.rel="stylesheet",n.id=t,n.href=e,document.getElementsByTagName("head")[0].appendChild(n)},antiAdblockRemover:function(){try{var e="By pass adBlock detect r·ªìi nh√©! Hahahahaha üòÅüòÅüòÅ";"function"==typeof adBlockDetected&&(adBlockDetected=function(){Logger.info(e)}),"function"==typeof showAdsBlock&&(showAdsBlock=function(){Logger.info(e)}),"function"==typeof nothingCanStopMeShowThisMessage&&(nothingCanStopMeShowThisMessage=function(){Logger.info(e)})}catch(e){Logger.error(e)}},ios_codevn_net:function(){if(this.url.match(/ios\.codevn\.net/)){const e=document.createElement("style");e.innerHTML='div[id*="ScriptRoot"]{height: 1px !important;}',document.head.appendChild(e),ABPVN.cTitle()}},linkneverdie:function(){if(this.url.match(/linkneverdie/)){const e=$.prototype.html;$.prototype.html=function(arguments){if("body"===this.selector&&(""===arguments||arguments.includes("huong-dan")))return ABPVN.cTitle(),void Logger.info("üòÅüòÅAnti Adblock √†? C√≤n l√¢u nh√©!");e.call(this,arguments)}}},redirect_dafontvn_com(){this.url.startWith("https://redirect.dafontvn.com")&&(ABPVN.cTitle(),window.addEventListener("load",(()=>{var e=aesCrypto.decrypt(convertstr($.urlParam("o")),convertstr("root"));location.href=e})))},game24h_vn:function(){this.url.startWith("https://game24h.vn")&&"function"==typeof addGameIframe&&(ABPVN.cTitle(),document.querySelector("#playBtn").style.display="none",addGameIframe())},removeRedir:function(e){if(this.url.match(new RegExp(e.url,"g"))||this.url.startWith(e.url)){ABPVN.cTitle();var t=document.querySelectorAll(e.selector||'a[href^="'+e.replace+'"]');Logger.info("Remove Redirect for "+t.length+" links"),t.length&&t.forEach(function(t){for(var n=t.getAttribute("href").replace(e.replace,""),o=0;n.indexOf("%2")>-1&&o<5;)n=decodeURIComponent(n),o++;for(o=0;0===n.indexOf("aHR0c")&&o<5;)n=atob(n),o++;t.setAttribute("href",n),t.setAttribute("title","Link ƒë√£ x√≥a chuy·ªÉn h∆∞·ªõng trung gian b·ªüi abpvn.com")}.bind(this))}},removeRedirect(){[{url:"https://samsungvn.com",replace:"https://samsungvn.com/xfa-interstitial/redirect?url="},{url:"https://forum.vietdesigner.net",replace:"redirect/?url="},{url:"www.webtretho.com/forum/",replace:/http(s?):\/\/webtretho\.com\/forum\/links\.php\?url=/,selector:'a[href*="webtretho.com/forum/links.php?url="]'},{url:"https://tuong.me/",replace:"https://tuong.me/chuyen-huong/?url="},{url:"https://yhocdata.com/",replace:"https://yhocdata.com/redirect/?url="},{url:"https://vn-z.vn/",replace:"https://vn-z.vn/redirect?to="},{url:"https://romgoc.net",replace:"https://romgoc.net/redirect-to/?url="},{url:"https://tophanmem.com",replace:"https://tophanmem.com/redirect-to/?url="},{url:"https://anonyviet.com",replace:"https://anonyviet.com/tieptucdidentrangmoi/?url="},{url:"https://icongnghe.com",replace:"https://icongnghe.com/download/?url="},{url:"https://cakhia-tv.onl",replace:"/chuyen-huong/?redirect="},{url:"www.hdvietnam.",selector:'a[href*="/diendan/chuyenlink.php?url="]',replace:/http(s?):\/\/www.hdvietnam\.(com|me)\/diendan\/chuyenlink\.php\?url=/},{url:"anonyviet.com",replace:"https://anonyviet.com/tieptucdentrangmoi/?url="}].forEach(function(e){this.removeRedir(e)}.bind(this))},init:function(){this.url=location.href,configure.getValue("remove_redirect",!0)&&this.removeRedirect(),this.antiAdblockRemover(),this.ios_codevn_net(),this.linkneverdie(),this.redirect_dafontvn_com(),this.game24h_vn()}},adBlocker={mgIdAdRemover:function(){if(!/ios\.codevn\.net/.test(location.hostname)){var e=document.querySelectorAll('[id*="ScriptRoot"]');if(e&&e.length){ABPVN.cTitle(),Logger.log("Removed mgIdAd placeholder");for(var t=0;t<e.length;t++)"megaup.net"!==location.hostname&&(e[t].id="ScriptRoot-removed-by-abpvn-"+Math.random()),e[t].innerHTML=""}}},noAdsModal:function(){if(location.hostname.match(/vebo|90phut|khomuc|xoilac|banhkhuc/)){const e=document.createElement("style");e.innerHTML="html,body{overflow: auto!important} .modal-backdrop,.modal{display: none!important}",document.head.appendChild(e),ABPVN.cTitle()}},init:function(){this.url=location.href,this.mgIdAdRemover(),this.noAdsModal()}},configure={urls:{setting:"https://abpvn.com/script-setting.html",issue:"https://github.com/abpvn/abpvn/issues/new",fanpage:"https://www.facebook.com/abpvn.org"},openUrl:function(e){"function"==typeof GM_openInTab&&GM_openInTab(e)},getValue:function(e,t){var n;return"function"==typeof GM_getValue&&(n=GM_getValue(e)),void 0===n?t:n},setValue:function(e,t){if("function"==typeof GM_setValue)return GM_setValue(e,t)},setUpSetting:function(){if(this.url===this.urls.setting){var e=document.querySelector("#setting-container");if(e){e.classList.add("installed");var t=e.querySelectorAll('input[type="checkbox"]');t&&t.forEach((e=>{e.checked=this.getValue(e.name,!0),e.addEventListener("change",(e=>{var t=e.target.name;this.setValue(t,e.target.checked)}))}))}}},init:function(){this.url=location.href,"function"==typeof GM_registerMenuCommand&&(GM_registerMenuCommand("ABPVN - C√†i ƒë·∫∑t",(()=>{this.openUrl(this.urls.setting)})),GM_registerMenuCommand("ABPVN - B√°o l·ªói",(()=>{this.openUrl(this.urls.issue)})),GM_registerMenuCommand("ABPVN - Fanpage",(()=>{this.openUrl(this.urls.fanpage)}))),this.setUpSetting()}},ABPVN={cTitle:function(){-1===document.title.indexOf(" - Fixed by ABPVN.COM")&&(document.title=document.title+" - Fixed by ABPVN.COM")},init:function(){adBlocker.init(),getLink.init(),fixSite.init(),byPass.init(),window===window.parent&&configure.init()}};ABPVN.init();