// ==UserScript==
// @name		手机浏览器触摸手势
// @name:en		Mobile browser touch gestures
// @description	为手机浏览器添加触摸手势，即装即用，无需配置。除了通用手势外，还有针对文字、图片、视频的特殊手势。还嫌不够？支持添加属于你的个性化手势。推荐使用狐猴浏览器、Edge浏览器和Yandex浏览器。
// @description:en	Add touch gestures to your mobile browser, ready to use and no configuration required. In addition to general gestures, there are also special gestures for text, images, and videos. Do you still think it's not enough? Support adding personalized gestures that belong to you. We recommend using Lemur browser, Edge browser and Yandex browser.
// @version		9.6.5
// @author		L.Xavier
// @namespace	https://greasyfork.org/zh-CN/users/128493
// @match		*://*/*
// @license		MIT
// @grant		window.close
// @grant		GM_setValue
// @grant		GM_getValue
// @grant		GM_openInTab
// @grant		GM_setClipboard
// @grant		GM_addValueChangeListener
// @run-at		document-start
// @downloadURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/E6898BE69CBAE6B58FE8A788E599A8E8A7A6E691B8E6898BE58ABF.user.js
// @updateURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/E6898BE69CBAE6B58FE8A788E599A8E8A7A6E691B8E6898BE58ABF.meta.js
// ==/UserScript==
const gestureData={gesture:{"↑→↓←":{name:"打开设置",code:"/*ONLY TOP*/gestureData.openSet();"},"◆◆":{name:"视频全屏",code:"gestureData.videoFullScreen();"},"●":{name:"手势穿透",code:'if(/^[TIV]/.test(gestureData.path)){gestureData.path=(gestureData.path.indexOf("I")>-1) ? "I" : "";}if(gestureData.path!=="I" && gestureData.settings["图片手势"]){if(gestureData.touchEle.nodeName!=="IMG"){let imgs=[...document.querySelectorAll("[_imgShow_=\'1\']")];if(gestureData.shadowList){for(let Ti=0,len=gestureData.shadowList.length;Ti<len;++Ti){imgs.push(...gestureData.shadowList[Ti].querySelectorAll("[_imgShow_=\'1\']"));}}for(let Ti=0,len=imgs.length;Ti<len;++Ti){if(imgs[Ti].nodeName!=="IMG" && getComputedStyle(imgs[Ti]).backgroundImage==="none"){continue;}let imgRect=imgs[Ti].getBoundingClientRect();if(gestureData.touchStart.clientX>imgRect.x && gestureData.touchStart.clientX<(imgRect.x+imgRect.width) && gestureData.touchStart.clientY>imgRect.y && gestureData.touchStart.clientY<(imgRect.y+imgRect.height)){gestureData.touchEle=imgs[Ti];break;}}}if(gestureData.path || gestureData.selectWords || !(gestureData.touchEle.compareDocumentPosition(gestureData.videoPlayer) & Node.DOCUMENT_POSITION_FOLLOWING)){if(gestureData.touchEle.nodeName==="IMG"){gestureData.path="I";}else{let bgImg=getComputedStyle(gestureData.touchEle).backgroundImage;if(bgImg!=="none"){gestureData.touchEle.src=bgImg.split(\'"\')[1];gestureData.path="I";}}}}'},"→←":{name:"后退",code:"/*ONLY TOP*/function pageBack(){if(gestureData.backTimer){history.go(-1);setTimeout(pageBack,20);}}gestureData.backTimer=setTimeout(()=>{gestureData.backTimer=0;window.close();},200);pageBack();"},"←→":{name:"前进",code:"/*ONLY TOP*/history.go(1);"},"↓↑":{name:"回到顶部",code:'/*WITH TOP*/let boxNode=gestureData.touchEle.parentNode;while(boxNode.nodeName!=="#document"){boxNode.scrollIntoView(true);if(boxNode.scrollTop){boxNode.scrollTo(0,0);}boxNode=boxNode.parentNode;}'},"↑↓":{name:"回到底部",code:'/*WITH TOP*/let boxNode=gestureData.touchEle.parentNode;while(boxNode.nodeName!=="#document"){if(getComputedStyle(boxNode).overflowY!=="hidden"){boxNode.scrollTo(0,boxNode.scrollHeight+999999);}boxNode=boxNode.parentNode;}'},"←↓":{name:"刷新页面",code:'/*ONLY TOP*/document.documentElement.style.cssText="filter:grayscale(100%)";history.go(0);'},"←↑":{name:"新建页面",code:'/*ONLY TOP*/gestureData.GM_openInTab("//limestart.cn");'},"→↓":{name:"关闭页面",code:"/*ONLY TOP*/window.close();"},"→↑":{name:"恢复页面",code:'/*ONLY TOP*/gestureData.GM_openInTab("chrome-native://recent-tabs");'},"↓↑●":{name:"新页面打开",code:'let linkNode=gestureData.touchEle;while(true){if(linkNode.href){gestureData.GM_openInTab(linkNode.href);break;}linkNode=linkNode.parentNode;if(linkNode.nodeName==="BODY"){gestureData.touchEle.click();break;}}'},"↑↓●":{name:"隐藏元素",code:'let boxNode=gestureData.touchEle,area=boxNode.offsetWidth*boxNode.offsetHeight,area_p=boxNode.parentNode.offsetWidth*boxNode.parentNode.offsetHeight,area_s=screen.width*screen.height;while(boxNode.parentNode.nodeName!=="BODY" && area/area_p>0.2 && area_p/area_s<0.9){boxNode=boxNode.parentNode;area_p=boxNode.parentNode.offsetWidth*boxNode.parentNode.offsetHeight;}if(boxNode.nodeName!=="HTML"){boxNode.remove();}'},"↓→":{name:"复制页面",code:"/*ONLY TOP*/gestureData.GM_openInTab(location.href);"},"→←→":{name:"半屏模式",code:'/*ONLY TOP*/if(gestureData.halfScreen){setTimeout(()=>{gestureData.halfScreen.remove();halfClose.remove();gestureData.halfScreen=null;document.documentElement.scrollTop=gestureData.scrollTop;},500);gestureData.scrollTop=document.body.scrollTop;let halfClose=gestureData.addStyle("html{transform:translateY(0) !important;}");}else{gestureData.scrollTop=document.documentElement.scrollTop;gestureData.halfScreen=gestureData.addStyle("html,body{height:43vh !important;overflow-y:auto !important;}html{transform:translateY(50vh) !important;transition:0.5s !important;overflow:hidden !important;}");document.body.scrollTop=gestureData.scrollTop;}'},"→↓↑←":{name:"视频解析",code:'/*ONLY TOP*/gestureData.GM_openInTab("https://jx.xmflv.com/?url="+location.href);'},"T→↑":{name:"百度翻译",code:'gestureData.GM_openInTab("//fanyi.baidu.com/#auto/auto/"+encodeURIComponent(gestureData.selectWords));'},"T←↑":{name:"有道翻译",code:'gestureData.GM_openInTab("//dict.youdao.com/w/eng/"+encodeURIComponent(gestureData.selectWords));'},"T◆◆":{name:"双击搜索",code:'gestureData.GM_setClipboard(gestureData.selectWords);if(!/^((https?:)?\\/\\/)?([\\w\\-]+\\.)+\\w{2,4}(:\\d{1,5})?(\\/\\S*)?$/.test(gestureData.selectWords.trim())){gestureData.selectWords="//bing.com/search?q="+encodeURIComponent(gestureData.selectWords);}else if(!/^(https?:)?\\/\\//.test(gestureData.selectWords.trim())){gestureData.selectWords="//"+gestureData.selectWords.trim();}gestureData.GM_openInTab(gestureData.selectWords.trim());'},"I↓↑●":{name:"打开图片",code:"gestureData.GM_openInTab(gestureData.touchEle.src);"},"I→↑●":{name:"百度搜图",code:'gestureData.GM_openInTab("//graph.baidu.com/details?isfromtusoupc=1&tn=pc&carousel=0&promotion_name=pc_image_shituindex&extUiData%5bisLogoShow%5d=1&image="+gestureData.touchEle.src);'},"V→":{name:"前进10s",code:'gestureData.videoPlayer.currentTime+=10;gestureData.tipBox.textContent="+10s ";gestureData.tipBox.style.display="block";setTimeout(()=>{gestureData.tipBox.style.display="none";},500);'},"V←":{name:"后退10s",code:'gestureData.videoPlayer.currentTime-=10;gestureData.tipBox.textContent="-10s ";gestureData.tipBox.style.display="block";setTimeout(()=>{gestureData.tipBox.style.display="none";},500);'},"V↑":{name:"增加倍速",code:'if(document.fullscreen){let playSpeed=gestureData.videoPlayer.playbackRate;playSpeed+=(playSpeed<1.5) ? 0.25 : 0.5;gestureData.tipBox.textContent="×"+playSpeed+" ∞ ";gestureData.tipBox.style.display="block";gestureData.videoPlayer.playbackRate=playSpeed;setTimeout(()=>{gestureData.tipBox.style.display="none";},500)}'},"V↓":{name:"减小倍速",code:'if(document.fullscreen){let playSpeed=gestureData.videoPlayer.playbackRate;playSpeed-=(playSpeed>1.5) ? 0.5 : (playSpeed>0.25 && 0.25);gestureData.tipBox.textContent="×"+playSpeed+" ∞ ";gestureData.tipBox.style.display="block";gestureData.videoPlayer.playbackRate=playSpeed;setTimeout(()=>{gestureData.tipBox.style.display="none";},500)}'},"V→●":{name:"快进播放",code:'gestureData.playSpeed=gestureData.videoPlayer.playbackRate;gestureData.videoPlayer.playbackRate=10;gestureData.tipBox.textContent="×10 ";gestureData.tipBox.style.display="block";'},"V→○":{name:"停止快进",code:'gestureData.videoPlayer.playbackRate=gestureData.playSpeed;gestureData.tipBox.style.display="none";'},"V←●":{name:"快退播放",code:'gestureData.videoTimer=setInterval(()=>{--gestureData.videoPlayer.currentTime;},100);gestureData.tipBox.textContent="- ×10 ";gestureData.tipBox.style.display="block";'},"V←○":{name:"停止快退",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.display="none";'},"V↑●":{name:"增加音量",code:'if(document.fullscreen){gestureData.videoPlayer.muted=false;gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";gestureData.tipBox.style.display="block";let lastY=gestureData.touchEnd.screenY;gestureData.videoTimer=setInterval(()=>{if(lastY-gestureData.touchEnd.screenY){let tempVolume=gestureData.videoPlayer.volume+(lastY-gestureData.touchEnd.screenY)/100;gestureData.videoPlayer.volume=+(tempVolume>1) || (+(tempVolume>0) && tempVolume);gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";lastY=gestureData.touchEnd.screenY;}},50);}'},"V↑○":{name:"关闭增加音量",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.display="none";'},"V↓●":{name:"减少音量",code:'if(document.fullscreen){gestureData.videoPlayer.muted=false;gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";gestureData.tipBox.style.display="block";let lastY=gestureData.touchEnd.screenY;gestureData.videoTimer=setInterval(()=>{if(lastY-gestureData.touchEnd.screenY){let tempVolume=gestureData.videoPlayer.volume+(lastY-gestureData.touchEnd.screenY)/100;gestureData.videoPlayer.volume=+(tempVolume>1) || (+(tempVolume>0) && tempVolume);gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";lastY=gestureData.touchEnd.screenY;}},50);}'},"V↓○":{name:"关闭减少音量",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.display="none";'},"V→▼":{name:"右滑进度",code:'let lastX=gestureData.touchEnd.screenX,hour,minu,sec;function showTip(){minu=gestureData.videoPlayer.currentTime/60;sec=gestureData.videoPlayer.currentTime%60;hour=minu/60;minu%=60;gestureData.tipBox.textContent=(hour|0)+":"+((minu<10) ? "0":"")+(minu|0)+":"+((sec<10) ? "0" : "")+(sec|0);}showTip();gestureData.tipBox.style.display="block";gestureData.videoTimer=setInterval(()=>{let len=gestureData.touchEnd.screenX-lastX;if(len){gestureData.videoPlayer.currentTime+=len*(1+Math.abs(len)*gestureData.videoPlayer.duration/10800).toFixed(2);lastX=gestureData.touchEnd.screenX;}showTip();},50);'},"V→▽":{name:"关闭右滑进度",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.display="none";'},"V←▼":{name:"左滑进度",code:'let lastX=gestureData.touchEnd.screenX,hour,minu,sec;function showTip(){minu=gestureData.videoPlayer.currentTime/60;sec=gestureData.videoPlayer.currentTime%60;hour=minu/60;minu%=60;gestureData.tipBox.textContent=(hour|0)+":"+((minu<10) ? "0":"")+(minu|0)+":"+((sec<10) ? "0" : "")+(sec|0);}showTip();gestureData.tipBox.style.display="block";gestureData.videoTimer=setInterval(()=>{let len=gestureData.touchEnd.screenX-lastX;if(len){gestureData.videoPlayer.currentTime+=len*(1+Math.abs(len)*gestureData.videoPlayer.duration/10800).toFixed(2);lastX=gestureData.touchEnd.screenX;}showTip();},50);'},"V←▽":{name:"关闭左滑进度",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.display="none";'}},settings:{"滑动系数":[.2,0,.5,2],"文字手势":!0,"图片手势":!0,"视频手势":!0,"网页加速":!1,"视频下载":!1,"避免断触":!1}};gestureData.GM_setValue=GM_setValue,gestureData.GM_getValue=GM_getValue,gestureData.GM_openInTab=GM_openInTab,gestureData.GM_setClipboard=GM_setClipboard,gestureData.gesture=gestureData.GM_getValue("gesture",gestureData.gesture),gestureData.settings=gestureData.GM_getValue("settings",gestureData.settings);const LIMIT=((screen.width>screen.height?screen.height:screen.width)*gestureData.settings["滑动系数"][0])**2,ATTACH_SHADOW=Element.prototype.attachShadow,CHECK_M_OBSERVER=new MutationObserver((()=>{checkTimer||(checkTimer=setTimeout(loadCheck,200))})),IMG_I_OBSERVER=new IntersectionObserver((e=>{for(let t=0,a=e.length;t<a;++t)e[t].intersectionRatio?e[t].target.setAttribute("_imgShow_","1"):e[t].target.setAttribute("_imgShow_","0")})),A_I_OBSERVER=new IntersectionObserver((e=>{for(let t=0,a=e.length;t<a;++t){let a=e[t].target,o=Date.now();e[t].intersectionRatio?(a.setAttribute("_linkShow_","1"),o-a._prefetch_>3e5&&(a._prefetch_=o,document.head.insertAdjacentHTML("beforeend",'<link rel="prefetch" href="'+a.href.replace(/^https?:/,"")+'"/>'))):a.setAttribute("_linkShow_","0")}}),{rootMargin:"50%"});let startPoint={},timeSpan=0,pressTime=0,raiseTime=0,slideTime=0,slideClock=0,slideLimit=0,fingersNum=0,gestureTimer=0,clickTimer=0,isAllow=0,isClick=0;function longPress(){if(isAllow&&!/[●○▽]$/.test(gestureData.path)){isAllow=isClick=0,startPoint=gestureData.touchEnd;let e=gestureData.path+"○";gestureData.path+="●",gestureData.runGesture(e)}}function slidingRun(){slideClock=0;let e=gestureData.path+"▽";gestureData.path+="▼",gestureData.runGesture(e),gestureData.path=gestureData.path.replace("▼","")}function touchStart(e){if(clearTimeout(gestureTimer),(fingersNum=e.touches.length)>1)return;pressTime=Date.now(),timeSpan=pressTime-raiseTime;let t=raiseTime&&(e.changedTouches[0].screenX-gestureData.touchEnd.screenX)**2+(e.changedTouches[0].screenY-gestureData.touchEnd.screenY)**2;if(timeSpan>50||t>LIMIT){if(startPoint=e.changedTouches[0],timeSpan>200||t>4*LIMIT){if(gestureData.path="",slideLimit=LIMIT,gestureData.touchEle=e.target,gestureData.touchEnd=gestureData.touchStart=startPoint,gestureData.selectWords=window.getSelection()+"",gestureData.selectWords&&gestureData.settings["文字手势"])gestureData.path="T";else if(document.contains(gestureData.videoPlayer)&&gestureData.settings["视频手势"]){let e=gestureData.findVideoBox().getBoundingClientRect();fullsState>0&&gestureData.touchStart.clientY<e.y+e.height/8?gestureData.path="!":gestureData.touchStart.clientX>e.x&&gestureData.touchStart.clientX<e.x+e.width&&gestureData.touchStart.clientY>e.y&&gestureData.touchStart.clientY<e.y+e.height&&(gestureData.path="V")}}else isClick&&e.preventDefault();slideTime=pressTime,isAllow=isClick=1}else isClick&&(clearTimeout(clickTimer),gestureData.path=gestureData.path.slice(0,-1));gestureTimer=setTimeout(longPress,300+slideTime-pressTime)}function touchMove(e){if(clearTimeout(gestureTimer),gestureData.touchEnd=e.changedTouches?e.changedTouches[0]:e,window._isPushing_&&setTimeout(window._isPushing_),/[○▽]$/.test(gestureData.path)||fingersNum>1)return;let t=(gestureData.touchEnd.screenX-startPoint.screenX)**2,a=(gestureData.touchEnd.screenY-startPoint.screenY)**2,o=t>1.42*a?gestureData.touchEnd.screenX>startPoint.screenX?"→":"←":gestureData.touchEnd.screenY>startPoint.screenY?"↓":"↑",i=Date.now(),r=t+a,s=gestureData.path.slice(-1);r>LIMIT/576&&(slideTime=i,isClick=0,s===o||r>slideLimit?(s!==o&&(timeSpan<50||"TIV◆".indexOf(s)>-1)&&(gestureData.path+=o,slideLimit*=slideLimit<LIMIT/2||.64,slideClock=i,isAllow=1,timeSpan=0),startPoint=gestureData.touchEnd,slideClock&&i-slideClock>300&&setTimeout(slidingRun)):r>LIMIT/100&&(slideClock=isAllow=0)),gestureTimer=setTimeout(longPress,300+slideTime-i)}function touchEnd(e){clearTimeout(gestureTimer),--fingersNum>0?/[○▽]$/.test(gestureData.path)||(gestureData.path="!"):(window._isPushing_&&(window._isPushing_=null),gestureData.touchEnd=e.changedTouches[0],raiseTime=Date.now(),setTimeout(iframeLock),/[○▽]$/.test(gestureData.path)?setTimeout(gestureData.runGesture):(isClick&&(gestureData.path+="◆",/^V◆◆$|^T/.test(gestureData.path)&&(e.stopPropagation(),e.preventDefault(),window.getSelection().empty())),isAllow&&(gestureTimer=setTimeout(gestureData.runGesture,199))))}function delayClick(e){if(e.isTrusted){if(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),timeSpan<50)return;let t=new PointerEvent("click",{bubbles:!0,cancelable:!0,clientX:e.clientX,clientY:e.clientY,composed:!0,detail:1,layerX:e.layerX,layerY:e.layerY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,pointerId:e.pointerId,pointerType:e.pointerType,screenX:e.screenX,screenY:e.screenY,sourceCapabilities:e.sourceCapabilities,view:e.view,x:e.x,y:e.y});clickTimer=setTimeout((()=>{e.target.dispatchEvent(t)}),50)}}gestureData.runCode=code=>{try{eval(code)}catch(error){(error+"").indexOf("unsafe-eval")>-1?(eval=function(){this.gestureData=gestureData,this.close=window.close;let e=document.createElement("script");return t=>{e.remove(),e=document.createElement("script"),e.textContent="try{"+t+'}catch(error){alert("“"+gestureData.path+"” 手势执行脚本错误：\\n"+error+" ！");}',document.body.insertAdjacentElement("beforeend",e)}}(),eval(code)):alert("“"+gestureData.path+"” 手势执行脚本错误：\n"+error+" ！")}},gestureData.runFrame=e=>{let t=gestureData.gesture[e].code;if(top===self||/^[TIV]/.test(e))gestureData.runCode(t);else if(t.indexOf("/*ONLY TOP*/")<0&&gestureData.runCode(t),/\/\*(ONLY|WITH) TOP\*\//.test(t)){/[●▼]$/.test(e)&&(window._isPushing_=()=>{let e={};e.touchEnd=copyTouch(gestureData.touchEnd),top.postMessage({type:"pushTouch",gestureData:e},"*")});let t={};t.touchStart=copyTouch(gestureData.touchStart),t.touchEnd=copyTouch(gestureData.touchEnd),top.postMessage({type:"runPath",runPath:gestureData.path,gestureData:t},"*")}},gestureData.runGesture=e=>{gestureData.gesture[gestureData.path]?(gestureData.runFrame(gestureData.path),gestureData.gesture[e]&&(gestureData.path=e)):gestureData.gesture[gestureData.path.slice(1)]&&/^[TIV]/.test(gestureData.path)&&(gestureData.runFrame(gestureData.path.slice(1)),gestureData.gesture[e?.slice(1)]&&(gestureData.path=e)),raiseTime=0};let oriLock=0,resizeTimer=0,fullsState=0;async function setVideo(e){let t=e.target||e;!1===gestureData.videoPlayer?.paused&&!0===t.muted||(gestureData.videoPlayer=t,videoOriLock(),gestureData.videoPlayer.parentNode.insertAdjacentElement("beforeend",gestureData.tipBox),gestureData.settings["视频下载"]&&(await(gestureData.findVideoBox()?.insertAdjacentElement("beforeend",gestureData.videoPlayer._downloadTip_)),window._urlObjects_[gestureData.videoPlayer.src]?(gestureData.videoPlayer._downloadTip_.textContent="正在捕获",gestureData.videoPlayer._downloadTip_.buffers=window._urlObjects_[gestureData.videoPlayer.src].sourceBuffers,window._urlObjects_[gestureData.videoPlayer.src]._downloadTip_=gestureData.videoPlayer._downloadTip_,delete window._urlObjects_[gestureData.videoPlayer.src]):"未加载"===gestureData.videoPlayer._downloadTip_.textContent&&(!gestureData.videoPlayer.src&&gestureData.videoPlayer.children.length&&(gestureData.videoPlayer.src=gestureData.videoPlayer.firstChild.src),gestureData.videoPlayer.src.indexOf("blob:")&&gestureData.videoPlayer.src&&(gestureData.videoPlayer._downloadTip_.textContent="可下载"))))}function videoOriLock(){if(!gestureData.videoPlayer.videoWidth)return!gestureData.videoPlayer.error&&document.contains(gestureData.videoPlayer)&&setTimeout(videoOriLock,100),void(oriLock=0);oriLock=+(gestureData.videoPlayer.videoWidth>gestureData.videoPlayer.videoHeight),fullsState>0&&oriLock?top.postMessage({type:"GYRO"},"*"):screen.orientation.unlock()}function iframeLock(){top===self||window._isShow_||gestureData.GM_setValue("isShow",Date.now())}function regRESIZE(){let e=gestureData.addStyle(""),t=()=>{resizeTimer=0};window.addEventListener("resize",(()=>{if(clearTimeout(resizeTimer),resizeTimer=setTimeout(t,200),document.fullscreen&&!fullsState){if(fullsState=document.fullscreenElement,"IFRAME"===fullsState.nodeName)return void(fullsState=-1);let t=fullsState.getElementsByTagName("video"),a="VIDEO"===fullsState.nodeName?fullsState:t[0];if(!fullsState.hasAttribute("_videobox_")&&(!a||t.length>1||a._videoBox_.offsetWidth*a._videoBox_.offsetHeight*1.2<fullsState.offsetWidth*fullsState.offsetHeight))return void(fullsState=-1);a!==gestureData.videoPlayer&&(gestureData.videoPlayer?.pause(),setVideo(a)),fullsState=1,oriLock&&top.postMessage({type:"GYRO"},"*"),e.textContent='*[_videobox_]{inset:0 !important;margin:0 !important;padding:0 !important;}*[_videobox_=""]{width:100% !important;height:100% !important;max-width:100% !important;max-height:100% !important;}video{object-fit:contain !important;}'}else fullsState&&!document.fullscreen&&(fullsState=0,e.textContent="")}),!0)}if(gestureData.videoFullScreen=async()=>{resizeTimer||(document.fullscreen?await(document.exitFullscreen()?.catch(Date)):gestureData.videoPlayer?await(gestureData.findVideoBox()?.requestFullscreen()?.catch(Date)):iframeEles.length&&gestureData.GM_setValue("fullscreen",Date.now()))},gestureData.findVideoBox=(e=gestureData.videoPlayer)=>{if(!document.contains(e))return null;if(e._videoBox_?.contains(e)&&(document.fullscreen||e._boxHeight_===e._videoBox_.clientHeight))return e._videoBox_;e._videoBox_=e.parentNode,e.setAttribute("_videobox_","");let t=e._videoBox_.parentNode,a=getComputedStyle(e),o=getComputedStyle(e._videoBox_),i=0,r=0,s=0,n=0;for(e._videoBox_.offsetParent===t?(i=Math.round(e.offsetWidth+ +a.marginLeft.slice(0,-2)+ +a.marginRight.slice(0,-2)),r=Math.round(e.offsetHeight+ +a.marginTop.slice(0,-2)+ +a.marginBottom.slice(0,-2)),s=Math.round(e._videoBox_.offsetWidth+ +o.marginLeft.slice(0,-2)+ +o.marginRight.slice(0,-2)),n=Math.round(e._videoBox_.offsetHeight+ +o.marginTop.slice(0,-2)+ +o.marginBottom.slice(0,-2))):(i=Math.round(e.offsetWidth+(+a.left.slice(0,-2)||0)+ +a.marginLeft.slice(0,-2)+ +a.marginRight.slice(0,-2)+(+a.right.slice(0,-2)||0)),r=Math.round(e.offsetHeight+(+a.top.slice(0,-2)||0)+ +a.marginTop.slice(0,-2)+ +a.marginBottom.slice(0,-2)+(+a.bottom.slice(0,-2)||0)),s=Math.round(e._videoBox_.offsetWidth+(+o.left.slice(0,-2)||0)+ +o.marginLeft.slice(0,-2)+ +o.marginRight.slice(0,-2)+(+o.right.slice(0,-2)||0)),n=Math.round(e._videoBox_.offsetHeight+(+o.top.slice(0,-2)||0)+ +o.marginTop.slice(0,-2)+ +o.marginBottom.slice(0,-2)+(+o.bottom.slice(0,-2)||0))),i=i>s?i:s,r=r>n?r:n;i>=t.clientWidth&&"BODY"!==t.nodeName;){if(r<t.clientHeight){let a=1;for(let i of t.children)if(o=getComputedStyle(i),r=Math.round(i.offsetHeight+(+o.top.slice(0,-2)||0)+ +o.marginTop.slice(0,-2)+ +o.marginBottom.slice(0,-2)+(+o.bottom.slice(0,-2)||0)),r>=t.clientHeight&&1.2*e.clientHeight>=t.clientHeight){a=0;break}if(a)break}t.clientHeight&&(e._videoBox_.setAttribute("_videobox_",""),e._videoBox_=t,e._boxHeight_=t.clientHeight,o=getComputedStyle(t),t.offsetParent===t.parentNode?(s=Math.round(t.offsetWidth+ +o.marginLeft.slice(0,-2)+ +o.marginRight.slice(0,-2)),n=Math.round(t.offsetHeight+ +o.marginTop.slice(0,-2)+ +o.marginBottom.slice(0,-2))):(s=Math.round(t.offsetWidth+(+o.left.slice(0,-2)||0)+ +o.marginLeft.slice(0,-2)+ +o.marginRight.slice(0,-2)+(+o.right.slice(0,-2)||0)),n=Math.round(t.offsetHeight+(+o.top.slice(0,-2)||0)+ +o.marginTop.slice(0,-2)+ +o.marginBottom.slice(0,-2)+(+o.bottom.slice(0,-2)||0))),i=i>s?i:s,r=r>n?r:n),t=t.parentNode}return e._videoBox_.setAttribute("_videobox_","outer"),e._videoBox_},gestureData.settings["视频下载"]){const e=URL.createObjectURL,t=MediaSource.prototype.addSourceBuffer,a=SourceBuffer.prototype.appendBuffer,o=MediaSource.prototype.endOfStream;window._initDownload_=e=>{e._downloadTip_=document.createElement("div"),e._downloadTip_.style.cssText="position:absolute;right:0;top:20px;background:#3498db;border-radius:20px 0 0 20px;text-align:center;padding:20px;line-height:0px;color:#fff;min-width:60px;font-size:16px;font-family:system-ui;z-index:2147483647;",e._downloadTip_.target=e,e._downloadTip_.textContent="未加载",window._urlObjects_[e.src]?(e._downloadTip_.textContent="正在捕获",e._downloadTip_.buffers=window._urlObjects_[e.src].sourceBuffers,window._urlObjects_[e.src]._downloadTip_=e._downloadTip_,delete window._urlObjects_[e.src]):(!e.src&&e.children.length&&(e.src=e.firstChild.src),e.src.indexOf("blob:")&&e.src&&(e._downloadTip_.textContent="可下载")),e._downloadTip_.onclick=window._downloadVideo_,e._videoBox_.insertAdjacentElement("beforeend",e._downloadTip_)},window._downloadVideo_=function(e){if("未加载"===this.textContent)return;e.target&&((e=this).src=this.target.src);let t=e.buffers;if(top!==self){let a=[];for(let e=0,o=t.length;e<o;++e)a.push({mime:t[e]._mime_,bufferList:t[e]._bufferList_});return void top.postMessage({type:"download",buffers:a,src:e.src},"*")}let a=document.createElement("a");if(a.download=document.title,a.style.display="none",document.body.insertAdjacentElement("beforeend",a),e.src.indexOf("blob:")&&e.src)a.href=e.src,a.click();else if(t.length)for(let e=0,o=t.length;e<o;++e)a.href=URL.createObjectURL(new Blob(t[e]._bufferList_,{type:t[e]._mime_})),a.click(),URL.revokeObjectURL(a.href);a.remove()},window._urlObjects_={},URL.createObjectURL=t=>{let a=e(t);return t.sourceBuffers&&(window._urlObjects_[a]=t),a},MediaSource.prototype.addSourceBuffer=function(e){let a=t.call(this,e);return a._bufferList_=[],a._mime_=e,a._mediaSource_=this,a},SourceBuffer.prototype.appendBuffer=function(e){this._bufferList_.push(e),this._mime_.indexOf("video")>-1&&this._mediaSource_._downloadTip_&&(this._mediaSource_._downloadTip_.textContent="已捕获"+this._bufferList_.length+"个片段"),a.call(this,e)},MediaSource.prototype.endOfStream=function(){this._downloadTip_&&(this._downloadTip_.textContent="可下载"),o.call(this)}}let videoEles=[],imgEles=[],aEles=[],iframeEles=document.getElementsByTagName("iframe"),checkTimer=0;async function loadCheck(){if(aEles=[...document.querySelectorAll("a:not([_linkShow_])")],videoEles=[...document.querySelectorAll("video:not([_videoBox_])")],imgEles=[...document.querySelectorAll("img:not([_imgShow_])"),...document.querySelectorAll('[style*="url("]:not([_imgShow_])')],gestureData.shadowList)for(let e=0,t=gestureData.shadowList.length;e<t;++e)aEles.push(...gestureData.shadowList[e].querySelectorAll("a:not([_linkShow_])")),videoEles.push(...gestureData.shadowList[e].querySelectorAll("video:not([_videoBox_])")),await imgEles.push(...gestureData.shadowList[e].querySelectorAll("img:not([_imgShow_])"),...gestureData.shadowList[e].querySelectorAll('[style*="url("]:not([_imgShow_])'));if(videoEles.length&&gestureData.settings["视频手势"]){gestureData.tipBox||(regRESIZE(),top!==self&&top.postMessage({type:"forceFullScreen"},"*"),gestureData.tipBox=document.createElement("div"),gestureData.tipBox.style.cssText="min-width:80px;height:50px;padding:0 10px;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:none;color:#1e87f0;font-size:22px;line-height:50px;text-align:center;background-color:rgba(0,0,0,0.6);border-radius:20px;font-family:system-ui;z-index:2147483647;");for(let e=0,t=videoEles.length;e<t;++e)!videoEles[e]._videoBox_&&videoEles[e].offsetHeight&&(await gestureData.findVideoBox(videoEles[e]),gestureData.settings["视频下载"]&&await window._initDownload_(videoEles[e]),videoEles[e].paused||setVideo(videoEles[e]),videoEles[e].addEventListener("playing",setVideo,!0))}if(gestureData.settings["图片手势"])for(let e=0,t=imgEles.length;e<t;++e)imgEles[e].setAttribute("_imgShow_","0"),IMG_I_OBSERVER.observe(imgEles[e]);if(gestureData.settings["网页加速"])for(let e=0,t=aEles.length;e<t;++e){let t=aEles[e];t.setAttribute("_linkShow_","0"),t.href.indexOf("/")>-1&&(t._prefetch_=0,A_I_OBSERVER.observe(t),t.addEventListener("click",(()=>{t._prefetch_=0}),!0))}checkTimer=0}function copyTouch(e){let t={};for(let a in e)"target"!==a&&(t[a]=e[a]);return t}window.trustedTypes?.createPolicy("default",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e}),Element.prototype.attachShadow=function(){gestureData.shadowList||(gestureData.shadowList=[]);let e=ATTACH_SHADOW.call(this,arguments[0]);return gestureData.shadowList.push(e),CHECK_M_OBSERVER.observe(e,{childList:!0,subtree:!0}),e},gestureData.addStyle=e=>{let t=document.createElement("style");if(t.textContent=e,document.head)return document.head.insertAdjacentElement("beforeend",t),t;setTimeout((()=>{gestureData.addStyle(e)}))},gestureData.openSet=()=>{let e="",t="",a=document.createElement("div"),o=null,i=0;function r(){if(e=this.parentNode.getAttribute("name"),["打开设置","视频全屏","手势穿透"].indexOf(e)>-1)return void alert("该手势脚本无法修改！");t=this.parentNode.getAttribute("path");let a=/^[TIV]/.test(t)?"_"+t.slice(0,1)+"_":"_G_";document.getElementById(a).click(),document.getElementById("_gestureName_").value=e,document.getElementById("_gestureCode_").value=gestureData.gesture[t].code,document.getElementById("_editGesture_").style.display="block"}function s(){e=this.parentNode.getAttribute("name"),t=this.parentNode.getAttribute("path"),o.textContent="",window.removeEventListener("touchmove",touchMove,!0),window.removeEventListener("pointermove",touchMove,!0),document.getElementById("_revisePath_").style.display="block"}function n(){e=this.parentNode.getAttribute("name"),["打开设置","视频全屏","手势穿透"].indexOf(e)>-1?alert("该手势无法删除！"):confirm('确定删除"'+e+'"手势')&&(t=this.parentNode.getAttribute("path"),delete gestureData.gesture[t],gestureData.GM_setValue("gesture",gestureData.gesture),c())}function l(e){e.preventDefault(),fingersNum=2;let t=e.changedTouches[0].clientX-gestureData.touchStart.clientX,a=+this.style.left.slice(0,-2)+t,o=this.offsetWidth/2,i=gestureData.settings[this.id];a=a<-o?-o:a>(t=this.parentNode.offsetWidth-o)?t:a,this.style.left=a+"px",this.textContent=((a+o)/this.parentNode.offsetWidth*(i[2]-i[1])+i[1]).toFixed(i[3]),gestureData.touchStart=e.changedTouches[0]}function u(){!isClick&&/^$|[●○▼▽]$/.test(o.textContent)||(isClick=0,startPoint=gestureData.touchEnd,o.textContent+="●")}function d(){/[○▼▽]$/.test(o.textContent)||(o.textContent+="◆")}function c(){let e=document.getElementById("_gestureUL_");e.textContent="";for(let t in gestureData.gesture){let a=document.createElement("div"),o=document.createElement("p"),i=document.createElement("div"),l=document.createElement("div");a.className="_gestureLi_",a.setAttribute("name",gestureData.gesture[t].name),a.setAttribute("path",t),o.textContent=gestureData.gesture[t].name,o.addEventListener("click",r,!0),i.className="_gesturePath_",i.textContent=t,i.addEventListener("click",s,!0),l.className="_delGesture_",l.textContent="删除",l.addEventListener("click",n,!0),a.insertAdjacentElement("beforeend",o),a.insertAdjacentElement("beforeend",i),a.insertAdjacentElement("beforeend",l),e.insertAdjacentElement("beforeend",a)}}gestureData.addStyle('*{overflow:hidden !important;}#_gestureBox_{background-color:#fff;width:100%;height:100%;position:fixed;padding:0;margin:0;inset:0;overflow-y:auto !important;z-index:2147483647;}#_gestureBox_ *{font-family:system-ui;margin:0;padding:0;text-align:center;font-size:5vmin;line-height:12vmin;user-select:none !important;transform:none;text-indent:0;}#_gestureBox_ ::placeholder{color:#999;font-size:2.5vmin;line-height:6vmin;}#_gestureBox_ h1{width:60%;height:12vmin;color:#0074d9;background-color:#dee6ef;margin:3vmin auto;border-radius:12vmin;box-shadow:0.9vmin 0.9vmin 3vmin #dfdfdf;}#_gestureBox_ #_addGesture_{width:14vmin;height:14vmin;margin:3vmin auto;line-height:14vmin;background-color:#dee6ef;color:#032e58;font-size:7.5vmin;border-radius:15vmin;box-shadow:0.3vmin 0.3vmin 1.5vmin #dfdfdf;}#_gestureBox_ ._gestureLi_{height:18vmin;width:100%;border-bottom:0.3vmin solid #dfdfdf;}#_gestureBox_ ._gestureLi_ p{margin:3vmin 0 0 1%;width:38%;height:12vmin;border-left:1.8vmin solid;color:#ffb400;background-color:#fff1cf;float:left;white-space:nowrap;text-overflow:ellipsis;text-shadow:0.3vmin 0.3vmin 3vmin #ffcb56;}#_gestureBox_ ._gestureLi_ ._gesturePath_{margin:3vmin 0 0 3%;float:left;width:38%;height:12vmin;background-color:#f3f3f3;color:#000;box-shadow:0.3vmin 0.3vmin 1.5vmin #ccc9c9;border-radius:3vmin;white-space:nowrap;text-overflow:ellipsis;}#_gestureBox_ ._gestureLi_ ._delGesture_{margin:3vmin 2% 0 0;width:15vmin;height:12vmin;float:right;color:#f00;text-decoration:line-through;}#_gestureBox_ #_revisePath_{background-color:rgba(0,0,0,0.7);width:100%;height:100%;position:fixed;inset:0;display:none;color:#000;}#_gestureBox_ #_revisePath_ span{width:15vmin;height:15vmin;font-size:12.5vmin;line-height:15vmin;position:absolute;}#_gestureBox_ #_revisePath_ div{color:#3339f9;position:absolute;width:30%;height:12vmin;font-size:10vmin;bottom:15%;}#_gestureBox_ #_revisePath_ p{color:#3ba5d8;position:absolute;top:15%;font-size:10vmin;height:12vmin;width:100%;}#_gestureBox_ #_revisePath_ #_path_{top:40%;color:#ffee03;height:100%;word-wrap:break-word;font-size:15vmin;line-height:18vmin;}#_gestureBox_ #_editGesture_{overflow-y:auto !important;background-color:#fff;width:100%;height:100%;position:fixed;inset:0;display:none;color:#000;}#_gestureBox_ #_editGesture_ p{color:#3339f9;font-size:7.5vmin;text-align:left;margin:6vmin 0 0 9vmin;width:100%;height:9vmin;line-height:9vmin;}#_gestureBox_ #_editGesture_ #_gestureName_{margin-top:6vmin;width:80%;height:12vmin;color:#000;border:0.3vmin solid #dadada;border-radius:3vmin;text-align:left;padding:0 3vmin;}#_gestureBox_ #_editGesture_ ._label_box_>label{display:inline-block;margin-top:6vmin;position:relative;}#_gestureBox_ #_editGesture_ ._label_box_>label>input{position:absolute;top:0;left:-6vmin;}#_gestureBox_ #_editGesture_ ._label_box_>label>div{width:20vw;border:#ddd solid 0.3vmin;height:12vmin;color:#666;position:relative;}#_gestureBox_ #_editGesture_ ._label_box_>label>input:checked + div{border:#d51917 solid 0.3vmin;color:#d51917;}#_gestureBox_ #_editGesture_ ._label_box_>label>input + div:after{top:auto;left:auto;bottom:-3vmin;right:0;transition:none;}#_gestureBox_ #_editGesture_ ._label_box_>label>input:checked + div:after{content:"";display:block;border:none;width:6vmin;height:6vmin;background-color:#d51917;transform:skewY(-45deg);position:absolute;}#_gestureBox_ #_editGesture_ ._label_box_>label>input:checked + div:before{content:"";display:block;width:0.9vmin;height:2.4vmin;border-right:#fff solid 0.6vmin;border-bottom:#fff solid 0.6vmin;transform:rotate(35deg);position:absolute;bottom:0.6vmin;right:1.2vmin;z-index:1;}#_gestureBox_ #_editGesture_ #_gestureCode_{overflow-y:auto !important;width:80%;margin-top:6vmin;height:40%;text-align:left;line-height:6vmin;padding:3vmin;border:0.3vmin solid #dadada;border-radius:3vmin;}#_gestureBox_ #_editGesture_ button{width:30vmin;height:15vmin;font-size:7.5vmin;line-height:15vmin;display:inline-block;color:#fff;background-color:#2866bd;margin:6vmin 3vmin 0 3vmin;border:none;}#_gestureBox_ #_settingsBox_{overflow-y:auto !important;background-color:#fff;width:100%;height:100%;position:fixed;inset:0;display:none;color:#000;}#_gestureBox_ #_settingsBox_ p{color:#3339f9;text-align:left;margin:9vmin 0 0 9vmin;float:left;height:6vmin;line-height:6vmin;clear:both;}#_gestureBox_ #_settingsBox_ ._slideRail_{overflow:initial !important;width:55%;background-color:#a8a8a8;float:left;margin:12vmin 0 0 3vmin;height:0.6vmin;position:relative;}#_gestureBox_ #_settingsBox_ ._slideRail_ ._slideButton_{line-height:9vmin;color:#fff;background-color:#2196f3;min-width:9vmin;height:9vmin;border-radius:9vmin;font-size:4vmin;position:absolute;top:-4.5vmin;box-shadow:0.3vmin 0.3vmin 1.8vmin #5e8aee;padding:0 1vmin;}#_gestureBox_ #_settingsBox_ ._switch_{position:relative;display:inline-block;width:18vmin;height:9vmin;float:left;margin:7.5vmin 42% 0 3vmin;}#_gestureBox_ #_settingsBox_ ._switch_ input{display:none;}#_gestureBox_ #_settingsBox_ ._slider_{border-radius:9vmin;position:absolute;cursor:pointer;inset:0;background-color:#ccc;transition:0.4s;}#_gestureBox_ #_settingsBox_ ._slider_:before{border-radius:50%;position:absolute;content:"";height:7.5vmin;width:7.5vmin;left:0.6vmin;bottom:0.6vmin;background-color:white;transition:0.4s;}#_gestureBox_ #_settingsBox_ input:checked + ._slider_{background-color:#2196F3;}#_gestureBox_ #_settingsBox_ input:checked + ._slider_:before{transform:translateX(9vmin);}#_gestureBox_ #_settingsBox_ #_saveSettings_{display:block;clear:both;width:30vmin;height:15vmin;font-size:7.5vmin;line-height:15vmin;color:#fff;background-color:#2866bd;border:none;margin:12vmin 0 0 calc(50% - 15vmin);float:left;}'),a.id="_gestureBox_",document.body.insertAdjacentElement("beforeend",a),a.innerHTML='<h1 id="_openSettings_">手势轨迹设置</h1><div id="_addGesture_">+</div><div id="_gestureUL_"></div><div id="_revisePath_"><span style="top:0;left:0;text-align:left;">┌</span><span style="top:0;right:0;text-align:right;">┐</span><span style="bottom:0;left:0;text-align:left;">└</span><span style="bottom:0;right:0;text-align:right;">┘</span><p>请滑动手指</p><p id="_path_"></p><div id="_clearPath_" style="left:10%;">清除</div><div id="_cancleRevise_" style="right:10%;">保存</div></div><div id="_editGesture_"><p>手势名称：</p><input type="text" id="_gestureName_" maxlength="12" placeholder="最大输入12个字符"><p>手势类型：</p><div class="_label_box_"><label><input type="radio" id="_G_" name="_gestureType_" value=""><div>一般</div></label><label><input type="radio" id="_T_" name="_gestureType_" value="T"><div>文字</div></label><label><input type="radio" id="_I_" name="_gestureType_" value="I"><div>图片</div></label><label><input type="radio" id="_V_" name="_gestureType_" value="V"><div>视频</div></label></div><p>手势执行脚本：</p><textarea id="_gestureCode_" placeholder="可用变量说明↓\n \tgestureData：手势数据常量,如果你需要在不同手势间传递变量,你可以赋值gestureData.变量名=变量值；\n\tgestureData.touchEle：手指触摸的源元素；\n\tgestureData.selectWords：选中的文字；\n\tgestureData.touchStart：触摸开始坐标对象；\n\tgestureData.touchEnd：触摸最新坐标对象；\n\tgestureData.path：滑动的路径；\n\tgestureData.videoPlayer：正在播放的视频元素。\n\n可用方法说明↓\n\tgestureData.addStyle(CSS样式)：将CSS样式添加到网页上；\n\tgestureData.runGesture()：以path为路径执行手势,你可以修改path后执行此方法；\n\tgestureData.GM_openInTab(链接)：打开链接；\n\tgestureData.GM_setClipboard(文本)：复制文本到剪切板；\n\tgestureData.GM_setValue(变量名,变量值)：在油猴中存储数据；\n\tgestureData.GM_getValue(变量名,默认值)：从油猴中取出数据,没有则使用默认值。\n\n可识别代码注释说明(仅对一般手势生效)↓\n\t默认情况：存在iframe时，所有手势只会在触发手势的页面对象执行！\n \t添加/*ONLY TOP*/：手势只在顶级页面对象执行；\n\t添加/*WITH TOP*/：手势同时在当前页面对象和顶级页面对象执行。"></textarea><div style="width:100%;height:0.3vmin;"></div><button id="_closeEdit_">关闭</button><button id="_saveGesture_">保存</button></div><div id="_settingsBox_"><h1>功能开关设置</h1><span id="_settingList_"></span><button id="_saveSettings_">保存</button></div>',o=document.getElementById("_path_"),c(),document.getElementById("_addGesture_").addEventListener("click",(()=>{e=t="",document.getElementById("_G_").click(),document.getElementById("_gestureName_").value="",document.getElementById("_gestureCode_").value="",document.getElementById("_editGesture_").style.display="block"}),!0),document.getElementById("_saveGesture_").addEventListener("click",(()=>{let a=document.getElementById("_gestureName_").value;if(!a)return void alert("请输入手势名称！");if(document.querySelector('#_gestureBox_ ._gestureLi_[name="'+a+'"]:not([path="'+t+'"])'))return void alert("存在同名手势！");let o=document.getElementsByName("_gestureType_");for(let i=0,r=o.length;i<r;++i)if(o[i].checked){let r=o[i].value+(e&&t.indexOf("[")<0?/^[TIV]/.test(t)?t.slice(1):t:"["+a+"]");if(r!==t){if(gestureData.gesture[r]){let e=o[i].value+"["+gestureData.gesture[r].name+"]";gestureData.gesture[e]=gestureData.gesture[r]}gestureData.gesture[r]=gestureData.gesture[t]||{},delete gestureData.gesture[t]}gestureData.gesture[r].name=a,gestureData.gesture[r].code=document.getElementById("_gestureCode_").value;break}gestureData.GM_setValue("gesture",gestureData.gesture),c(),document.getElementById("_editGesture_").style.display="none"}),!0),document.getElementById("_closeEdit_").addEventListener("click",(()=>{document.getElementById("_editGesture_").style.display="none"}),!0),document.getElementById("_revisePath_").addEventListener("touchstart",(()=>{fingersNum>1||(clearTimeout(gestureTimer),clearTimeout(i),gestureTimer=setTimeout(u,300+slideTime-pressTime))}),!0),document.getElementById("_revisePath_").addEventListener("touchmove",(e=>{if(e.preventDefault(),clearTimeout(gestureTimer),gestureData.touchEnd=e.changedTouches[0],/[○▼▽]$/.test(o.textContent)||fingersNum>1)return;let t=(gestureData.touchEnd.screenX-startPoint.screenX)**2,a=(gestureData.touchEnd.screenY-startPoint.screenY)**2,i=t>a?gestureData.touchEnd.screenX>startPoint.screenX?"→":"←":gestureData.touchEnd.screenY>startPoint.screenY?"↓":"↑",r=Date.now(),s=t+a,n=o.textContent.slice(-1);s>LIMIT/576&&(slideTime=r,isClick=0,n===i||s>LIMIT?(n!==i&&(o.textContent+=i,slideClock=r),startPoint=gestureData.touchEnd,slideClock&&r-slideClock>300&&(slideClock=0,o.textContent+="▼")):s>LIMIT/100&&(slideClock=0)),gestureTimer=setTimeout(u,300+slideTime-r)}),!0),document.getElementById("_revisePath_").addEventListener("touchend",(e=>{if(isClick&&!(fingersNum>0))if(gestureData.path.indexOf("◆◆")>-1)switch(gestureData.path="",o.textContent.slice(-1)){case"●":o.textContent=o.textContent.slice(0,-1)+"○";break;case"○":o.textContent=o.textContent.slice(0,-1)+"●";break;case"▼":o.textContent=o.textContent.slice(0,-1)+"▽";break;case"▽":o.textContent=o.textContent.slice(0,-1)+"▼";break;default:o.textContent+="◆",setTimeout(d,100)}else i=setTimeout(d,200)})),document.getElementById("_clearPath_").addEventListener("touchend",(e=>{e.stopPropagation(),!isClick||fingersNum>0||(gestureData.path.indexOf("◆◆")>-1?(gestureData.path="",o.textContent=""):o.textContent=o.textContent.slice(0,-1))})),document.getElementById("_cancleRevise_").addEventListener("touchend",(a=>{if(a.stopPropagation(),a.preventDefault(),isClick&&!(fingersNum>0)){if(o.textContent){if("视频全屏"===e&&"◆"!==o.textContent.slice(-1))return void alert("视频全屏需要以◆结尾！");if("手势穿透"===gestureData.gesture[o.textContent]?.name)return void alert('路径与"手势穿透"功能冲突！');if(/^[TIV]/.test(t)&&(o.textContent=t.slice(0,1)+o.textContent),gestureData.gesture[o.textContent]){let e=(/^[TIV]/.test(t)?t.slice(0,1):"")+"["+gestureData.gesture[o.textContent].name+"]";gestureData.gesture[e]=gestureData.gesture[o.textContent]}gestureData.gesture[o.textContent]=gestureData.gesture[t],delete gestureData.gesture[t],gestureData.GM_setValue("gesture",gestureData.gesture),c()}window.addEventListener("touchmove",touchMove,{capture:!0,passive:!0}),window.addEventListener("pointermove",touchMove,{capture:!0,passive:!0}),document.getElementById("_revisePath_").style.display="none"}})),document.getElementById("_openSettings_").addEventListener("click",(()=>{a.style.cssText="overflow-y:hidden !important",document.getElementById("_settingsBox_").style.display="block";let e=document.getElementById("_settingList_");e.textContent="";for(let t in gestureData.settings)if(e.innerHTML+="<p>"+t+"：</p>","boolean"==typeof gestureData.settings[t])e.innerHTML+='<label class="_switch_"><input type="checkbox" id="'+t+'" '+(gestureData.settings[t]?"checked":"")+'><div class="_slider_"></div></label>';else if("object"==typeof gestureData.settings[t]){e.innerHTML+='<div class="_slideRail_"><div class="_slideButton_" id="'+t+'"></div></div>';let a=document.getElementById(t),o=a.parentNode.offsetWidth*(gestureData.settings[t][0]-gestureData.settings[t][1])/(gestureData.settings[t][2]-gestureData.settings[t][1])-a.offsetWidth/2;a.style.left=o+"px",a.textContent=gestureData.settings[t][0].toFixed(gestureData.settings[t][3])}let t=document.getElementsByClassName("_slideButton_");for(let e=0,a=t.length;e<a;++e)t[e].addEventListener("touchmove",l,!0)}),!0),document.getElementById("_saveSettings_").addEventListener("click",(()=>{a.style.cssText="";for(let e in gestureData.settings)"boolean"==typeof gestureData.settings[e]?gestureData.settings[e]=document.getElementById(e).checked:"object"==typeof gestureData.settings[e]&&(gestureData.settings[e][0]=+document.getElementById(e).textContent);gestureData.GM_setValue("settings",gestureData.settings),document.getElementById("_settingsBox_").style.display="none"}),!0)},function(){if(top===self?(window.addEventListener("popstate",(()=>{clearTimeout(gestureData.backTimer),gestureData.backTimer=0}),!0),window.addEventListener("beforeunload",(()=>{clearTimeout(gestureData.backTimer),gestureData.backTimer=0}),!0),window.addEventListener("message",(async e=>{let t=e.data;switch(t.type){case"GYRO":await(screen.orientation.lock("landscape")?.catch(Date));break;case"forceFullScreen":for(let t=0,a=iframeEles.length;t<a;++t)if(iframeEles[t].contentWindow===e.source){iframeEles[t].allowFullscreen||(iframeEles[t].allowFullscreen=!0,iframeEles[t].getAttribute("src")&&iframeEles[t].src.indexOf("/")>-1&&(iframeEles[t].src=iframeEles[t].src));break}break;case"runPath":for(let a=0,o=iframeEles.length;a<o;++a)if(iframeEles[a].contentWindow===e.source){let e=iframeEles[a].getBoundingClientRect();gestureData.touchStart=t.gestureData.touchStart,gestureData.touchEnd=t.gestureData.touchEnd,gestureData.touchStart.target=gestureData.touchEnd.target=gestureData.touchEle=iframeEles[a],gestureData.touchStart.pageX=gestureData.touchStart.clientX+=e.x,gestureData.touchStart.pageY=gestureData.touchStart.clientY+=e.y,gestureData.touchEnd.pageX=gestureData.touchEnd.clientX+=e.x,gestureData.touchEnd.pageY=gestureData.touchEnd.clientY+=e.y;break}gestureData.path=t.runPath,setTimeout(gestureData.runGesture);break;case"pushTouch":{let e=gestureData.touchEle.getBoundingClientRect();gestureData.touchEnd=t.gestureData.touchEnd,gestureData.touchEnd.target=gestureData.touchEle,gestureData.touchEnd.pageX=gestureData.touchEnd.clientX+=e.x,gestureData.touchEnd.pageY=gestureData.touchEnd.clientY+=e.y;break}case"download":window._downloadVideo_(t)}}),!0)):(GM_addValueChangeListener("fullscreen",(async(e,t,a,o)=>{!document.hidden&&window._isShow_&&await(gestureData.findVideoBox()?.requestFullscreen()?.catch(Date))})),GM_addValueChangeListener("isShow",((e,t,a,o)=>{document.hidden||(window._isShow_=!o)}))),checkTimer=setTimeout(loadCheck,200),CHECK_M_OBSERVER.observe(document,{childList:!0,subtree:!0}),window.addEventListener("touchstart",touchStart,{capture:!0,passive:!1}),window.addEventListener("touchmove",touchMove,{capture:!0,passive:!0}),window.addEventListener("pointermove",touchMove,{capture:!0,passive:!0}),window.addEventListener("touchend",touchEnd,{capture:!0,passive:!1}),window.addEventListener("touchcancel",touchEnd,{capture:!0,passive:!1}),gestureData.settings["图片手势"]&&window.addEventListener("contextmenu",(e=>{(gestureData.path.indexOf("I")>-1||"IMG"===e.target.nodeName)&&gestureData.touchEle.src!==location.href&&e.preventDefault()}),!0),gestureData.settings["避免断触"]&&window.addEventListener("click",delayClick,!0),window.addEventListener("visibilitychange",(e=>{if(e.stopImmediatePropagation(),document.hidden){let e=gestureData.videoPlayer?.paused,t=gestureData.videoPlayer?.currentTime+.2,a=gestureData.videoPlayer?.playbackRate,o=gestureData.videoPlayer?.volume;setTimeout((()=>{e!==gestureData.videoPlayer?.paused&&(gestureData.videoPlayer.load(),gestureData.videoPlayer.currentTime=t,gestureData.videoPlayer.onloadstart=()=>{gestureData.videoPlayer.play(),gestureData.videoPlayer.playbackRate=a,gestureData.videoPlayer.volume=o})}))}else if(gestureData.settings["网页加速"]){let e=[...document.querySelectorAll('a[_linkShow_="1"]')],t=Date.now();if(gestureData.shadowList)for(let t=0,a=gestureData.shadowList.length;t<a;++t)e.push(...gestureData.shadowList[t].querySelectorAll('a[_linkShow_="1"]'));for(let a=0,o=e.length;a<o;++a)t-e[a]._prefetch_>3e5&&(e[a]._prefetch_=Date.now(),document.head.insertAdjacentHTML("beforeend",'<link rel="prefetch" href="'+e[a].href.replace(/^https?:/,"")+'"/>'))}}),!0),window.addEventListener("pagehide",(e=>{e.stopImmediatePropagation()}),!0),window.addEventListener("blur",(e=>{e.stopImmediatePropagation()})),window.addEventListener("copy",(e=>{gestureData.selectWords||(e.stopImmediatePropagation(),e.stopPropagation())}),!0),document.execCommand=()=>{},navigator.clipboard&&(navigator.clipboard.writeText=()=>{},navigator.clipboard.write=()=>{}),gestureData.addStyle("html,html *{user-select:auto !important;touch-action:manipulation;overscroll-behavior-x:none !important;}"),window.addEventListener("selectstart",(e=>{e.stopImmediatePropagation()}),!0),gestureData.settings["网页加速"]&&HTMLScriptElement.supports&&HTMLScriptElement.supports("speculationrules")){let e=document.createElement("script"),t={prerender:[{source:"document",where:{and:[{selector_matches:'a[_linkShow_="1"]'}]},referrer_policy:"strict-origin-when-cross-origin",eagerness:"immediate"}],prefetch:[{source:"document",where:{and:[{selector_matches:'a[_linkShow_="1"]'}]},referrer_policy:"strict-origin-when-cross-origin",eagerness:"immediate"}],prefetch_with_subresources:[{source:"document",where:{and:[{selector_matches:'a[_linkShow_="1"]'}]},referrer_policy:"strict-origin-when-cross-origin",eagerness:"immediate"}]};e.type="speculationrules",e.textContent=JSON.stringify(t),document.head?.insertAdjacentElement("beforeend",e)}}();