// ==UserScript==
// @name         4chan Image Resizer
// @namespace    https://greasyfork.org/en/users/393416
// @version      2.4
// @description  Automatically downscale images based on custom presets, image cropping and more. Requires 4chan X.
// @author       greenronia
// @match        *://boards.4chan.org/*
// @match        *://boards.4channel.org/*
// @require      https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.0/spark-md5.js
// @require      https://unpkg.com/@daiyam/cropperjs@1.5.9-d2/dist/@daiyam/cropper.js
// @resource     cropper_css https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.9/cropper.css
// @grant        GM_getResourceText
// @grant        GM_addStyle
// @icon         https://i.imgur.com/hQp5BTf.png
// @downloadURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/4chan20Image20Resizer.user.js
// @updateURL https://raw.githubusercontent.com/s0uboxxx/Userscripts-GCC/release/release/4chan20Image20Resizer.meta.js
// ==/UserScript==
var DEBUG=!1;const version="2.4";DEBUG&&console.log("[ImageResizer] Initialized");var cssTxt=GM_getResourceText("cropper_css");GM_addStyle(cssTxt);var style=document.createElement("style");style.innerHTML=".centerImg { margin: 0; position: absolute; top: 50%; left: 50%; -ms-transform: translate(-50%, -50%); transform: translate(-50%, -50%); max-width: 100%; max-height: 100vh; height: auto; cursor: pointer; }\n.settingsOverlay { background: rgba(0,0,0,0.8); display: none; height: 100%; left: 0; position: fixed; top: 0; width: 100%; z-index: 777; } \n#pvOverlay { background: rgba(0,0,0,0.9); height: 100%; left: 0; position: fixed; top: 0; width: 100%; z-index: 777; text-align: center;} \n#pvHeader { position: fixed; height: 35px; width: 100%; opacity: 0; -webkit-transition: opacity 0.5s ease-in-out;}\n#pvHeader:hover { opacity: 0.8; -webkit-transition: none; }\n.pvOpct { opacity: 0.7 !important; } \n#imgResizeMenu { margin: 10% auto auto auto; width: 100%; width: 620px; padding: 2em; overflow: hidden; z-index: 8;}\n#imgResizeMenu h3 { text-align: center; }\n#imgResizeMenu a { cursor: pointer; }\n#imgResizeMenu label { text-decoration-line: underline; }\n#heplDiv summary { cursor: pointer; }\n.settingsOverlay input[type=number], #manInput input[type=number] { -moz-appearance: textfield; text-align: right; }\n.resizer-settings { padding-bottom: 10px }\n#errMsg { color: red; text-align: center; }\n#ruleTable { border-collapse: collapse; }\n#ruleTable td, th { padding: 8px; text-align: left; border-bottom: 1pt solid; }\n#QCTable { border-collapse: collapse; }\n#QCTable td, th { padding: 8px; text-align: center; border-bottom: 1pt solid; }\n#QCTable p { margin: auto; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n#inputContainer { text-align: center; padding-top: 1em; }\n#inputContainer button { margin-top: 20px; }\n.menuBtns { margin-left: 1em; }\n#sideMenu { position: absolute; display: none; padding: 5px 0px 5px 0px; width: 101px; margin-left: -106px; margin-top: -2px;}\n#manInput { position: absolute; padding: 10px 0px 10px 0px; width: 170px; margin-left: -175px; margin-top: -2px; text-align: center;}\n.sideMenuElement { background: inherit; display: block; cursor: pointer; padding: 2px 10px 2px 10px; text-align: left;}\n.downscale-menu-off { display: none; }\n.downscale-menu-on { display: block !important; }";var styleRef=document.querySelector("script");function getSettings(){if(JSON.parse(localStorage.getItem("downscale-settings")))var e=JSON.parse(localStorage.getItem("downscale-settings"));else e={enabled:!0,notify:!0,convert:!1,jpegQuality:.92,shortcut:!0,cropOutput:"image/jpeg",version:"2.4"},localStorage.setItem("downscale-settings",JSON.stringify(e));return e}function getPresets(){if(JSON.parse(localStorage.getItem("downscale-presets")))var e=JSON.parse(localStorage.getItem("downscale-presets"));else e=[];return e}function getQCList(){if(JSON.parse(localStorage.getItem("downscale-qclist")))var e=JSON.parse(localStorage.getItem("downscale-qclist"));else e=[];return e}function appendCheckBox(){var e=document.createElement("a"),t=document.createElement("label"),n=document.createElement("input");n.type="checkbox",n.id="imgResize",t.id="imgResizeLabel",n.title="Enable Image Resizer",n.style="margin-left: 0",e.classList.add("sideMenuElement"),e.classList.add("entry"),t.classList.add("sideMenuElement"),t.classList.add("entry");var i=document.getElementById("sideMenu");i.appendChild(t),t.appendChild(n),t.title="Enable Image Resizer",t.innerHTML+=" Enabled",e.title="Image Resizer Settings",e.innerHTML="Settings",i.appendChild(e),t.onmouseover=function(){this.classList.toggle("focused")},t.onmouseout=function(){this.classList.toggle("focused")},e.onmouseover=function(){this.classList.toggle("focused")},e.onmouseout=function(){this.classList.toggle("focused")},e.onclick=function(){document.getElementById("imgResizeOverlay").style.display="block"},document.getElementById("imgResize").checked=getSettings().enabled}function checkState(e){return!0===document.getElementById("imgResize").checked?(2!=e&&DEBUG&&console.log("[ImageResizer] Enabled"),!0):(2!=e&&DEBUG&&console.log("[ImageResizer] Disabled"),removeHR(),removeCropOption(),removeQCOption(),removeRemOption(),removePreviewOption(),removeManual(),!1)}function clearErr(){document.getElementById("errMsg").innerHTML=""}function basicCheck(e,t){var n=parseInt(document.getElementById("inWidth").value),i=parseInt(document.getElementById("inHeight").value),o=parseInt(document.getElementById("outWidth").value),a=parseInt(document.getElementById("outHeight").value),s=parseInt(document.getElementById("imgType").value);o<=0||a<=0?document.getElementById("errMsg").innerHTML="Invalid output dimensions":n<o||i<a?document.getElementById("errMsg").innerHTML="Cannot upscale images":finalCheck(e,s,n,i,o,a,t)}function finalCheck(e,t,n,i,o,a,s){var r=document.getElementById("imgType"),l=r.options[r.selectedIndex].text,d=t+":"+n+":"+i+":"+o+":"+a,c=getPresets();if(c.length>0)for(var m=[],u=c.length,p=0;p<u;p++)if(!e||p!==s){if(m[p]=c[p].split(":"),d==c[p])return void(document.getElementById("errMsg").innerHTML="Exact preset already exists");if(n==m[p][1]&&i==m[p][2]&&(t==m[p][0]||0==m[p][0]))return void(document.getElementById("errMsg").innerHTML="Preset with the same input dimensions for "+l+" format already exists")}clearErr(),e?c[s]=d:c.push(d),localStorage.setItem("downscale-presets",JSON.stringify(c)),document.getElementById("ruleTable").tBodies.item(0).innerHTML="",printList(),document.getElementById("ruleInput").remove(),document.getElementById("addRule").style.display="inline"}function aspectCheckH(){var e=document.getElementById("inWidth").value,t=document.getElementById("inHeight").value,n=(document.getElementById("outWidth").value,document.getElementById("outHeight").value);n>0&&(parseInt(t)>=parseInt(n)?(calcAspect("width",e,t,n),clearErr()):document.getElementById("errMsg").innerHTML="Cannot upscale images")}function aspectCheckW(){var e=document.getElementById("inWidth").value,t=document.getElementById("inHeight").value,n=document.getElementById("outWidth").value;document.getElementById("outHeight").value;n>0&&(parseInt(e)>=parseInt(n)?(calcAspect("height",e,t,n),clearErr()):document.getElementById("errMsg").innerHTML="Cannot upscale images")}function calcAspect(e,t,n,i){if("width"==e){var o=i/n*t;document.getElementById("outWidth").value=Math.round(o)}if("height"==e){var a=i/t*n;document.getElementById("outHeight").value=Math.round(a)}}function calcResAspect(e,t,n,i){if("width"==e){var o=n/t*i;document.getElementById("resHeight").value=Math.round(o)}if("height"==e){var a=t/n*i;document.getElementById("resWidth").value=Math.round(a)}}function printList(){var e=getPresets(),t=(document.getElementById("imgResizeList"),document.getElementById("ruleTable"));if(e.length>0){var n=[],i=e.length;for(let a=0;a<i;a++){switch(n[a]=e[a].split(":"),parseInt(n[a][0])){case 0:n[a][0]="PNG/JPEG";break;case 1:n[a][0]="PNG";break;case 2:n[a][0]="JPEG"}let i=document.createElement("a"),s=document.createElement("a");i.innerHTML="delete",s.innerHTML="edit",i.onclick=function(){document.getElementById("inputContainer")&&(document.getElementById("inputContainer").innerHTML=""),e.splice(i.parentElement.parentElement.sectionRowIndex,1),localStorage.setItem("downscale-presets",JSON.stringify(e)),t.tBodies.item(0).innerHTML="",printList(),clearErr(),document.getElementById("addRule").style.display="inline"},s.onclick=function(){inputUI(!0,n[a],a),clearErr()};var o=t.tBodies.item(0).insertRow(-1);o.insertCell(0).innerHTML=n[a][0],o.insertCell(1).innerHTML="[ "+n[a][1]+" x "+n[a][2]+" ]",o.insertCell(2).innerHTML="&#8594;",o.insertCell(3).innerHTML="[ "+n[a][3]+" x "+n[a][4]+" ]",o.insertCell(4).appendChild(s),o.insertCell(5).appendChild(i)}}}function inputUI(e,t,n){document.getElementById("inputContainer")&&(document.getElementById("inputContainer").innerHTML=""),document.getElementById("addRule").style.display="none";var i=document.getElementById("inputContainer"),o=document.createElement("div"),a=document.createElement("button");a.innerHTML="Cancel",a.style.margin="auto 0 0 10px";var s=document.createElement("button");s.innerHTML="Save",o.id="ruleInput",o.innerHTML='<select id="imgType" name="imgType" title="Input Format"><option value="0">PNG/JPEG</option><option value="1">PNG</option><option value="2">JPEG</option></select>&ensp;<input type="number" id="inWidth" title="Input Width" size="2" min="0" value="0" onfocus="this.select();"></input> x <input type="number" id="inHeight" title="Input Height" size="2" min="0" value="0" onfocus="this.select();"></input> &ensp; &#8594; &ensp; <input type="number" id="outWidth" title="Output Width" size="2" min="0" value="0" onfocus="this.select();"></input> x <input type="number" id="outHeight" title="Output Height" size="2" min="0" value="0" onfocus="this.select();"></input><br>',i.appendChild(o);var r=document.getElementById("inWidth"),l=document.getElementById("inHeight"),d=document.getElementById("outWidth"),c=document.getElementById("outHeight");if(e){switch(t[0]){case"PNG/JPEG":document.getElementById("imgType").selectedIndex=0;break;case"PNG":document.getElementById("imgType").selectedIndex=1;break;case"JPEG":document.getElementById("imgType").selectedIndex=2}r.value=t[1],l.value=t[2],d.value=t[3],c.value=t[4]}d.addEventListener("input",aspectCheckW),c.addEventListener("input",aspectCheckH),r.onkeypress=function(){return c.value=0,d.value=0,isNumber(event)},l.onkeypress=function(){return c.value=0,d.value=0,isNumber(event)},d.onkeypress=function(){return isNumber(event)},c.onkeypress=function(){return isNumber(event)},o.appendChild(s),o.appendChild(a),a.onclick=function(){document.getElementById(o.id).remove(),document.getElementById("addRule").style.display="inline",clearErr()},s.onclick=function(){e?basicCheck(!0,n):basicCheck(!1)}}function printQCList(){var e=getQCList(),t=(document.getElementById("QCList"),document.getElementById("QCTable")),n=e.length;if(n>0){var i=[];for(let a=0;a<n;a++){i[a]=e[a].split(":");let n=document.createElement("a");n.innerHTML="delete",n.onclick=function(){e.splice(n.parentElement.parentElement.sectionRowIndex,1),localStorage.setItem("downscale-qclist",JSON.stringify(e)),t.tBodies.item(0).innerHTML="",printQCList()};var o=t.tBodies.item(0).insertRow(-1);o.insertCell(0).innerHTML=i[a][0],o.insertCell(1).innerHTML="[ "+i[a][1]+" x "+i[a][2]+" ]",o.insertCell(2).innerHTML=i[a][3],o.insertCell(3).innerHTML="&#8594;",o.insertCell(4).innerHTML=i[a][4],o.insertCell(5).innerHTML='<p title = "'+i[a][5]+'">'+i[a][5]+"</p>",o.insertCell(6).appendChild(n)}}}function appendSettings(){var e=document.createElement("span"),t=document.createElement("a");t.id="imgResizeSettings",t.className+="fa fa-cog",t.style="cursor: pointer;",t.title="Image Resizer Settings",document.getElementById("shortcut-settings").insertBefore(e,parent.nextSibling),e.appendChild(t);var n=document.createElement("div");n.id="imgResizeOverlay",n.classList.add("settingsOverlay"),document.body.appendChild(n);var i=document.createElement("div");i.id="imgResizeMenu",i.classList.add("dialog"),n.appendChild(i);var o=document.createElement("a");o.className+="close fa fa-times",o.style="float: right;",o.title="Close",i.insertAdjacentElement("afterbegin",o);var a=document.createElement("a");a.innerHTML+="Settings",a.classList.add("menuBtns"),a.style="font-weight: bold;",a.onclick=function(){u.className="downscale-menu-on",p.className="downscale-menu-off",g.className="downscale-menu-off",h.className="downscale-menu-off",a.style="font-weight: bold;",s.style="",r.style="",l.style=""},i.appendChild(a);var s=document.createElement("a");s.innerHTML+="Presets",s.classList.add("menuBtns"),s.onclick=function(){u.className="downscale-menu-off",p.className="downscale-menu-on",g.className="downscale-menu-off",h.className="downscale-menu-off",a.style="",s.style="font-weight: bold;",r.style="",l.style=""},i.appendChild(s);var r=document.createElement("a");r.innerHTML+="Quick Convert",r.classList.add("menuBtns"),r.onclick=function(){u.className="downscale-menu-off",p.className="downscale-menu-off",g.className="downscale-menu-on",h.className="downscale-menu-off",a.style="",s.style="",r.style="font-weight: bold;",l.style=""},i.appendChild(r);var l=document.createElement("a");l.innerHTML+="About",l.classList.add("menuBtns"),l.onclick=function(){u.className="downscale-menu-off",p.className="downscale-menu-off",g.className="downscale-menu-off",h.className="downscale-menu-on",a.style="",s.style="",r.style="",l.style="font-weight: bold;"},i.appendChild(l);var d=document.createElement("hr");d.style.borderColor=getHRColor(),i.appendChild(d);var c=document.createElement("div");c.id="imgResizeContent",i.appendChild(c),c.innerHTML="";var m=document.createElement("p");m.id="errMsg";var u=document.createElement("div");u.id="settingsDiv",u.classList.add("downscale-menu-on"),c.appendChild(u);var p=document.createElement("div");p.id="presetsDiv",p.classList.add("downscale-menu-off"),p.style.textAlign="center",c.appendChild(p);var g=document.createElement("div");g.id="QCListDiv",g.classList.add("downscale-menu-off"),c.appendChild(g);var h=document.createElement("div");h.id="heplDiv",h.classList.add("downscale-menu-off"),c.appendChild(h);var v=document.createElement("h3");v.innerHTML="Image Resizer Settings",u.appendChild(v);var y=document.createElement("div");y.classList.add("resizer-settings"),y.innerHTML='<input type="checkbox" id="enableSet" title="" size="1"></input><label for="enableSet">Enable Resizer</label>:&ensp;Enable 4chan Image Resizer by default.',u.appendChild(y);var f=document.getElementById("enableSet");f.checked=getSettings().enabled,f.oninput=function(){f.checked||(removeCropOption(),removeQCOption(),removeRemOption(),removePreviewOption());var e=getSettings();e.enabled=f.checked,document.getElementById("imgResize").checked=f.checked,localStorage.setItem("downscale-settings",JSON.stringify(e))};var E=document.createElement("div");E.classList.add("resizer-settings"),E.innerHTML='<input type="checkbox" id="shortcutSet" title="" size="1"></input><label for="shortcutSet">Enable Shortcut</label>:&ensp;Enable "Quick Convert" shortcut. <kbd>Ctrl</kbd> + <kbd>Q</kbd>',u.appendChild(E);var b=document.getElementById("shortcutSet");b.checked=getSettings().shortcut,b.oninput=function(){var e=getSettings();e.shortcut=b.checked,localStorage.setItem("downscale-settings",JSON.stringify(e))};var C=document.createElement("div");C.classList.add("resizer-settings"),C.innerHTML='<input type="checkbox" id="displaySet" title="" size="1"></input><label for="displaySet">Display Notifications</label>:&ensp;Display a notification when an image is downscaled.',u.appendChild(C);var I=document.getElementById("displaySet");I.checked=getSettings().notify,I.oninput=function(){var e=getSettings();e.notify=I.checked,localStorage.setItem("downscale-settings",JSON.stringify(e))};var B=document.createElement("div");B.classList.add("resizer-settings"),B.innerHTML='<input type="checkbox" id="convertSet" title="" size="1"></input><label for="convertSet">Convert All PNGs</label>:&ensp;Automatically convert all added PNGs to JPEGs. Presets apply as normal.',u.appendChild(B);var w=document.getElementById("convertSet");w.checked=getSettings().convert,w.oninput=function(){var e=getSettings();e.convert=w.checked,localStorage.setItem("downscale-settings",JSON.stringify(e))};var L=document.createElement("div");L.classList.add("resizer-settings"),L.innerHTML='<input type="text" id="imgQuality" title="JPEG Quality" size="1"></input><label for="imgQuality">JPEG Quality</label>:&ensp;A number between 0 and 1 indicating the output image quality.',u.appendChild(L);var k=document.getElementById("imgQuality");k.value=getSettings().jpegQuality,k.onkeypress=function(){return isDecimalNumber(event)},k.oninput=function(){var e=document.getElementById("imgQuality");if(new RegExp(/^(0(\.\d{1,2})?|1(\.0+)?)$/).test(document.getElementById("imgQuality").value)){e.setCustomValidity("");var t=getSettings();t.jpegQuality=e.value,localStorage.setItem("downscale-settings",JSON.stringify(t))}else e.setCustomValidity("Set the value between 1 and 0 up to 2 numbers after the decimal point.")};var M=document.createElement("div");M.classList.add("resizer-settings"),M.innerHTML='<select id="cropOut" name="cropOut"><option value="image/png">PNG</option><option value="image/jpeg">JPEG</option></select>&ensp;<label for="cropOut">Crop Output</label>:&ensp;Set the desired output format for cropped images.',u.appendChild(M);var S=document.getElementById("cropOut");S.value=getSettings().cropOutput,S.oninput=function(){var e=getSettings();e.cropOutput=S.value,localStorage.setItem("downscale-settings",JSON.stringify(e))};var T=document.createElement("div");T.style.overflowY="auto",T.style.maxHeight="220px";var H=document.createElement("table"),x=document.createElement("thead"),R=document.createElement("tbody"),z=document.createElement("h3");z.innerHTML="Presets",p.appendChild(z),H.appendChild(x),H.appendChild(R),H.id="ruleTable";var D=x.insertRow(0);D.insertCell(0).outerHTML="<th>Format</th>",D.insertCell(1).outerHTML="<th>Input</th>",D.insertCell(2).outerHTML="<th></th>",D.insertCell(3).outerHTML="<th>Output</th>",D.insertCell(4).outerHTML="<th></th>",D.insertCell(5).outerHTML="<th></th>",p.appendChild(T),T.appendChild(H);var O=document.createElement("div");O.id="inputContainer",p.appendChild(O);var N=document.createElement("button");N.id="addRule",N.innerHTML="New Preset",printList(),p.appendChild(N),p.appendChild(m),t.onclick=function(){n.style.display="block"},o.onclick=function(){n.style.display="none"},window.addEventListener("click",(function(e){e.target==n&&(n.style.display="none")})),N.onclick=function(){inputUI(!1)};var G=document.createElement("div");G.style="float: left;";var P=document.createElement("span");P.innerHTML=" | ";var U=document.createElement("a"),Q=document.createElement("a");U.innerHTML="Import",Q.innerHTML="Export",U.classList.add("menuBtns"),G.innerHTML+='<input id="importPresetsFile-input" type="file" accept=".json" style="display: none;" />',U.onclick=function(){document.getElementById("importPresetsFile-input").click()},Q.onclick=function(){downloadObjectAsJson(getPresets(),"4chan Image Resizer v2.4 Presets List - "+Date.now())},G.appendChild(U),G.appendChild(P),G.appendChild(Q),p.appendChild(G),document.getElementById("importPresetsFile-input").addEventListener("change",(function(){var e=new FileReader;e.onload=function(){var t=getPresets(),n=0,i=0,o=JSON.parse(e.result);if(Array.isArray(o)){for(let e=0;e<o.length;e++){var a=o[e].split(":");if(5!=a.length)return DEBUG&&console.log("[Error] Imported array does not match the required length (5)"),DEBUG&&console.log(a),void alert("Error: Array length mismatch.\nThis file is either outdated or invalid.");for(let e=0;e<t.length;e++){if(a[0]+":"+a[1]+":"+a[2]+":"+a[3]+":"+a[4]==t[e]){i++;break}}0==i?t.push(o[e]):(n+=i,i=0)}localStorage.setItem("downscale-presets",JSON.stringify(t)),document.getElementById("ruleTable").tBodies.item(0).innerHTML="",printList();var s=o.length-n;alert("Succesfully imported "+o.length+" entries.\nDuplicate entries skipped: "+n+"\nNew entries added: "+s)}else alert("Error: Invalid data type."),DEBUG&&console.log("[Error] Imported data object is not an array.")},e.readAsText(this.files[0])}));var A=document.createElement("div");A.style.overflowY="auto",A.style.maxHeight="220px";var F=document.createElement("table"),J=document.createElement("thead"),j=document.createElement("tbody"),q=document.createElement("h3");q.innerHTML="Quick Convert List",g.appendChild(q),g.innerHTML+="<p style='text-align: center;'>Images on this list will be automatically converted to JPEG with a quality setting of 92.</p>",F.appendChild(J),F.appendChild(j),F.id="QCTable";var W=J.insertRow(0);W.insertCell(0).outerHTML="<th>Format</th>",W.insertCell(1).outerHTML="<th>Dimensions</th>",W.insertCell(2).outerHTML="<th>Original Size</th>",W.insertCell(3).outerHTML="<th></th>",W.insertCell(4).outerHTML="<th>New Size</th>",W.insertCell(5).outerHTML="<th>Filename</th>",W.insertCell(6).outerHTML="<th></th>",g.appendChild(A),A.appendChild(F);var _=document.createElement("div");_.style="padding-top: 1em;";var K=document.createElement("span");K.innerHTML=" | ";var Y=document.createElement("a"),V=document.createElement("a");Y.innerHTML="Import",V.innerHTML="Export",Y.classList.add("menuBtns"),_.innerHTML+='<input id="importQCLFile-input" type="file" accept=".json" style="display: none;" />',Y.onclick=function(){document.getElementById("importQCLFile-input").click()},V.onclick=function(){downloadObjectAsJson(getQCList(),"4chan Image Resizer v2.4 Quick Convert List - "+Date.now())},_.appendChild(Y),_.appendChild(K),_.appendChild(V),g.appendChild(_),document.getElementById("importQCLFile-input").addEventListener("change",(function(){var e=new FileReader;e.onload=function(){var t=getQCList(),n=0,i=0,o=JSON.parse(e.result);if(Array.isArray(o)){for(let e=0;e<o.length;e++){var a=o[e].split(":");if(7!=a.length||32!=a[6].length)return DEBUG&&console.log("[Error] Imported array does not match the required length (7) or contains an invalid MD5 hash."),DEBUG&&console.log(a),void alert("Error: Array length mismatch.\nThis file is either outdated or invalid.");for(let e=0;e<t.length;e++){var s=t[e].split(":");if(a[6]==s[6]){i++;break}}0==i?t.push(o[e]):(n+=i,i=0)}localStorage.setItem("downscale-qclist",JSON.stringify(t)),document.getElementById("QCTable").tBodies.item(0).innerHTML="",printQCList();var r=o.length-n;alert("Succesfully imported "+o.length+" entries.\nDuplicate entries skipped: "+n+"\nNew entries added: "+r)}else alert("Error: Invalid data type."),DEBUG&&console.log("[Error] Imported data object is not an array.")},e.readAsText(this.files[0])}));var Z=document.createElement("a"),$=[];Z.innerHTML="Delete All",Z.style="float: right; margin-right: 1em;",Z.onclick=function(){confirm('                                                      WARNING!\nAre you sure you want to DELETE ALL entries from the "Quick Convert List"?')&&(localStorage.setItem("downscale-qclist",JSON.stringify($)),document.getElementById("QCTable").tBodies.item(0).innerHTML="")},_.appendChild(Z),printQCList();var X=document.createElement("h3");X.innerHTML="About",h.appendChild(X);var ee=document.createElement("div");ee.innerHTML='<strong>4chan Image <span style="text-decoration-line: line-through;">Resizer</span></strong> <s>Downscaler</s> automatically downscales images based on custom presets. Originally developed to downscale anime/vidya screenshots "on the fly". Now supports image cropping!<br><br><details><summary><strong>Presets</strong></summary><br>To automate image resizing, you have to create a preset by choosing an input image format and entering input and output dimensions (pixels). Then just add an image to a quick reply form. If it meets any of the created input requirements, the image will be automatically downscaled to your specified dimensions as a <strong>JPEG</strong>. <br><br><strong>Note</strong> that output dimensions are constrained by input dimensions <strong>aspect ratio</strong>. <br><strong>Also note</strong> that <strong>setting JPEG output quality to 1</strong> may result in filesizes larger than that of the original image, and should be considered as a placebo.</details><br><details><summary><strong>Quick Convert</strong></summary><br>Allows you to quickly convert images (PNG/JPEG) to JPEG.<br>This is very useful when an image exceeds 4chan image size limit of <strong>4 MB</strong>.<br><br>It works well on super high resolution images (+3000px), sometimes drastically cutting the filesize without any noticeble quality loss. However, <strong>it is not recommended to use it on grayscale PNG images</strong>, i.e. manga pages, because most of the time <strong>it will result in larger than original filesizes</strong>.<br>Once you are satisfied with the <strong>"Quick Convert"</strong> results, you can click <strong>"Remember"</strong> on the side menu to add the image MD5 hash to the <strong>"Quick Convert List"</strong>, which will always automatically convert the image for you in the future.<br><br>You can also use <kbd>Ctrl</kbd> + <kbd>Q</kbd> keyboard shortcut to perform <strong>"Quick Convert"</strong> faster. Press again to <strong>"Remember"</strong> the image.</details><br><details><summary><strong>Import/Export</strong></summary><br>Allows you to seperatly backup both, "Presets" and "Quick Convert" lists as .json files.<br><strong>Import</strong> works by merging list entries instead of overwriting them, so you can export/import items between domains without any worry.</details><br><details><summary><strong>Image Cropping</strong></summary><br>A basic image cropping tool that uses <a href="https://github.com/daiyam/cropperjs/tree/daiyam" target="_blank">Daiyam/Cropper.js</a> library. You can change cropped image output format in the settings tab.<br><strong>PNG</strong> is lossless and preserves transperancy, but results in larger filesizes.<br><strong>JPEG</strong> is lossy, but results in smaller filesizes (the <strong>"JPEG Quality"</strong> setting also applies here).</details><br><details><summary><strong>Cropper Controls</strong></summary><br>While cropping:<ul><li>Double click <kbd>LMB</kbd> - switch between cropping and zooming.</li><li>Hold <kbd>Shift</kbd> while cropping - draw a fixed rectangle.</li><li><kbd>MWheel</kbd> - zoom in/out.</li><li><kbd>Backspace</kbd> - clear selection.</li><li><kbd>Enter</kbd> - confirm selection.</li><li><kbd>Esc</kbd> or <kbd>Delete</kbd> - close cropper.</li></ul>After selection:<br><ul><li><kbd>Enter</kbd> or <kbd>LMB</kbd> - set image to QR form.</li><li><kbd>Backspace</kbd> or <kbd>RMB</kbd> - undo selection.</li><li><kbd>MMB</kbd> - close cropper.</li><li><kbd>Shift</kbd> + <kbd>RMB</kbd> - open context menu.</li></ul></details><br><span style="font-weight:bold; color: red;">*NEW*</span><ul><li>Added manual image resizing option to the side menu. Click "Test" to preview new image size.</li><br><br><div style="float: right;" >[ <a href="https://greasyfork.org/en/scripts/391758-4chan-image-resizer" target="_blank">version 2.4</a> ]</div>',h.appendChild(ee)}function appendSideMenu(){var e=document.createElement("a");e.id="sideMenuArrow",e.title="Side Menu",e.style.cursor="pointer",e.innerHTML="&#9664;",document.getElementById("autohide").parentNode.insertAdjacentElement("beforebegin",e),e.onclick=function(){t.classList.toggle("downscale-menu-on")};var t=document.createElement("div");t.id="sideMenu",t.classList.add("dialog"),document.getElementById("qr").insertAdjacentElement("afterbegin",t),window.addEventListener("click",(function(e){var t=document.getElementById("sideMenu");e.target.matches("#sideMenuArrow")||e.target.matches("#sideMenu")||e.target.matches("#imgResize")||e.target.matches("#quickConvert")||e.target.matches("#imgResizeLabel")||t.classList.contains("downscale-menu-on")&&t.classList.remove("downscale-menu-on")}))}function saveImgMD5(e,t,n,i){removeRemOption();var o=getQCList(),a=t.type.split("/").pop().toUpperCase(),s=t.name.split(".").slice(0,-1).join(".");s=s.replace(/:/g,"_");var r=formatBytes(t.size),l=formatBytes(i),d=a+":"+e.width+":"+e.height+":"+r+":"+l+":"+s+":"+n;o.push(d),localStorage.setItem("downscale-qclist",JSON.stringify(o));var c=t.name+'\nAdded to the "Quick Convert List"',m=new CustomEvent("CreateNotification",{bubbles:!0,detail:{type:"info",content:c,lifetime:5}});document.dispatchEvent(m),document.getElementById("QCTable").tBodies.item(0).innerHTML="",printQCList()}function removeQCOption(){var e=document.getElementById("qcDiv");e&&e.remove()}function removeRemOption(){var e=document.getElementById("remDiv");e&&e.remove()}function removeCropOption(){var e=document.getElementById("cropDiv");e&&e.remove()}function removePreviewOption(){var e=document.getElementById("previewImg");e&&e.remove()}function removeHR(){var e=document.getElementById("sm-hr");e&&e.remove()}function removeManual(){var e=document.getElementById("manDiv");e&&e.remove()}function getHRColor(){var e=document.getElementById("imgResizeMenu");return window.getComputedStyle(e,null).getPropertyValue("border-bottom-color")}function appendHR(){var e=document.createElement("hr");e.id="sm-hr",e.style.borderColor=getHRColor(),document.getElementById("sideMenu").appendChild(e)}function showImage(e,t,n,i,o){var a=document.createElement("div");a.id="pvOverlay";var s=document.createElement("div");s.id="pvHeader",s.className="dialog",s.classList.add("pvOpct"),s.innerHTML=o+"<br>("+formatBytes(t)+", "+Math.round(n)+"x"+Math.round(i)+")";var r=document.createElement("a");r.className="close fa fa-times",r.style="float: right; cursor: pointer; margin-right: 20px; margin-top: -9px; transform: scale(1.5);",r.title="Close",r.onclick=function(){a.remove()};var l=document.createElement("img");l.id="pvImg",l.classList.add("centerImg"),l.title="Click to close",l.src=e,l.onclick=function(){a.remove()},document.body.appendChild(a),a.appendChild(l),a.appendChild(s),s.appendChild(r),setTimeout((function(){s.classList.toggle("pvOpct")}),2e3)}function dataURItoBlob(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var n=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(t.length),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return new Blob([i],{type:n})}function downloadObjectAsJson(e,t){var n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",t+".json"),document.body.appendChild(i),i.click(),i.remove()}styleRef.parentNode.insertBefore(style,styleRef),getSettings(),getPresets(),getQCList(),function(){if(null==getSettings().version){var e=getSettings();e.version="2.4",localStorage.setItem("downscale-settings",JSON.stringify(e));var t=new CustomEvent("CreateNotification",{bubbles:!0,detail:{type:"info",content:"4chan Image Resizer updated to version 2.4",lifetime:10}});document.dispatchEvent(t)}}(),document.addEventListener("QRDialogCreation",(function(e){var t=document.getElementById("imgResize");document.getElementById("sideMenuArrow")||appendSideMenu(),t||appendCheckBox(),document.getElementById("imgResize").addEventListener("click",checkState),checkState(1),DEBUG&&console.log("[QRFile] Listening..."),document.addEventListener("QRFile",(function(e){DEBUG&&console.log("[QRFile] File served: "+e.detail),removeRemOption();const t=e.detail,a=new FileReader;if("image/jpeg"==t.type||"image/png"==t.type){DEBUG&&console.log("Acceptable File type: "+t.type),document.getElementById("sm-hr")||appendHR();var s=!1,r=getPresets(),l=getQCList();function d(e,n,i,a){DEBUG&&!a&&console.log("<FILTER END>"),removePreviewOption();var s,r=document.createElement("canvas"),l=i.width,d=i.height;l>d?l>e&&(d*=e/l,l=e):d>n&&(l*=n/d,d=n),r.width=l,r.height=d,r.getContext("2d").drawImage(i,0,0,l,d);var m=dataURItoBlob(s=a?r.toDataURL("image/jpeg",92):r.toDataURL("image/jpeg",parseFloat(getSettings().jpegQuality)));o.disconnect(),DEBUG&&console.log("[classObserver] Stopping..."),c(m,i,l,d,a);var u=new Image;u.src=s,g(u),v(s,m.size,l,d,t.name)}function c(e,a,r,l,d){var c=constructFilename(e.type,t.name),m=new CustomEvent("QRSetFile",{bubbles:!0,detail:{file:e,name:c}});document.dispatchEvent(m),d&&function(e,t,n,i){var o=document.createElement("div");o.id="remDiv";var a=document.createElement("a");a.id="rememberMD5",a.classList.add("sideMenuElement"),a.classList.add("entry"),a.innerHTML="Remember",a.style.fontWeight="bold",a.title="Always convert this image.",a.onmouseover=function(){this.classList.toggle("focused")},a.onmouseout=function(){this.classList.toggle("focused")},a.onclick=function(){saveImgMD5(e,t,n,i)},document.getElementById("sideMenu").appendChild(o),o.appendChild(a)}(a,t,d,e.size),DEBUG&&console.log("[QRSetFile] File Sent"),DEBUG&&console.log("OUTPUT Dimesnions: "+Math.round(r)+"x"+Math.round(l)),DEBUG&&console.log("OUTPUT Filesize: "+formatBytes(e.size)),DEBUG&&console.log("JPEG Quality: "+getSettings().jpegQuality);var u="Original size: ("+formatBytes(t.size)+", "+a.width+"x"+a.height+") \n New size: ("+formatBytes(e.size)+", "+Math.round(r)+"x"+Math.round(l)+")";if(getSettings().notify){var p=new CustomEvent("CreateNotification",{bubbles:!0,detail:{type:"info",content:u,lifetime:5}});document.dispatchEvent(p)}removeQCOption(),removeCropOption(),removeManual(),o.observe(n,i),s=!0,DEBUG&&console.log("------<END>------\n[classObserver] Restarting...")}a.onload=function(e){var n=new Image;n.src=a.result,n.onload=function(){var e=SparkMD5.hash(n.src);DEBUG&&console.log("<FILTER START>"),DEBUG&&(getSettings().convert?console.log("[PNGConverter] Enabled"):console.log("[PNGConverter] Disabled")),DEBUG&&console.log("INPUT Dimensions: "+n.width+"x"+n.height),DEBUG&&console.log("INPUT File size: "+formatBytes(t.size)),getQCList().length>0&&function(e,t){DEBUG&&console.log("[quickConvert] Checking for matching MD5: "+t);for(var n=l.length,i=!1,o=0;o<n;o++){if(l[o].split(":").pop()==t){DEBUG&&console.log("[quickConvert] Match found."),i=!0,d(e.width,e.height,e);break}}DEBUG&&(i||console.log("[quickConvert] No match found."))}(n,e),r.length>0&&!s&&function(e){for(var n=0,i=[],o=r.length,a=0;a<o;a++){if(i[a]=r[a].split(":"),0!=i[a][0]){switch(parseInt(i[a][0])){case 1:i[a][0]="image/png";break;case 2:i[a][0]="image/jpeg"}if(i[a][0]!=t.type)continue}if(i[a][1]==e.width&&i[a][2]==e.height){var s=parseInt(i[a][3]),l=parseInt(i[a][4]);n++,DEBUG&&console.log("Preset '"+a+"' matched: "+i[a]);break}}0==n||n>1?DEBUG&&console.log("Image didn't match any presets.\n------<END>------"):d(s,l,e)}(n),getSettings().convert&&!s&&function(e){if("image/png"!=t.type)return void(DEBUG&&console.log("[PNGConverter] Image format isn't PNG.\n------<END>------"));var n=e.width,i=e.height;DEBUG&&console.log("[PNGConverter] Converting PNG to JPEG"),d(n,i,e)}(n),s||(removeQCOption(),removeManual(),removeCropOption(),function(e,t,n){var i=document.createElement("div");i.id="qcDiv";var o=document.createElement("a");o.id="quickConvert",o.classList.add("sideMenuElement"),o.classList.add("entry"),o.innerHTML="Quick Convert",o.title="Convert image to JPEG format",o.onmouseover=function(){this.classList.toggle("focused")},o.onmouseout=function(){this.classList.toggle("focused")},o.addEventListener("click",(function(){DEBUG&&console.log("[quickConvert] Manually calling Resizer..."),d(e.width,e.height,e,n)})),document.getElementById("sideMenu").appendChild(i),i.appendChild(o)}(n,0,e),function(e,t){var n=document.createElement("div");n.id="manDiv";var i=document.createElement("a");i.id="manualResize",i.classList.add("sideMenuElement"),i.classList.add("entry"),i.innerHTML="Manual Resize",i.title="Manually resize image",i.onmouseover=function(){this.classList.toggle("focused")},i.onmouseout=function(){this.classList.toggle("focused")},i.addEventListener("click",(function(){DEBUG&&console.log("[ManualResizer] Opened."),function(e,t){var n=document.createElement("div");n.id="manInput",n.classList.add("dialog"),document.getElementById("qr").insertAdjacentElement("afterbegin",n),n.innerHTML='<input type="number" id="resWidth" title="Output Width" size="2" min="0" onfocus="this.select();"></input> x <input type="number" id="resHeight" title="Output Height" size="2" min="0" onfocus="this.select();"></input> <select id="resFormat" name="resFormat" title="Output Format" style="color: #000"><option id="opt1" value="image/png">PNG</option><option id="opt2" value="image/jpeg">JPEG</option></select><div id="testContainer" style="padding-top: 10px"><button id="resTest">Test</button><span id="resFS" title="Original size: '+formatBytes(t.size)+'" style="padding-left: 10px">'+formatBytes(t.size)+'</span></div><hr id="rm-hr";><a id="resSet" style="cursor: pointer">Set File</a>',document.getElementById("rm-hr").style.borderColor=getHRColor();var i=document.getElementById("resWidth"),a=document.getElementById("resHeight"),s=document.getElementById("resFS"),r=document.getElementById("resFormat"),l=document.getElementById("resTest"),d=document.getElementById("resSet");i.value=e.width,i.max=e.width,i.placeholder=e.width,a.value=e.height,a.max=e.height,a.placeholder=e.height,r.value=t.type,t.size>4194304&&(s.style.color="red");i.onkeypress=function(){return isNumber(event)},a.onkeypress=function(){return isNumber(event)},i.oninput=function(){calcResAspect("width",e.width,e.height,i.value),m=null},a.oninput=function(){calcResAspect("height",e.width,e.height,a.value),m=null},r.oninput=function(){m=null},l.onclick=function(){(i.value>e.width||a.value>e.height)&&(i.value=e.width,a.value=e.height),p(i.value,a.value,r.value,e,s)},d.onclick=function(){i.value>e.width||a.value>e.height?alert("No upscaling. Do it yourself."):m?(DEBUG&&console.log("[ManualResizer] testBlob found."),o.disconnect(),DEBUG&&console.log("[classObserver] Stopping..."),removePreviewOption(),v(u,m.size,i.value,a.value,t.name),c(m,e,i.value,a.value)):(DEBUG&&console.log("[ManualResizer] testBlob is null, calling fileSizeTester..."),p(i.value,a.value,r.value,e,s),o.disconnect(),DEBUG&&console.log("[classObserver] Stopping..."),removePreviewOption(),v(u,m.size,i.value,a.value,t.name),c(m,e,i.value,a.value))},window.addEventListener("click",(function e(t){var n=document.getElementById("manInput");t.target.matches("#manInput")||t.target.matches("#resWidth")||t.target.matches("#resHeight")||t.target.matches("#resFormat")||t.target.matches("#opt1")||t.target.matches("#opt2")||t.target.matches("#resTest")||t.target.matches("#resFS")||t.target.matches("#testContainer")||t.target.matches("#manualResize")||(n.remove(),DEBUG&&console.log("[ManualResizer] Closed."),window.removeEventListener("click",e))}))}(e,t)})),document.getElementById("sideMenu").appendChild(n),n.appendChild(i)}(n,t),g(n),removePreviewOption(),v(n.src,t.size,n.width,n.height,t.name))}};var m=null,u=null;function p(e,t,n,i,o){DEBUG&&console.log("[fileSizeTester] Starting...");var a,s=document.createElement("canvas"),r=i.width,l=i.height;r>l?r>e&&(l*=e/r,r=e):l>t&&(r*=t/l,l=t),s.width=r,s.height=l,s.getContext("2d").drawImage(i,0,0,r,l);var d=dataURItoBlob(a="image/png"==n?s.toDataURL("image/png"):s.toDataURL("image/jpeg",parseFloat(getSettings().jpegQuality)));o.innerHTML=formatBytes(d.size),d.size>4194304?(DEBUG&&console.log("[fileSizeTester] File size is over the limit: "+formatBytes(d.size)),o.style.color="red"):(DEBUG&&console.log("[fileSizeTester] File size OK: "+formatBytes(d.size)),o.style.color="inherit"),m=d,u=a,DEBUG&&console.log("[fileSizeTester] Done.")}function g(e){var t=document.createElement("div");t.id="cropDiv";var n=document.createElement("a");n.id="crop",n.classList.add("sideMenuElement"),n.classList.add("entry"),n.innerHTML="Crop Image",n.onmouseover=function(){this.classList.toggle("focused")},n.onmouseout=function(){this.classList.toggle("focused")},n.addEventListener("click",(function(){DEBUG&&console.log("[cropper] Starting..."),h(e)})),document.getElementById("sideMenu").appendChild(t),t.appendChild(n)}function h(e){var n=document.createElement("div");n.id="pvOverlay";var i=document.createElement("div");i.id="pvHeader",i.className="dialog",i.classList.add("pvOpct");var a=document.createElement("a");a.id="setCrop",a.style.cursor="pointer",a.innerHTML="Set Image";var s=document.createElement("a");s.id="undoCrop",s.style.cursor="pointer",s.innerHTML="Undo";var r=document.createElement("a");r.id="closeCrop",r.className="close fa fa-times",r.style="float: right; cursor: pointer; margin-right: 20px; margin-top: 7px; transform: scale(1.5);",r.title="Close";var l=document.createElement("img");let d;l.id="cropImg",l.classList.add("centerImg"),l.src=e.src,l.title="LMB: Set\nMMB: Close\nRMB: Undo\nShift+RMB: Context Menu",l.oncontextmenu=function(){return!1},document.body.appendChild(n),n.appendChild(l);const m=document.getElementById("cropImg");m.addEventListener("ready",(function(){n.clientWidth>e.width&&n.clientHeight>e.height&&(d.zoomTo(1),DEBUG&&console.log("[cropper] Scaling image to 100%"));var m=!1;document.body.onkeydown=function(u){var p=u||window.event;if(p.target===this&&d&&!m){switch(p.keyCode){case 46:case 27:p.preventDefault(),d.destroy(),n.remove(),m=!0;break;case 8:p.preventDefault(),document.getElementById("undoCrop")?(document.getElementById("undoCrop").click(),m=!0):d.clear();break;case 32:case 13:if(p.preventDefault(),document.getElementById("setCrop"))document.getElementById("setCrop").click(),m=!0;else{var g=d.getCroppedCanvas({imageSmoothingEnabled:!1,imageSmoothingQuality:"high"});DEBUG&&console.log("[cropper] Output format: "+getSettings().cropOutput);var y=g.toDataURL(getSettings().cropOutput,parseFloat(getSettings().jpegQuality)),f=dataURItoBlob(y),E=d.getData(!0);d.destroy(),l.src=y,l.addEventListener("mouseup",(function(t){if("object"==typeof t)switch(t.button){case 0:b();break;case 1:d.destroy(),n.remove(),m=!0;break;case 2:t.shiftKey||(n.remove(),h(e))}})),n.appendChild(i),i.appendChild(r),i.innerHTML+="Cropped Image ("+formatBytes(f.size)+", "+E.width+"x"+E.height+")<br>",i.appendChild(a),i.innerHTML+=" | ",i.appendChild(s),setTimeout((function(){i.classList.toggle("pvOpct")}),2e3),document.getElementById("closeCrop").onclick=function(){d.destroy(),n.remove(),m=!0},document.getElementById("setCrop").onclick=function(){b()},document.getElementById("undoCrop").onclick=function(){n.remove(),h(e)}}}function b(){o.disconnect(),m=!0,DEBUG&&console.log("[classObserver] Stopping..."),n.remove(),removePreviewOption();var i=constructFilename(f.type,t.name);v(y,f.size,l.width,l.height,i),c(f,e,l.width,l.height)}}}})),d=new DaiyamCropper(m,{aspectRatio:NaN,background:!1,guides:!1,viewMode:1,autoCrop:!1,scalable:!1})}function v(e,t,n,i,o){var a=document.getElementById("previewImg");if(a)a.onclick=function(){showImage(e,t,n,i,o)};else{var s=document.createElement("a");s.id="previewImg",s.classList.add("sideMenuElement"),s.classList.add("entry"),s.innerHTML="Preview Image",s.onmouseover=function(){this.classList.toggle("focused")},s.onmouseout=function(){this.classList.toggle("focused")},s.onclick=function(){showImage(e,t,n,i,o)},document.getElementById("sideMenu").appendChild(s)}}a.readAsDataURL(t)}else removeHR(),removeCropOption(),removeQCOption(),removePreviewOption(),removeManual(),DEBUG&&console.log("[Error] Invalid FileType: "+t.type+"\n------<END>------")}),!1);const n=document.getElementById("file-n-submit");var i={attributes:!0},o=new MutationObserver((function(e,t){if(!0===document.getElementById("file-n-submit").classList.contains("has-file")&&!0===checkState(2))DEBUG&&console.log("------<START>------\n[classObserver] File detected"),DEBUG&&console.log("[QRGetFile] Requesting file..."),document.dispatchEvent(new CustomEvent("QRGetFile"));else{if(!1===checkState(2))return void(DEBUG&&console.log("[classObserver] ImageResizer is disabled"));removeHR(),removeCropOption(),removeQCOption(),removeRemOption(),removePreviewOption(),removeManual(),DEBUG&&console.log("[classObserver] No file")}}));DEBUG&&console.log("[classObserver] Starting..."),o.observe(n,i)}),!1),appendSettings();var scListenerExists=!1;function qCShortcut(e){var t=document.getElementById("quickConvert"),n=document.getElementById("rememberMD5");getSettings().shortcut&&(e.ctrlKey&&81==e.keyCode&&t?t.click():e.ctrlKey&&81==e.keyCode&&n&&n.click())}function constructFilename(e,t){var n=e.split("/").pop();return t.split(".").slice(0,-1).join(".").concat("."+n)}function isDecimalNumber(e){var t=e.which?e.which:e.keyCode;return!(46!=t&&t>31&&(t<48||t>57))}function isNumber(e){var t=(e=e||window.event).which?e.which:e.keyCode;return!(t>31&&(t<48||t>57))}function formatBytes(e,t){if(0==e)return"0 Bytes";var n=t||2,i=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,i)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}getSettings().shortcut&&!scListenerExists&&(document.addEventListener("keyup",qCShortcut),scListenerExists=!0);